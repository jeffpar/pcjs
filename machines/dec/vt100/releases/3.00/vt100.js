(function(){/*
 https://www.pcjs.org/modules/v3/defines.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v2/format.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v3/numio.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v3/stdio.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v3/webio.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v3/device.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v3/input.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v3/led.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v3/monitor.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v3/time.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v3/bus.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v3/memory.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v3/ports.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v3/ram.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v3/rom.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v3/cpu.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v3/debugger.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v3/cpux80.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v3/dbgx80.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v3/chips.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v3/keyboard.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v3/serial.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v3/video.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v3/machine.js (C) 2012-2023 Jeff Parsons
*/
var f;function aa(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}function ba(a){if(!(a instanceof Array)){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];if(b)a=b.call(a);else if("number"==typeof a.length)a={next:aa(a)};else throw Error(String(a)+" is not an iterable or ArrayLike");for(var c=[];!(b=a.next()).done;)c.push(b.value);a=c}return a}
var ca="function"==typeof Object.create?Object.create:function(a){function b(){}b.prototype=a;return new b},ea="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};
function ha(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");}var ia=ha(this);function m(a,b){if(b)a:{var c=ia;a=a.split(".");for(var d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))break a;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&ea(c,a,{configurable:!0,writable:!0,value:b})}}var ja;
if("function"==typeof Object.setPrototypeOf)ja=Object.setPrototypeOf;else{var ka;a:{var na={a:!0},oa={};try{oa.__proto__=na;ka=oa.a;break a}catch(a){}ka=!1}ja=ka?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var pa=ja;
function n(a,b){a.prototype=ca(b.prototype);a.prototype.constructor=a;if(pa)pa(a,b);else for(var c in b)if("prototype"!=c)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d)}else a[c]=b[c];a.Ql=b.prototype}function qa(){for(var a=Number(this),b=[],c=a;c<arguments.length;c++)b[c-a]=arguments[c];return b}
m("String.prototype.replaceAll",function(a){return a?a:function(b,c){if(b instanceof RegExp&&!b.global)throw new TypeError("String.prototype.replaceAll called with a non-global RegExp argument.");return b instanceof RegExp?this.replace(b,c):this.replace(new RegExp(String(b).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08"),"g"),c)}});
m("Math.trunc",function(a){return a?a:function(b){b=Number(b);if(isNaN(b)||Infinity===b||-Infinity===b||0===b)return b;var c=Math.floor(Math.abs(b));return 0>b?-c:c}});m("String.prototype.repeat",function(a){return a?a:function(b){if(null==this)throw new TypeError("The 'this' value for String.prototype.repeat must not be null or undefined");var c=this;if(0>b||1342177279<b)throw new RangeError("Invalid count value");b|=0;for(var d="";b;)if(b&1&&(d+=c),b>>>=1)c+=c;return d}});
m("Number.isNaN",function(a){return a?a:function(b){return"number"===typeof b&&isNaN(b)}});m("Math.log2",function(a){return a?a:function(b){return Math.log(b)/Math.LN2}});
m("Symbol",function(a){function b(g){if(this instanceof b)throw new TypeError("Symbol is not a constructor");return new c(d+(g||"")+"_"+e++,g)}function c(g,h){this.g=g;ea(this,"description",{configurable:!0,writable:!0,value:h})}if(a)return a;c.prototype.toString=function(){return this.g};var d="jscomp_symbol_"+(1E9*Math.random()>>>0)+"_",e=0;return b});
m("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),c=0;c<b.length;c++){var d=ia[b[c]];"function"===typeof d&&"function"!=typeof d.prototype[a]&&ea(d.prototype,a,{configurable:!0,writable:!0,value:function(){return sa(aa(this))}})}return a});function sa(a){a={next:a};a[Symbol.iterator]=function(){return this};return a}
function ta(a,b){a instanceof String&&(a+="");var c=0,d=!1,e={next:function(){if(!d&&c<a.length){var g=c++;return{value:b(g,a[g]),done:!1}}d=!0;return{done:!0,value:void 0}}};e[Symbol.iterator]=function(){return e};return e}m("Array.prototype.keys",function(a){return a?a:function(){return ta(this,function(b){return b})}});
m("Array.prototype.fill",function(a){return a?a:function(b,c,d){var e=this.length||0;0>c&&(c=Math.max(0,e+c));if(null==d||d>e)d=e;d=Number(d);0>d&&(d=Math.max(0,e+d));for(c=Number(c||0);c<d;c++)this[c]=b;return this}});function ua(a){return a?a:Array.prototype.fill}m("Int8Array.prototype.fill",ua);m("Uint8Array.prototype.fill",ua);m("Uint8ClampedArray.prototype.fill",ua);m("Int16Array.prototype.fill",ua);m("Uint16Array.prototype.fill",ua);m("Int32Array.prototype.fill",ua);
m("Uint32Array.prototype.fill",ua);m("Float32Array.prototype.fill",ua);m("Float64Array.prototype.fill",ua);m("Number.parseInt",function(a){return a||parseInt});m("Array.prototype.values",function(a){return a?a:function(){return ta(this,function(b,c){return c})}});function va(){}var wa,xa=new ArrayBuffer(2);(new DataView(xa)).setUint16(0,256,!0);wa=256===(new Uint16Array(xa))[0];
var p={Wc:0xffffffffffff,NONE:0,fe:0,md:134217728,xe:268435456,Eb:536870912,ed:1073741824,Wk:2147483648,eb:0x800000000000},ya={cf:{ib:4,Ca:16},ee:{ib:5,Ca:32},bd:{ib:6,Ca:64},$d:{ib:8,Ca:256},ie:{ib:20,Ca:1048576},El:{ib:22,Ca:4194304}};"undefined"==typeof window||window.PCjs||(window.PCjs={machines:{},components:[],commands:{}});var za="undefined"!=typeof window?window.PCjs.machines:{},Aa="undefined"!=typeof window?window.PCjs.components:[],u={};u.Defines=va;
function Ba(){this.g={};for(var a=0;23>a;a++)this.g["ACDFGHMNSTWYBbdfjcsoXx%"[a]]=null}Ba.prototype.O=function(a,b){return this.g[a]?!1:(this.g[a]=b,!0)};
function Ca(){var a=qa.apply(0,arguments);if(void 0===a[0])a=new Date(Date.now());else if("string"===typeof a[0]){var b=a[0];0>b.indexOf(":")?b+=" "+(a[1]||"00:00:00 UTC"):b.match(/^[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9] [0-9][0-9]:[0-9][0-9]:[0-9][0-9]$/)&&(a[1]||(b+=" UTC"));a=new Date(b)}else a=void 0===a[1]?new Date(a[0]):new Date(Date.UTC.apply(Date,ba(a)));return a}
Ba.prototype.h=function(a){var b=qa.apply(1,arguments);if(!b||!b.length)return a;var c="",d=a.split(/%([-+ 0#]*)([0-9]*|\*)(\.[0-9]+|)([bwhlL]?)([A-Za-z%])/),e=0,g;for(g=0;g<d.length-6;g+=6){c+=d[g];var h=d[g+5];if(void 0===this.g[h])c+="%"+d[g+1]+d[g+2]+d[g+3]+d[g+4]+h;else{if(e<b.length){var k=b[e];"%"!=h&&e++}else k=b[b.length-1];var l=d[g+1],r=0<=l.indexOf("#"),t=0<=l.indexOf("0"),q=d[g+2];"*"==q?(q=k,k=e<b.length?b[e++]:b[b.length-1]):q=+q||0;var x=d[g+3];x=x?+x.substr(1):-1;var w=d[g+4],z=null,
y=0,B="",A=0<="ACDFGHMNSTWY".indexOf(h)&&"object"!=typeof k?Ca(k):k;switch(h){case "C":c+=isNaN(A.getTime())?void 0:this.h("%#W, %#F %#D, %#Y".replaceAll("#",r?"#":""),A);continue;case "D":k=r?A.getUTCDate():A.getDate();h="d";break;case "A":case "G":case "H":k=r?A.getUTCHours():A.getHours();"A"==h?(k=12>k?"am":"pm",h="s"):("G"==h&&(k=k?12<k?k-12:k:12),h="d");break;case "F":case "M":k=r?A.getUTCMonth():A.getMonth();"F"==h?(k=Da[k],h="s"):(k++,h="d");break;case "N":k=r?A.getUTCMinutes():A.getMinutes();
h="d";break;case "S":k=r?A.getUTCSeconds():A.getSeconds();h="d";break;case "T":c+=isNaN(A.getTime())?void 0:this.h("%#Y-%#02M-%#02D %#02H:%#02N:%#02S".replaceAll("#",r?"#":""),A);continue;case "W":k=Ea[r?A.getUTCDay():A.getDay()];h="s";break;case "Y":k=r?A.getUTCFullYear():A.getFullYear(),0<x&&(k%=Math.pow(10,x)),h="d"}switch(h){case "b":c+=k?"true":"false";break;case "d":k=Math.trunc(k),0<=x&&(t=!0,q<x&&(q=x),x=-1);case "f":k=+k;h=k+"";0<=x&&(h=k.toFixed(x));h.length<q&&(t?(0>k&&(q--,h=h.substr(1)),
h=("0".repeat(q)+h).slice(-q),0>k&&(h="-"+h)):h=(" ".repeat(q)+h).slice(-q));c+=h;break;case "j":c+=JSON.stringify(k,null,q||void 0);break;case "c":k="string"==typeof k?k[0]:String.fromCharCode(k);case "s":if(void 0!=k)for("string"!=typeof k&&(k=k.toString()),0<=x&&(k=k.substr(0,x));k.length<q;)k=0<=l.indexOf("-")?k+" ":" "+k;c+=k;break;case "B":y=2,r&&(B="0b");case "o":y||(y=8),!B&&r&&(B="0o");case "X":z=Fa;case "x":h="";y||(y=16);!B&&r&&(B="0x");z||(z=Ga);k=Math.trunc(k);0<=x&&(t=!0,q<x&&(q=x));
t&&!q&&("b"==w?q=2:"h"==w||"w"==w?q=4:"l"==w?q=8:(q=Math.abs(k),q=255>=q?2:65535>=q?4:4294967295>=q?8:9),q+=B.length);q-=B.length;do r=16,Number.isNaN(k)||(r=k&y-1,k=Math.trunc(k/y)),t||!h||r||k?h=z[r]+h:(B&&(h=B+h,B=""),0<q&&(h=" "+h));while(0<--q||k);c+=B+h;break;case "%":c+="%";break;default:c=this.g[h]?c+this.g[h](h,l,q,x,k):c+("(unimplemented sprintf type: %"+h+")")}}}return c+=d[g]};
var Ga="0123456789abcdef?",Fa="0123456789ABCDEF?",Ea="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),Da="January February March April May June July August September October November December".split(" ");function Ha(){}n(Ha,va);
function Ia(a,b){if(a){b||(b=10);var c,d=0<a.indexOf(",");d&&(a=a.replace(/,/g,""));var e=c=a.charAt(0);"#"==c?(b=8,c=""):"$"==c&&(b=16,c="");e!=c?a=a.substr(1):(e=c=a.substr(0,2),"0b"==c&&d||"^B"==c?(b=2,c=""):"0o"==c||"^O"==c?(b=8,c=""):"^D"==c?(b=10,c=""):"0x"==c&&(b=16,c=""),e!=c&&(a=a.substr(2)));e=c=a.slice(-1);"Y"==c||"y"==c?(b=2,c=""):"."==c?(b=10,c=""):"H"==c||"h"==c?(b=16,c=""):"K"==c?c="000":"M"==c?c="000000":"G"==c&&(c="000000000");e!=c&&(a=a.slice(0,-1)+c);var g;e=0;10>=b&&(c=a.match(/(-?[0-9]+)B([0-9]*)$/))&&
(a=c[1],e=35-((c[2]||35)&255));if((b&&10!=b?16==b?null!==a.match(/^-?[0-9a-f]+$/i):8==b?null!==a.match(/^-?[0-7]+$/):2==b&&null!==a.match(/^-?[01]+$/):null!==a.match(/^[+-]?[0-9]+$/))&&!isNaN(g=parseInt(a,b))){e&&(0>g&&(g+=Math.pow(2,36)),g=0<e?g*Math.pow(2,e):Math.trunc(g/Math.pow(2,-e)));var h=g}}return h}
function Ja(a,b,c,d,e){d=void 0===d?0:d;var g=void 0===g?0:g;var h="",k="",l=-1;c||(c=a.la||10);d&&(l=Math.ceil(d/Math.log2(c)));if(void 0==e)switch(c){case 8:e="0o";break;case 16:e="0x";break;case 10:k=".";default:e=""}isNaN(b)||"number"!=typeof b?(b=void 0,e=k=""):(0>b&&-1<b&&(b=-1),d&&(0>b&&(b+=Math.pow(2,d)),b>=Math.pow(2,d)&&(l=Math.ceil(Math.log(b)/Math.log(c)))));for(a=g||-1;l--;){a||(h=","+h,a=g);if(void 0==b){if(h="?"+h,0>l)break}else if(d=b%c,b=Math.trunc(b/c),d+=0<=d&&9>=d?48:55,h=String.fromCharCode(d)+
h,!b&&0>l)break;a--}return e+h+k}function Ka(a,b){var c=a/La|0,d=b/La|0;return(a&b)==(b|0)&&(c&d)==d}var La=Math.pow(2,32);u.NumIO=Ha;function Ma(){this.zb=new Ba;this.td=this.zb.O.bind(this.zb);this.O=this.zb.h.bind(this.zb)}n(Ma,Ha);Ma.prototype.flush=function(){var a=Na;Na="";this.Sa(a)};function Oa(a){var b=a,c=a.lastIndexOf("/");0<=c&&(b=a.substr(c+1));c=b.indexOf("&");0<c&&(b=b.substr(0,c));c=b.lastIndexOf(".");0<c&&(b=b.substring(0,c));return b}
Ma.prototype.Sa=function(a,b){var c=a.lastIndexOf("\n");b?0<=c&&(b=Date.now(),Pa||(Pa=b),a=((b-Pa)/1E3).toFixed(3)+": "+a):(0<=c&&(console.log(Na+a.substr(0,c)),Na="",a=a.substr(c+1)),Pa=null);Na+=a;return a.length};Ma.prototype.v=function(a){return this.Sa(this.O.apply(this,[a].concat(ba(qa.apply(1,arguments)))))};var Na="",Pa=null;u.StdIO=Ma;function Qa(a){Ma.call(this);this.ea={};this.va=0;this.V=this;a&&(this.V.va=0,this.V.Ra=[],this.V.Ia=0,this.V.Ab={},this.V.vb=!1)}var Ra;n(Qa,Ma);f=Qa.prototype;
f.Ua=function(a,b){var c=this,d=this;switch(a){case Sa.ae:b.onclick=function(){var e=c.La(Sa.Cb,!0);e&&(e.value="")};break;case Sa.Cb:Ta(b),b.addEventListener("keydown",function(e){Ua(d,e,!0)}),b.addEventListener("keypress",function(e){Ua(d,e)})}};function Va(a,b){var c=Wa.Yc;a.V.Ab[c]||(a.V.Ab[c]=[]);a.V.Ab[c].push(b)}function Ta(a){a.setAttribute("autocapitalize","off");a.setAttribute("autocomplete","off");a.setAttribute("autocorrect","off");a.setAttribute("spellcheck","false");a.value=""}
f.error=function(a,b){b=this.O.apply(this,[a].concat(ba(b)));var c="%s";a=!1;"boolean"==typeof c&&(a=c,c=b.shift());if(b=this.O.apply(this,[c].concat(ba(b))))this.v("%s\n",b),a||alert(b)};f.La=function(a){return this.ea[a]};function Xa(a,b,c){if(a){do{for(var d=0;d<Ya.length;d++){var e=Ya[d];if(c){if(e+=c,b+e in a)return e}else if(e=e?e+b[0].toUpperCase():b[0],e+=b.substr(1),e in a)return e}if(0>b.indexOf("screen"))break;b=b.replace("screen","Screen")}while(1)}return null}
function Za(a,b){return a.J.bindings&&a.J.bindings[b]}function $a(a){if(a=a.ea[ab])var b=a.textContent;return b}function bb(a,b,c){a=+a||0;a<b&&(a=b);a>c&&(a=c);return a}function v(a,b,c,d){a=a.J[b];void 0===a?a=c:(d&&void 0!==d[a]&&(a=d[a]),d=typeof c,typeof a!=d&&("boolean"==d?a=!!a:"number"==typeof c&&(a=+a)));return a}
function cb(a,b){var c=0,d=null,e=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP");e.onreadystatechange=function(){4!==e.readyState?b(a,d,e.readyState,c):(d=e.responseText,200==e.status||!e.status&&d.length&&"file:"==(window?window.location.protocol:"file:")||(c=e.status||-1),b(a,d,e.readyState,c))};e.open("GET",a,!0);e.send()}
function db(){var a,b=Ra;if(!b){b={};if(window){a||(a=window.location.search.substr(1));for(var c,d=/\+/g,e=/([^&=]+)=?([^&]*)/g;c=e.exec(a);)b[decodeURIComponent(c[1].replace(d," ")).trim()]=decodeURIComponent(c[2].replace(d," ")).trim()}Ra=b}return b}function eb(a){if(void 0===fb.Xb){var b=!1;if(window)try{window.localStorage.setItem(fb.mb,fb.mb),b=window.localStorage.getItem(fb.mb)==fb.mb,window.localStorage.removeItem(fb.mb)}catch(c){a.v("%s\n",c.message),b=!1}fb.Xb=b}return!!fb.Xb}
function gb(a,b){b=void 0===b?0:b;1<b&&b%2&&b--;b=b||a.va;return-1==(b|1)||Ka(a.V.va,b)?!0:!1}function hb(a){if(window){var b=window.navigator.userAgent;return"iOS"==a&&(!!b.match(/(iPod|iPhone|iPad)/)||"MacIntel"===window.navigator.platform&&1<window.navigator.maxTouchPoints)||"MSIE"==a&&!!b.match(/(MSIE|Trident)/)||0<=b.indexOf(a)}return!1}function ib(a){var b=null;if(eb(a)){var c;if(window)try{(c=window.localStorage.getItem(a.aa))&&(b=JSON.parse(c))}catch(d){a.v("%s\n",d.message)}}return b}
function Ua(a,b,c){b=b||window.event;var d=b.which||b.keyCode;if(d){var e=a.V,g=b.target;if(c){a=!1;var h;c=g.value;var k=c.lastIndexOf("\n");d==C.Zb&&g.selectionStart<=k+1&&(a=!0);d==C.Dd?(a=!0,0<e.Ia&&(h=e.Ra[--e.Ia])):d==C.ad&&(a=!0,e.Ia<e.Ra.length&&(h=e.Ra[++e.Ia]||""));a&&b.preventDefault();void 0!=h&&(g.value=c.substr(0,k+1)+h)}else d=String.fromCharCode(d),h=g.value,c=h.lastIndexOf("\n"),g.selectionStart<=c&&g.setSelectionRange(h.length,h.length),b.stopPropagation(),"@"==d&&0<e.Ia&&c+1==h.length&&
(g.value+=e.Ra[--e.Ia],d="\r"),"\r"==d&&(b.preventDefault(),h=g.value+="\n",g.blur(),g.focus(),(b=jb(a,h.slice(h.lastIndexOf("\n",h.length-2)+1,-1)||""))&&a.v("%s\n",b.replace(/\n$/,"")))}}function kb(a){window&&window.addEventListener("resize",a)}function lb(a){return"true"==a||"on"==a?!0:"false"==a||"off"==a?!1:void 0}
function mb(a,b){if(void 0!=b){var c=a.V;try{if(b=b.trim())c.Ia<c.Ra.length&&b==c.Ra[c.Ia]?c.Ia++:(c.Ra.push(b),c.Ia=c.Ra.length);var d=b.split(" "),e=d[0],g=a.V.Ab[Wa.Yc];switch(e[0]){case "m":if("?"==e[1]){var h="";nb.forEach(function(q){h+=q+"\n"});h&&(h="message commands:\n"+h);break}h="";var k=void 0;e=d[d.length-1].toLowerCase();var l=lb(e);void 0!=l&&d.pop();1>=d.length&&(void 0!=l&&(k=l,l=void 0),d[1]="all");"all"==d[1]&&(d=Object.keys(D));for(g=1;g<d.length;g++){e=d[g];var r=D[e];if(!r){h+=
"unrecognized message: "+e+"\n";break}void 0!=l&&ob(a,r,l);if(void 0==k||k==gb(a,r))h+=a.O("%8s: %b\n",e,gb(a,r))}gb(a,p.eb)&&(h+="all messages will be buffered until buffer is turned off\n");h||(h="no messages\n");break;case "?":h="",pb.forEach(function(q){h+=q+"\n"}),h&&(h="default commands:\n"+h);default:if(d.unshift(b),g)for(a=0;a<g.length;a++){var t=g[a](d);if(void 0!=t){h=h?h+t:t;break}}}}catch(q){h="error: "+q.message+"\n"}}return h}
function jb(a,b){b=void 0===b?"?":b;if(b){var c="";b=b.split(/(?:\n|;\s*)/);for(var d=0;d<b.length;d++)c+=mb(a,b[d])}return c}f.Sa=function(a,b){void 0==b&&(b=gb(this,p.eb));if(!b){var c=this.La(Sa.Cb,!0);if(c)return c.value.substr(-a.length)!=a&&(c.value+=a,8192<c.value.length&&(c.value=c.value.substr(c.value.length-4096)),c.scrollTop=c.scrollHeight,hb("iOS")||c.setSelectionRange(c.value.length,c.value.length)),a.length}return Ma.prototype.Sa.call(this,a,b)};
f.v=function(a){var b=qa.apply(1,arguments),c=0;"number"==typeof a&&(c=a,a=b.shift());return gb(this,c)?(Ka(c,p.ed)&&(a="error: "+a),Ka(c,p.Eb)&&(a="warning: "+a),Ma.prototype.v.call.apply(Ma.prototype.v,[this,a].concat(ba(b)))):0};function qb(a,b){if(eb(a)){b=JSON.stringify(b);try{window.localStorage.setItem(a.aa,b)}catch(c){a.v("%s\n",c.message)}}}function rb(a,b,c){(a=a.ea[b])&&a.textContent!=c&&(a.textContent=c)}
function ob(a,b,c){var d=!1;c?(c=a.V.va,a.V.va=(c|b)+(c/La|0|b/La|0)*La):(d=Ka(a.V.va,p.eb)&&Ka(b,p.eb),c=a.V.va,a.V.va=(c&~b)+((c/La|0)&~(b/La|0))*La);d&&a.flush()}
var Sa={ae:"clear",Cb:"print"},pb=["\u2191 \u2193\t\trecall commands","@\t\trepeat last command","m?\t\tmessage commands"],nb=["m\t\tdisplay all messages","m on\t\tdisplay all active messages","m off\t\tdisplay all inactive messages","m all [on|off]\tturn all messages on or off","m ... [on|off]\tturn selected messages on or off"],D={all:p.Wc,buffer:p.eb},Wa={Yc:"command"},sb={xb:13,wb:65,Yb:66,$b:67,ac:68,E:69,bc:70,cc:71,dc:72,ec:73,fc:74,jc:75,lc:76,oc:77,qc:78,rc:79,sc:80,Q:81,tc:82,uc:83,wc:84,
yc:85,zc:86,Ac:87,Bc:88,Cc:89,Ib:90,a:97,b:98,c:99,d:100,e:101,f:102,Hl:103,Il:104,Jl:105,Kl:106,k:107,Ll:108,Ml:109,n:110,Nl:111,p:112,q:113,r:114,Ol:115,t:116,Rl:117,Sl:118,w:119,x:120,y:121,z:122},C={Zb:8,xc:9,Ce:10,xb:13,vc:16,yb:17,Wd:18,yl:19,Ya:20,fd:27,zd:32,Al:33,zl:34,Xk:35,il:36,mc:37,Dd:38,Db:39,fl:39,ad:40,cl:44,Bl:44,jl:45,ge:46,el:46,hl:47,ZERO:48,ONE:49,Cd:50,Bd:51,kd:52,jd:53,yd:54,xd:55,cd:56,sd:57,ve:59,ue:61,wb:65,Yb:66,$b:67,ac:68,E:69,bc:70,cc:71,dc:72,ec:73,fc:74,jc:75,lc:76,
oc:77,qc:78,rc:79,sc:80,Q:81,tc:82,uc:83,wc:84,yc:85,zc:86,Ac:87,Bc:88,Cc:89,Ib:90,Xc:91,dl:91,bl:92,Cl:93,gl:93,Ge:96,rl:96,al:96,He:97,pl:97,Ie:98,ol:98,Je:99,ul:99,Ke:100,sl:100,Le:101,ml:101,Me:102,wl:102,Ne:103,ql:103,Oe:104,xl:104,Pe:105,vl:105,tl:106,ll:107,Se:109,Qe:110,nl:111,je:112,ke:113,le:114,me:115,ne:116,oe:117,pe:118,qe:119,re:120,Yk:121,Zk:122,$k:123,Re:144,ef:145,te:173,wd:186,dd:187,be:188,$c:189,We:190,ff:191,Xd:192,Be:219,Yd:220,af:221,$e:222,se:224,nc:901,ab:1E3},tb={},ub=(tb[C.ve]=
C.wd,tb[C.ue]=C.dd,tb[C.te]=C.$c,tb[C.se]=C.Xc,tb),vb={mc:1,Db:2,kl:3},E={},wb=(E[C.Zb]="\b",E[C.xc]="\t",E[C.Ce]="\n",E[C.xb]="\r",E[C.zd]=" ",E[C.ZERO]="0",E[C.ONE]="1",E[C.Cd]="2",E[C.Bd]="3",E[C.kd]="4",E[C.jd]="5",E[C.yd]="6",E[C.xd]="7",E[C.cd]="8",E[C.sd]="9",E[C.wb]="A",E[C.Yb]="B",E[C.$b]="C",E[C.ac]="D",E[C.E]="E",E[C.bc]="F",E[C.cc]="G",E[C.dc]="H",E[C.ec]="I",E[C.fc]="J",E[C.jc]="K",E[C.lc]="L",E[C.oc]="M",E[C.qc]="N",E[C.rc]="O",E[C.sc]="P",E[C.Q]="Q",E[C.tc]="R",E[C.uc]="S",E[C.wc]=
"T",E[C.yc]="U",E[C.zc]="V",E[C.Ac]="W",E[C.Bc]="X",E[C.Cc]="Y",E[C.Ib]="Z",E[C.mc]="Left",E[C.Db]="Right",E),Ya=["","moz","ms","webkit"],xb={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",
crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",
forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",
lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",
moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",
seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},fb={Xb:void 0,mb:"PCjs.localStorage"};u.WebIO=Qa;
function F(a,b,c,d){a=void 0===a?"default":a;b=void 0===b?a:b;c=void 0===c?{}:c;d=void 0===d?[]:d;Qa.call(this,a==b);this.aa=a;this.W=b;za[this.aa]||(za[this.aa]={});za[this.aa][this.W]&&this.v("warning: machine configuration contains multiple '%s' devices\n",this.W);za[this.aa][this.W]=this;this.id=this.aa==this.W?this.aa:this.aa+"."+this.W;Aa.push(this);this.V=yb(this,this.aa);this.ready=!0;zb(this,c,d);this.fb={};this.ud=[]}n(F,Qa);f=F.prototype;f.Jb=function(){};f.Dc=function(){};
function zb(a,b,c){c=b.overrides||c;if(c.length){var d=db();for(k in d)if(0<=c.indexOf(k)){var e=d[k],g=Ia(e,10);void 0==g&&("true"==e?g=!0:"false"==e?g=!1:(g=e,e='"'+e+'"'));b[k]=g;a.v("overriding %s property '%s' with %s\n",a.W,k,e)}}a.J=b;c=b.bindings;c=void 0===c?{}:c;if("undefined"!=typeof document){a.J.ea||(a.J.ea=c);(d=Array.isArray(c))?0>c.indexOf("container")&&c.push("container"):c.container||(c.container=a.W);for(var h in c){e=c[h];if(d)h=e;else if(e.match(/^[0-9]+$/)){var k=+e;a.ea[h]=
[];do{e=h+k++;e=document.getElementById(e);if(!e)break;a.ea[h].push(e)}while(1);continue}if(k=document.getElementById(e))a.ea[h]=k,a.Ua(h,k)}}b=void 0===b?{}:b;a.version=3;if(a.version){h="";var l;a.aa!=a.W&&(l=yb(a,a.aa).version)&&l!=a.version&&(h="Machine");h||(l=b.version)&&l>a.version&&(h="Config");h&&(l=a.O("%s Device version (%3.2f) incompatible with %s version (%3.2f)",b.Gl,a.version,h,l),a.error("%s\n\nClearing your browser's cache may resolve the issue.",l))}}
function Ab(a,b,c,d){a.fb[b]={get:c.bind(a),set:d?d.bind(a):null}}function Bb(a,b){var c;try{var d=za[a.aa];if(d)for(c in d){var e=d[c];if(e.W!=e.aa&&!b(e))return!1}return!0}catch(g){a.v("error while enumerating device '%s': %s\n",c,g.message)}return!1}f.La=function(a,b){b=void 0===b?!1:b;if(a){var c=Qa.prototype.La.call(this,a,b);if(void 0===c&&b){b=za[this.aa];for(var d in b)if(c=b[d].ea[a])break;c||(c=null);this.ea[a]=c}}return c};
function yb(a,b,c){var d=b,e=a.aa,g=e.indexOf(".");0<g&&(e=e.substr(0,g),b=b.substr(g+1));b=(g=za[e])&&g[b]||null;if(!b){for(g=0;g<Aa.length;g++)if(Aa[g].id===d){b=Aa[g];break}if(!b&&(void 0===c||c))throw Error(a.O('no "%s" device',d));}return b}function G(a,b,c){var d=null,e=za[a.aa];if(e)for(var g in e)if(e[g].J["class"]==b){if(d){d=null;break}d=e[g]}if(!d&&(void 0===c||c))throw Error(a.O("no %s device",b));return d}function Cb(a,b){var c=yb(a,a.aa);return c&&c.J&&c.J[b]||a.J[b]}
function Db(a,b){return(a=a.fb[b])&&a.get()}function Eb(a){return a==a.V&&a.ready?Bb(a,function(b){return Eb(b)}):a.ready}function Fb(a,b){b=void 0===b?a.ready:b;a.ready=b;if(Eb(a)){for(;b=a.ud.pop();)b();a!=a.V&&Fb(a.V)}}function Gb(a,b){if(Eb(a))return b(),!0;a.ud.push(b);return!1}f.Qd=function(){};
f.v=function(a){var b=qa.apply(1,arguments);return"number"==typeof a&&gb(this,a)&&(void 0===this.ba&&(this.ba=G(this,"Debugger",!1)),this.ba&&this.ba.Qd(a),this.V.va&p.Vc&&(void 0===this.X&&(this.X=G(this,"CPU")),this.X))?(a=b.shift(),Qa.prototype.v.call(this,"%#06x: %s.%s\n",this.X.sb,this.W,this.O.apply(this,[a].concat(ba(b))).trim())):Qa.prototype.v.call.apply(Qa.prototype.v,[this,a].concat(ba(b)))};function Hb(a,b){(a=za[a.aa])&&delete a[b]}function Ib(a,b,c){(a=a.fb[b])&&a.set&&a.set(c)}
p.Vc=1;p.Zd=2;p.hd=4;p.De=8;p.qa=16;p.Ga=32;p.kc=64;p.Oa=128;p.pc=256;p.de=512;p.Ee=1024;p.INT=2048;p.jf=4096;p.Ed=8192;p.Bb=16384;p.df=32768;p.he=65536;p.we=131072;p.kb=262144;p.gf=524288;p.gd=1048576;p.Aa=2097152;p.gb=4194304;p.Fe=8388608;p.hf=16777216;p.Vk=4294967296;D.addr=p.Vc;D.bus=p.Zd;D.fault=p.hd;D.memory=p.De;D.ports=p.qa;D.chips=p.Ga;D.kbd=p.kc;D.serial=p.Oa;D.misc=p.pc;D.cpu=p.de;D.mmu=p.Ee;D["int"]=p.INT;D.trap=p.jf;D.video=p.Ed;D.monitor=p.Bb;D.screen=p.df;D.disk=p.he;D.file=p.we;
D.time=p.kb;D.timer=p.gf;D.event=p.gd;D.input=p.Aa;D.key=p.gb;D.mouse=p.Fe;D.touch=p.hf;D.halt=p.md;D.info=p.xe;D.warn=p.Eb;D.error=p.ed;u.Device=F;
function Jb(a,b,c){F.call(this,a,b,c);this.va=p.Aa;this.Z=this.S=null;this.time=G(this,"Time");this.V=G(this,"Machine");this.ka=v(this,"drag",!1);this.Y=v(this,"scroll",!1);this.fa=v(this,"hexagonal",!1);this.l=v(this,"releaseDelay",0);this.o=!1;a=this.J.map;this.j=this.h=this.s=null;if(a)if(a.length)this.j=a;else{this.h={};b=Object.keys(a);for(var d=0;d<b.length;d++){var e=[],g=b[d],h=a[g];"string"==typeof h?h=[h]:void 0==h.length&&(e=h.grid,h=h.keys,"string"==typeof h&&(h=[h]));this.h[g]={keys:h,
grid:e,state:0}}}this.H=[];this.M=[];this.I=!1;this.m=this.K=null;(a=this.ea[Kb])&&Lb(this,a,this.La(c.focusBinding,!0),this.J.location);this.ma()}n(Jb,F);function Mb(a,b){a.S=b}
function Nb(a,b){var c=Ob,d=C.Ya;if(c==Ob)a.H.push({id:d,Wa:b});else if(c==Pb&&a.h){if(c=a.h[d]){var e=c.keys;e&&e.length&&a.H.push({id:d,Wa:b});(c=c.grid)&&c.length&&a.M.push({id:d,tf:c[0],wf:c[1],Rk:c[2],Tk:c[3],Wa:b})}}else if(c==Qb){var g=a.La(d,!0);g&&b&&g.addEventListener("click",function(){var h="-on"!=(g.getAttribute("class")||"").slice(-3);g.setAttribute("class",(g.getAttribute("class")||"").replace(/(-on|-off)$/,h?"-on":"-off"));b(d,h)})}}
function Rb(a,b){var c=Sb,d=Tb;if(!a.s&&(a.s=c,a.oa=Ub(a.time,"timerAutoRelease",function(){Vb(a)}),d)){c={};for(var e in d)c={Lb:c.Lb,Va:c.Va},c.Lb=e,c.Va=b.ea[c.Lb],c.Va&&c.Va.addEventListener("click",function(g){return function(){var h=d[g.Lb],k=!0,l=!0;if("number"==typeof h)var r=h;else if(r=h[0],r==C.nc){var t=+g.Va.getAttribute("data-value")||0;r=h[1];k=!t;l=!1;g.Va.setAttribute("data-value",1-t);g.Va.style.fontWeight=k?"bold":"normal"}Wb(a,r,k,l);Xb(a)}}(c))}}
function Yb(a,b,c){for(var d=0;d<a.H.length;d++){var e=a.H[d];e.id===b&&e.Wa(b,c)}}
function Lb(a,b,c,d){d=void 0===d?[]:d;if(d.length||a.j||a.h){var e={};e.Sk=d[0]||0;e.Uk=d[1]||0;e.qb=d[2]||b.clientWidth;e.Mb=d[3]||b.clientHeight;e.Ob=d[4]||1;e.Vb=d[5]||1;e.vf=d[6]||b.naturalWidth||e.qb;e.yf=d[7]||b.naturalHeight||e.Mb;e.Ud=d[8]||0;e.Vd=d[9]||0;e.uf=d[10]||0;e.xf=d[11]||0;a.j?(e.Qb=a.j.length,e.rb=a.j[0].length):(e.rb=e.Ob,e.Qb=e.Vb,e.Ob=e.Vb=0);e.Kd=e.qb/(e.rb+e.rb*e.Ob)|0;e.Ld=e.Mb/(e.Qb+e.Qb*e.Vb)|0;e.sf=e.Kd*e.Ob|0;e.Md=e.Ld*e.Vb|0;e.ub=e.Wb=-1;Zb(a,b,e);$b(a,b,e);a.time&&
a.l&&(a.ca=Ub(a.time,"timerInputRelease",function(){0>e.ub&&0>e.Wb&&ac(a,-1,-1)}))}if(a.j||a.h||a.s)a.time&&a.l&&(a.pa=Ub(a.time,"timerKeyRelease",function(){bc(a)})),a.u=0,a.N="",a.L=[],d=b,c&&(d=c,a.m||"BUTTON"!=c.nodeName||(d=document,a.m=c,cc(a,b),a.K=b)),cc(a,d),a.m||(a.m=d)}function dc(a){a.l?ec(a.time,a.pa,a.l):bc(a)}
function cc(a,b){function c(e,g,h){var k=document.activeElement;a.v(p.gb+p.gd,"%s.onKey%s(%d): %5.2f (%s)\n",k.id||k.nodeName,e,g,Date.now()/1E3%60,void 0!=h?h?"used":"unused":"ignored")}function d(e,g){e=document.activeElement;return a.m&&e!=a.m&&e!=a.K?null:g||window.event}b.addEventListener("keydown",function(e){if(e=d(this,e)){var g=e.which||e.keyCode,h=Wb(a,g,!0,!1,e);c("Down",g,h);h&&e.preventDefault()}});b.addEventListener("keypress",function(e){if(e=d(this,e)){var g=e.which||e.charCode,h=
Wb(a,g);c("Press",g,h);h&&e.preventDefault()}});b.addEventListener("keyup",function(e){if(e=d(this,e)){var g=e.which||e.keyCode,h=Wb(a,g,!1,!1,e);c("Up",g);h&&e.preventDefault();"TEXTAREA"==b.nodeName&&(b.value="")}})}
function Zb(a,b,c){b.addEventListener("mousedown",function(d){if(!a.o){var e=a.I?a.K:a.m;if(e){var g=window.scrollX,h=window.scrollY;e.focus();window.scrollTo(g,h)}d.button||fc(a,b,gc,d,c)}});b.addEventListener("mousemove",function(d){a.o||fc(a,b,hc,d,c)});b.addEventListener("mouseup",function(d){a.o||d.button||fc(a,b,ic,d,c)});b.addEventListener("mouseout",function(d){a.o||(0>c.ub?fc(a,b,hc,d,c):fc(a,b,ic,d,c))})}
function $b(a,b,c){b.addEventListener("touchstart",function(d){a.Y&&(a.o=!0);fc(a,b,gc,d,c)});b.addEventListener("touchmove",function(d){fc(a,b,hc,d,c)});b.addEventListener("touchend",function(d){fc(a,b,ic,d,c)})}function Vb(a){for(var b=0,c=-1;b<a.g.length;){var d=a.g[b];if(d.Kb){var e=d.Hc;d=a.l-(Date.now()-d.Ic);if(0<d){if(0>c||c>d)c=d}else{jc(a,e);b=0;continue}}b++}0<=c&&ec(a.time,a.oa,c)}
function kc(a,b,c){c=void 0===c?!1:c;if("number"!=typeof b)for(var d=0;d<b.length;d++)kc(a,b[d],c);else{d=lc(a,b);var e=Date.now();0>d?(a.g.push({Hc:b,Ic:e,Kb:c}),a.v(p.gb+p.Aa,"addActiveKey(keyNum=%d,autoRelease=%b)\n",b,c)):(a.g[d].Ic=e,a.g[d].Kb=c);c&&Vb(a)}}function lc(a,b){for(var c=0;c<a.g.length;c++)if(a.g[c].Hc==b)return c;return-1}
function jc(a,b){if("number"!=typeof b)for(var c=0;c<b.length;c++)jc(a,b[c]);else if(c=lc(a,b),0<=c){var d=a.g[c],e=Date.now()-d.Ic;e<a.l?(d.Kb=!0,Vb(a)):(a.v(p.gb+p.Aa,"removeActiveKey(keyNum=%d,duration=%dms,autoRelease=%b)\n",b,e,d.Kb),a.g.splice(c,1))}else a.v(p.gb+p.Aa,"removeActiveKey(keyNum=%d): up without down?\n",b)}
function Wb(a,b,c,d,e){if(void 0!=c){var g=ub[b]||b;var h=wb[b];var k=mc[g];e=e&&e.location==vb.Db;k&nc&&e&&(k>>=1);k&&(k&oc&&(c=!(a.i&k)),a.i=c?a.i|k:a.i&~k,Yb(a,g,c))}else g=0,h=String.fromCharCode(b).toUpperCase(),b>=sb.wb&&b<=sb.Ib?a.i&(pc|qc)||(a.i|=qc,Yb(a,C.Ya,!0)):b>=sb.a&&b<=sb.z&&a.i&qc&&(a.i&=~qc,Yb(a,C.Ya,!1));if(a.j){if(void 0!=c)return!1;for(k=0;k<a.j.length;k++){e=a.j[k];for(var l=0;l<e.length;l++)if(0<=e[l].split("|").indexOf(h))return a.u?16>a.L.length&&a.L.push(b):(a.u=1,a.N=h,ac(a,
l,k),Yb(a,h,!0),dc(a)),!0}}if(a.h){if(void 0==c)return!0;b=Object.keys(a.h);for(k=0;k<b.length;k++)if(e=b[k],0<=a.h[e].keys.indexOf(h))return Yb(a,e,c),a.h[e].state=c?1:0,!0}if(a.s){if(!g)return!0;(g=a.s[g])&&(c?kc(a,g,d):jc(a,g))}return!1}function bc(a){1==a.u?(a.u++,Yb(a,a.N,!1),a.N="",ac(a,-1,-1),dc(a)):(a.u=0,a.L.length&&Wb(a,a.L.shift()))}Jb.prototype.ma=function(){this.g=[];this.i=0;this.U=this.$=-1};
function fc(a,b,c,d,e){var g=-1,h=-1,k=!1,l=-1,r=-1;if(c<ic){d=d||window.event;d.targetTouches&&d.targetTouches.length?(l=d.targetTouches[0].clientX,r=d.targetTouches[0].clientY,k=1<d.targetTouches.length):(l=d.clientX,r=d.clientY);var t=d.target.getBoundingClientRect();l-=t.left;r-=t.top;l=e.vf/b.offsetWidth*l|0;r=e.yf/b.offsetHeight*r|0;var q=l-e.Sk;var x=r-e.Uk;var w=t=!1;var z=l>=e.Ud&&l<e.Ud+e.uf&&r>=e.Vd&&r<e.Vd+e.xf;if(0<=q&&q<e.qb&&0<=x+e.Md||z)if(k||a.Y||d.preventDefault(),0<=q&&q<e.qb&&
0<=x&&x<e.Mb){w=!0;d=e.qb/e.rb|0;var y=e.Mb/e.Qb|0,B=q/d|0,A=x/y|0;!a.fa||A&1||(q-=d>>1,B=q/d|0,B==e.rb-1&&(q=-1));y=A*y+(e.Md>>1);q-=B*d+(e.sf>>1);x-=y;0<=q&&q<e.Kd&&0<=x&&x<e.Ld&&(g=B,h=A,t=!0)}}q=q||0;x=x||0;d=b.offsetWidth;b=b.offsetHeight;if(c==gc||c==ic)for(B=0;B<a.M.length;B++)A=a.M[B],c==ic?A.Wa(A.id,!1):(y=x/(b/A.wf|0)|0,(q/(d/A.tf|0)|0)==A.Rk&&y==A.Tk&&A.Wa(A.id,!0));if(!k)if(c==gc)e.ub=l,e.Wb=r,w?(ac(a,g,h),t&&a.l&&ec(a.time,a.ca,a.l,!0)):z&&a.V.ra();else if(c==hc)0<=e.ub&&0<=e.Wb&&a.ka?
ac(a,g,h):a.S&&a.S(g,h);else if(c==ic){if(c=a.l)c=a.time,g=a.ca,c=c.g&&0<g&&g<=c.h.length?0<=c.h[g-1].Fa:!1;c||ac(a,-1,-1);e.ub=e.Wb=-1}else a.v("unrecognized action: %d\n",c)}function Xb(a){var b=a.I?a.K:a.m;b&&Eb(a.V)&&(a.v(p.Aa,'setFocus("%s")\n',b.id||b.nodeName),b.focus(),b.scrollIntoView())}function ac(a,b,c){if(b!=a.U||c!=a.$)a.U=b,a.$=c,a.Z&&a.Z(b,c)}
var gc=1,hc=2,ic=3,Kb="surface",Ob="keyCode",Pb="idMap",Qb="switch",pc=3,nc=170,qc=512,oc=3584,sc={},mc=(sc[C.vc]=2,sc[C.yb]=8,sc[C.Wd]=32,sc[C.Xc]=128,sc[C.Ya]=qc,sc[C.Re]=1024,sc[C.ef]=2048,sc);u.Input=Jb;
function tc(a,b,c){F.call(this,a,b,c,["color","backgroundColor"]);a=this.ea[uc];if(!a)throw Error("LED "+this.J.ea[uc]+" binding for '"+uc+"' missing");b=document.createElement("canvas");if(!b||!b.getContext)throw a.innerHTML="LED device requires HTML5 canvas support",Error("LED device requires HTML5 canvas support");this.Ea=Za(this,uc)+".canvas";b.setAttribute("id",this.Ea);this.type=bb(v(this,"type",vc,wc),xc,yc);this.j=zc[this.type][0];this.s=zc[this.type][1];this.width=v(this,"width",this.j);
this.height=v(this,"height",this.s);this.l=v(this,"cols",1);this.K=this.l+v(this,"colsExtra",0);this.$=v(this,"rows",1);this.N=this.$+v(this,"rowsExtra",0);this.fa=this.width*this.l;this.U=this.height*this.$;this.o=Ac("black",0);this.i=Bc(this.J.color)||this.o;this.wa=Ac(this.i,1,.25);this.pa=Ac(this.i,1,2);this.m=Bc(this.J.backgroundColor);this.xa=v(this,"fixed",!1);this.xa||(b.style.width="100%",b.style.height="auto");this.oa=v(this,"hexagonal",!1);this.Da=v(this,"highlight",!0);this.S=v(this,"persistent",
this.type<yc);b.setAttribute("width",this.fa.toString());b.setAttribute("height",this.U.toString());b.style.backgroundColor=this.o;a.appendChild(b);this.ka=b.getContext("2d");if(this.u=document.createElement("canvas"))this.u.width=this.ca=this.j*this.l,this.u.height=this.H=this.s*this.$,this.h=this.u.getContext("2d");this.Ka=(this.N+1)*this.K*4;this.g=Array(this.Ka);this.Ta=this.l<this.K?4*(this.K-this.l):0;this.L=this.M=!1;this.I=this.Z=0;this.Y=-1;var d=this;this.time=G(this,"Time");Cc(this.time,
function(e,g){Dc(d,!1,e,g)});Ec(d)}n(tc,F);function Ec(a){for(var b=a.g,c=0;c<b.length;c+=4){var d=a,e=b,g=c;e[g]=d.type<yc?Fc:" ";e[g+1]=d.i==d.o?null:d.i;e[g+2]=0;e[g+3]=Gc}a.L=a.M=!0;Dc(a,!0)}function Hc(a){a.m?(a.h.fillStyle=a.m,a.h.fillRect(0,0,a.ca,a.H)):a.h.clearRect(0,0,a.ca,a.H)}
function Dc(a,b,c,d){b=void 0===b?!1:b;c=void 0===c?0:c;d=void 0===d?60:d;if(a.L||b){if(a.type<yc){d=0;if(!a.S||b)Hc(a);else if(a.I){d=a.l-a.I;var e=a.j*d;a.h.drawImage(a.u,a.j*a.I,0,e,a.H,0,0,e,a.H)}for(var g=e=0;g<a.N;g++){for(var h=0;h<a.l;h++){var k=a.g[e],l=a.g[e+1]||a.o,r=a.Da&&e==a.Y;if(a.g[e+3]&Gc||r||b){if(h>=d)a:{var t=a,q=k;k=l;var x=h;l=g;var w=r;x=void 0===x?0:x;l=void 0===l?0:l;w=void 0===w?!1:w;var z=0;if(t.oa&&!(l&1)&&(z=t.j>>1,x==t.l-1))break a;if(k&&k!=t.i){w=w?Ac(k,1,2):k;var y=
Ac(k,1,.25)}else w=w?t.pa:t.i,y=t.wa;k=!1;q=q?w:y;w==t.o&&(q=t.m,k=!0);w=x*t.j+z;y=l*t.s;t.S&&(x=x*t.j+z,l*=t.s,t.m?(t.h.fillStyle=t.m,t.h.fillRect(x,l,t.j,t.s)):t.h.clearRect(x,l,t.j,t.s));t.h.fillStyle=q;l=Ic[t.type];3==l.length?(t.h.beginPath(),t.h.arc(w+l[0],y+l[1],l[2],0,2*Math.PI),k?(t.h.globalCompositeOperation="destination-out",t.h.fill(),t.h.globalCompositeOperation="source-over"):t.h.fill()):t.h.fillRect(w+l[0],y+l[1],l[2],l[3])}a.g[e+3]=r?a.g[e+3]|Gc:a.g[e+3]&~Gc}e+=4}e+=a.Ta}a.I=0}else{b=
"";for(d=0;d<a.g.length;d+=4)b+=a.g[d]||" ",a.g[d+3]&Jc&&(b+=".");Hc(a);for(g=e=d=0;d<b.length;d++){l=b[d];"."==l&&e&&e--;h=a;r=e;t=g;r=void 0===r?0:r;t=void 0===t?0:t;if(l=Kc[l])for(k=0;k<l.length;k++)if(x=h,z=Lc[l[k]]){q=(void 0===r?0:r)*x.j;w=(void 0===t?0:t)*x.s;x.h.fillStyle=x.i;x.h.beginPath();if(3==z.length)x.h.arc(q+z[0],w+z[1],z[2],0,2*Math.PI);else for(y=0;y<z.length;y+=2)y?x.h.lineTo(q+z[y],w+z[y+1]):x.h.moveTo(q+z[y],w+z[y+1]);x.h.closePath();x.h.fill()}if(++e==a.l&&(e=0,++g==a.N))break}}a.ka.globalCompositeOperation=
a.m&&a.i!=a.o?"source-over":"copy";a.ka.drawImage(a.u,0,0,a.ca,a.H,0,0,a.fa,a.U);a.L=!1;a.Y=-1}else a.S||a.M||(!c||!a.Z||c-a.Z>=(1E3/d|0))&&Ec(a);a.M=!1;c&&(a.Z=c)}function Bc(a){return(a=a||void 0)&&xb[a]||a}
function Ac(a,b,c){b=void 0===b?1:b;c=void 0===c?1:c;if(a){var d=[];a=xb[a]||a;var e=16;var g=a.match(/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i);g||(e=10,g=a.match(/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,?\s*(\d+|)\)$/i));if(g){var h;for(h=1;h<g.length;h++)d[h-1]=Number.parseInt(g[h],e);d.length=h-1;e=!0}else e=!1;if(e){a="rgba(";for(e=0;3>e;e++)g=Math.round(d[e]*c),g=0>g?0:255<g?255:g,a+=g+",";a+=(e<d.length?d[e]:b)+")"}}return a}
tc.prototype.ya=function(a){var b=a.shift(),c=a.shift();a=a.shift();if(b==this.i&&c==this.m&&a&&a.length==this.g.length){this.g=a;for(b=0;b<=this.g.length-4;b+=4)this.g[b+1]==this.o&&(this.g[b+1]=null);Dc(this,!0);return!0}return!1};tc.prototype.za=function(a){this.g&&(a.push(this.i),a.push(this.m),a.push(this.g))};function Mc(a,b,c,d,e){e=(void 0===e?0:e)&Nc;b=4*(c*a.K+b);if(b<=a.g.length-4){if(a.g[b]!==d||(a.g[b+3]&Nc)!==e)a.g[b]=d,a.g[b+3]=a.g[b+3]&~Nc|e|Gc,a.L=!0;a.Y=b;a.M=!0;a.I=0}}
var xc=0,vc=1,yc=3,wc={small:xc,round:vc,square:2,digit:yc},uc="container",Fc=0,Nc=129,Jc=1,Gc=128,Oc={},Ic=(Oc[xc]=[4,4,4],Oc[vc]=[16,16,14],Oc[2]=[2,2,28,28],Oc),zc=[[8,8],[32,32],[32,32],[96,128]],Lc={A:[30,8,79,8,67,19,37,19],B:[83,10,77,52,67,46,70,22],C:[77,59,71,100,61,89,64,64],D:[28,91,58,91,69,104,15,104],E:[18,59,28,64,25,88,12,100],F:[24,10,34,21,31,47,18,52],G:[24,56,34,50,60,50,71,56,61,61,33,61],P:[80,102,8]},Kc={" ":[],0:"ABCDEF".split(""),1:["B","C"],2:["A","B","D","E","G"],3:["A",
"B","C","D","G"],4:["B","C","F","G"],5:["A","C","D","F","G"],6:"ACDEFG".split(""),7:["A","B","C"],8:"ABCDEFG".split(""),9:"ABCDFG".split(""),A:"ABCEFG".split(""),B:["C","D","E","F","G"],C:["A","D","E","F"],D:["B","C","D","E","G"],E:["A","D","E","F","G"],F:["A","E","F","G"],"-":["G"],".":["P"]};u.LED=tc;
function Pc(a,b,c){F.call(this,a,b,c);var d=this;this.Jf=this.J.touchType;this.Ff=this.J.diagnostics;this.K=this.J.monitorWidth||640;this.s=this.J.monitorHeight||480;this.i=this.ea[Qc.Bb];if(!this.i)throw Error("unable to find binding: "+Qc.Bb);this.g=this.La(Qc.ce)||this.i;b=this.ea[Qc.Ad];if(!b){b=document.createElement("canvas");if(a=Za(this,Qc.Ad))this.ea[a]=b,b.setAttribute("id",a);b.setAttribute("class","pcjs-surface");b.setAttribute("width",this.J.monitorWidth);b.setAttribute("height",this.J.monitorHeight);
b.style.backgroundColor=this.J.monitorColor||"black";this.i.appendChild(b)}this.j=b;this.o=a=b.getContext("2d");hb("MSIE")&&(this.i.onresize=function(h,k,l,r){return function(){k.style.height=(h.clientWidth*r/l|0)+"px"}}(this.i,b,this.J.monitorWidth,this.J.monitorHeight),this.i.onresize());(c=+(this.J.aspect||db().aspect))&&.3<=c&&3.33>=c&&(kb(function(h,k,l){return function(){k.style.height=(h.clientWidth/l|0)+"px"}}(this.i,b,c)),window.onresize());this.Da=this.wa=this.V.vb=!1;if(c=this.ea[Qc.ld])if(b=
Xa(this.g,"requestFullscreen")){this.g.Nb=this.g[b];this.Da=!0;this.wa=document.fullscreenEnabled||hb("Edge/");if(b=Xa(document,"on","fullscreenchange")){var e=Xa(document,"fullscreenElement");document.addEventListener(b,function(){Rc(d,null!=document[e])},!1)}(b=Xa(document,"on","fullscreenerror"))&&document.addEventListener(b,function(){Rc(d)},!1)}else this.v("Full-screen API not available\n"),c.parentNode.removeChild(c);if(this.Jf||this.Ff||this.Da&&!hb("iOS")){var g=document.createElement("textarea");
if(b=Za(this,Qc.Te))this.ea[b]=g,g.setAttribute("id",b);g.setAttribute("class","pcjs-overlay");hb("iOS")&&(Ta(g),g.style.fontSize="16px");this.i.appendChild(g)}(this.m=G(this,"Input",!1))&&Lb(this.m,g||this.i,this.La(this.J.focusBinding,!0));this.mf=this.K;this.Ef=this.s;g=this.J.smoothing;(b=db().smoothing)&&(g="true"==b);this.nb=g;this.Uc=Xa(a,"imageSmoothingEnabled");if(this.h=this.J.monitorRotate)this.h=this.h%360,0<this.h&&(this.h-=360),-90!=this.h?(this.v("unsupported monitor rotation: %d\n",
this.h),this.h=0):(a.translate(0,this.s),a.rotate(this.h*Math.PI/180),a.scale(this.s/this.K,this.K/this.s))}n(Pc,F);Pc.prototype.Ua=function(a,b){var c=this;switch(a){case Qc.ld:b.onclick=function(){c.V.vb=1>=window.outerHeight-window.innerHeight;c.V.vb||c.Nb()}}F.prototype.Ua.call(this,a,b)};function Sc(a){a.o&&(a.o.fillStyle="black",a.o.fillRect(0,0,a.j.width,a.j.height))}
Pc.prototype.Nb=function(){var a=!1;if(this.g&&this.g.Nb){a="100%";if(screen&&screen.width&&screen.height){var b=screen.width/screen.height,c=this.K/this.s;b>c&&(a=Math.round(c/b*100)+"%")}this.wa?(this.j.style.width=a,this.j.style.height="auto",this.j.style.display="block",this.j.style.margin="auto"):(this.g.style.width=a,this.g.style.height="auto");this.Gb=this.g.style.backgroundColor;this.g.style.backgroundColor="black";this.g.Nb();this.m&&(a=this.m,a.I=!0,Xb(a));a=!0}return a};
function Rc(a,b){a.V.vb=!0;b||(a.g&&(a.wa?a.j.style.width=a.j.style.height="":a.g.style.width=a.g.style.height="",a.Gb&&(a.g.style.backgroundColor=a.Gb)),a.V.vb=!1);a.m&&!b&&(a=a.m,a.I=!1,Xb(a))}Pc.prototype.ra=function(a){a?(Tc(this),Uc(this)):Sc(this)};Pc.prototype.ma=function(){Sc(this)};var Qc={ce:"container",Ad:"surface",Bb:"monitor",Te:"overlay",ld:"fullScreen"};u.Monitor=Pc;
function Vc(a,b,c){F.call(this,a,b,c);this.Ea=v(this,"cyclesMinimum",1E5);this.lb=v(this,"cyclesMaximum",1E9);this.ka=bb(v(this,"cyclesPerSecond",1E6),this.Ea,this.lb);this.ca=60;this.Y=0;this.Z=1E3/this.ca;this.nb=v(this,"updatesPerSecond",2)||2;this.Gb=1E3/this.nb;this.jb=0;this.Hb=v(this,"timeLock",!0);this.xa=this.K=0;this.wa=this.m=1;this.Ta=this.s=this.ka/1E4/100;this.oa=[];this.o=[];this.h=[];this.S=[];this.Ka=this.g=this.U=this.H=!1;this.I=this.j=0;a=Xa(window,"requestAnimationFrame");if(!a){a=
"setTimeout";var d=this.Z}this.ob=window[a].bind(window,this.Jk.bind(this),d);this.Fb=window[Xa(window,"cancelAnimationFrame")||"clearTimeout"].bind(window);this.$=this.N=this.l=this.i=this.fa=this.Da=0;Wc(this)||Xc(this,this.wa)}n(Vc,F);function Cc(a,b){a.oa.push(b)}f=Vc.prototype;
f.Ua=function(a,b){var c=this;switch(a){case Yc:b.onclick=function(){Zc(c)&&(c.g?$c(c):c.start())};break;case ad:b.onclick=function(){Xc(c,c.m<<1);bd(c,cd(c.s))};break;case dd:b.onclick=function(){ed(c)};break;case fd:b.addEventListener("mousedown",function(){c.H=!0}),b.addEventListener("mouseup",function(){Wc(c);c.H=!1}),b.addEventListener("mousemove",function(){c.H&&Wc(c)}),b.addEventListener("change",function(){c.H=!0;Wc(c);c.H=!1})}F.prototype.Ua.call(this,a,b)};
function Ub(a,b,c){var d=void 0===d?-1:d;var e=a.h.length+1;a.h.push({id:b,lf:c,Pb:d,Fa:-1});0<=d&&ec(a,e,d);return e}
function gd(a,b,c,d){var e=0,g=a.s,h=1E6*g;b&&c&&(g=b/(10*c)/100,a.v(p.kb,"calcSpeed(%d cycles, %5.3fms): %5.3fMhz\n",b,c,g),d>a.Z&&(1<a.m&&(a.m>>=1,a.v(p.Eb,"frame time (%5.3fms) exceeded maximum (%5.3fms), target multiplier now %d\n",d,a.Z,a.m)),e=d));a.K=g;a.xa=g/a.Ta;b=a.xa/a.m;a.fa=h/b/a.ca+1E-8;a.v(p.kb,"nCyclesDepositPerFrame(%5.3f) = nCyclesPerSecond(%d) / nDivisor(%5.3f) / nFramesPerSecond(%d)\n",a.fa,h,b,a.ca);return e}
function hd(a,b){a.N=a.l=b;if(!a.o.length)return a.l=0,a.N;for(var c=0;0<a.l;){if(c<a.o.length){var d=a.o[c++];b=d.Kk.call(d,b)||1}else c=b=0;a.l-=b}return a.N-a.l}function id(a,b){b=void 0===b?a.N-a.l:b;if(!a.g){if(a.i)for(var c=0;c<a.o.length;c++){var d=a.o[c];d.Lk.call(d)}a.i=b}a.i-=b;1>a.i&&(a.U=!0);a.Da+=b;a.$+=b;a.N=a.l=0;a.g||(a.$=0);return b}function jd(a){for(var b=0,c=0;c<a.o.length;c++){var d=a.o[c];b+=d.Od.call(d)}return a.Da+(a.N-a.l)+b}
function kd(a,b){return Math.ceil(a.ka*(a.Hb?a.wa:a.xa)/1E3*(void 0===b?1E3:b))}function ld(a,b){b=void 0===b?0:b;if(b){var c=b;a.i+=b}else for(c=a.i,1>c&&(c=a.i+=a.fa),0>c&&(a.v(p.kb,"warning: cycle count dropped below zero: %f\n",c),c=a.i=0),c|=0,b=a.h.length;0<b;b--){var d=a.h[b-1];!(0>d.Fa)&&c>d.Fa&&(c=d.Fa)}return c}function cd(a){1<=a?a=a.toFixed(2)+"Mhz":(a=Math.round(1E6*a),a=999>=a?a+"Hz":Math.ceil(a/1E3)+"Khz");return a}
function md(a){a.v(p.kb,"getSpeedCurrent(%5.3fhz)\n",1E6*a.K);return a.g&&a.K?cd(a.K):"Stopped"}function Zc(a){return a.Ka?!0:(a.v("not powered\n"),!1)}function nd(a,b){if(1<=b)for(var c=a.h.length;0<c;c--){var d=a.h[c-1];0>d.Fa||(d.Fa-=b,0>=d.Fa&&(d.Fa=-1,d.lf(),0<=d.Pb&&ec(a,c,d.Pb)))}}f.ra=function(a){this.Ka=a;void 0===this.ba&&(this.ba=G(this,"Debugger",!1))&&this.ba.Jb(this,"time","dump time state",this.Df)};function ed(a,b){Zc(a)&&(a.g?a.v("already running\n"):a.j?$c(a):od(a,b))}
f.Jk=function(a){a=void 0===a?Date.now():a;this.I=0;if(this.g){if(this.Y){var b=a-this.Y;1>b&&(b=16.67);this.ca=1E3/b}this.Y=a;a=Date.now();this.L&&(b=a-this.M-this.Z,b>this.Z&&(this.u+=b,this.v(p.Eb,"browser throttling detected, compensating by %5.3fms\n",b)));this.M=a;this.u||(this.u=a);this.pa=0;try{this.U=!1;do nd(this,id(this,hd(this,ld(this))));while(this.g&&!this.U)}catch(c){this.v("%s\n",c.message),$c(this)}this.L=Date.now();this.pa&&(this.u+=this.pa,this.M+=this.pa);this.M+=gd(this,this.$,
this.L-this.u,this.L-this.M);this.L-this.jb>=this.Gb&&this.update();for(a=0;a<this.oa.length;a++)this.oa[a](this.Y,this.ca);this.I=this.ob()}};function Xc(a,b){if(void 0!==b){if(1>b||!a.H&&0<a.K&&a.K<.9*a.s)b=a.wa;a.m=b;b=a.Ta*a.m;a.s!=b&&(a.s=b,bd(a,cd(a.s)))}a.u=a.L=0;a.i=a.$=0;gd(a);for(b=a.h.length;0<b;b--){var c=a.h[b-1];0<=c.Pb&&ec(a,b,c.Pb,!0)}}function Wc(a){var b=a.ea[fd];return b?(Xc(a,Math.floor((b.value-b.min)/(b.max-b.min)*(a.lb-a.Ea)+a.Ea)/a.ka|0),!0):!1}
function ec(a,b,c,d){0<b&&b<=a.h.length&&(b=a.h[b-1],d||0>b.Fa)&&(c=kd(a,c),a.g&&(c+=id(a)),b.Fa=c)}f.start=function(){if(this.g||this.j)return!1;this.g=!0;this.u=this.L=this.Y=0;this.update(!0);this.I=this.ob();return!0};function od(a,b){b=void 0===b?1:b;a.g||(b&&!a.j&&(a.j=b),a.j&&(a.j--,nd(a,id(a,hd(a,ld(a,1)))),a.update(!1),a.j&&setTimeout(function(){od(a,0)},0)))}function $c(a){return a.g?(a.g=!1,id(a),a.I&&(a.Fb(a.I),a.I=0),a.update(!0),!0):a.j?(a.j=0,a.update(!0),!0):!1}
f.update=function(a){a&&this.v(this.g?"started with %s target\n":"stopped\n",cd(this.s));rb(this,Yc,this.g?"Halt":"Run");rb(this,dd,this.j?"Stop":"Step");this.H||bd(this,md(this));for(var b=0;b<this.S.length;b++){var c=this.S[b];c.Jc.call(c,void 0!=a)}this.jb=Date.now();this.U=!0};function bd(a,b){rb(a,pd,b);rb(a,ad,b)}
f.Df=function(){var a=this.O("nCyclesPerSecond: %f\n",this.ka);a+=this.O("nUpdatesPerSecond: %f\n",this.nb);a+=this.O("nTargetMultiplier: %f\n",this.m);return a+=this.O("nCyclesDepositPerFrame: %f\n",this.fa)};var Yc="run",ad="setSpeed",pd="speed",dd="step",fd="throttle";u.Time=Vc;
function qd(a,b,c){F.call(this,a,b,c);this.type="static"==this.J.type?rd:sd;this.ha=this.J.addrWidth||16;this.m=Math.pow(2,this.ha);this.l=this.m-1|0;this.blockSize=this.J.blockSize||(16<this.ha?4096:1024);this.blockSize>this.m&&(this.blockSize=this.m);this.H=this.m/this.blockSize|0;this.h=Math.log2(this.blockSize)|0;this.i=(1<<this.h)-1;this.j=this.J.dataWidth||8;this.u=Math.pow(2,this.j)-1;this.o=!1!==this.J.littleEndian;this.g=Array(this.H);this.s=0;a=new td(a,b+"[NONE]",{size:this.blockSize,bus:this.W});
for(b=0;b<this.m;b+=this.blockSize)ud(this,b,this.blockSize,vd.NONE,a);wd(this,this.type)}n(qd,F);function ud(a,b,c,d,e){for(var g=b>>>a.h;0<c&&g<a.g.length;){var h=g*a.blockSize,k=a.blockSize-(b-h);k>c&&(k=c);var l=a.g[g];if(b!=h||k!=a.blockSize||l&&l.type!=vd.NONE)return!1;l=a.W+"["+Ja(a,b,16,a.ha)+"]";b=e?e.size==a.blockSize?e:new td(a.aa,l,{type:d,ta:b,size:k,bus:a.W}):new td(a.aa,l,{type:d,ta:b,size:k,bus:a.W});a.g[g]=b;b=h+a.blockSize;c-=k;g++}return!0}
function xd(a,b){for(var c=vd.bf,d=0,e=0;e<a.g.length;e++){var g=a.g[e];g&&g.type&c&&(b(g),d++)}return d}function yd(a,b,c){a.ba&&a.ba.v(p.hd,"bus fault (%d) at %n\n",c,b)}f=qd.prototype;f.ra=function(){void 0===this.ba&&(this.ba=G(this,"Debugger",!1))};f.ma=function(){};f.Rb=function(a){return a&&this.ya(a)?!0:!1};f.bb=function(a){this.za(a)};f.ya=function(a){for(var b=0;b<this.g.length;b++){var c=this.g[b];if((this.type==sd||c.type&vd.$a)&&c.ya){var d=a.shift();if(!c.ya(d))return!1}}return!0};
f.za=function(a){for(var b=0;b<this.g.length;b++){var c=this.g[b];if((this.type==sd||c.type&vd.$a)&&c.za){var d=[];c.za(d);a.push(d)}}};f.Kc=function(a){return this.g[a>>>this.h].Kc(a&this.i)};f.ye=function(a){return this.g[a>>>this.h].na(a&this.i)};f.Pc=function(a,b){this.g[a>>>this.h].Pc(a&this.i,b)};f.Ja=function(a,b){this.g[a>>>this.h].sa(a&this.i,b)};f.nd=function(a){return a&1?this.na(a+1&this.l)|this.na(a)<<this.j:this.g[a>>>this.h].ua(a&this.i)};
f.od=function(a){return a&1?this.na(a)|this.na(a+1&this.l)<<this.j:this.g[a>>>this.h].ua(a&this.i)};f.Ck=function(a){return(a&this.i)==this.i?this.o?this.od(a):this.nd(a):this.g[a>>>this.h].ua(a&this.i)};f.pd=function(a,b){a&1?(this.sa(a,b>>this.j),this.sa(a+1&this.l,b&this.u)):this.g[a>>>this.h].ja(a&this.i,b)};f.qd=function(a,b){a&1?(this.sa(a,b&this.u),this.sa(a+1&this.l,b>>this.j)):this.g[a>>>this.h].ja(a&this.i,b)};
f.Nk=function(a,b){(a&this.i)==this.i?this.o?this.qd(a,b):this.pd(a,b):this.g[a>>>this.h].ja(a&this.i,b)};function wd(a,b){var c=a.s;a.s+=b;c&&a.s||(a.na=a.ye,a.sa=a.Ja,a.type==sd?(a.ua=a.Ck,a.ja=a.Nk):a.o?(a.ua=a.od,a.ja=a.qd):(a.ua=a.nd,a.ja=a.pd))}f.Tb=function(a,b){return this.g[a>>>this.h].Tb(b)?(wd(this,1),!0):!1};f.Mc=function(a,b){return this.g[a>>>this.h].Mc(b)?(wd(this,1),!0):!1};f.Ub=function(a,b){return this.g[a>>>this.h].Ub(b)?(wd(this,-1),!0):!1};
f.Oc=function(a,b){return this.g[a>>>this.h].Oc(b)?(wd(this,-1),!0):!1};var rd=0,sd=1;u.Bus=qd;
function td(a,b,c){F.call(this,a,b,c);this.ta=this.J.addr;this.size=this.J.size;this.type=this.J.type||vd.NONE;this.j=(a=this.J.bus)?yb(this,a):G(this,a="Bus");if(!this.j)throw Error(this.O("unable to find bus '%s'",a));this.g=this.j.j;this.i=Math.pow(2,this.g)-1;this.L=this.ca=!1;this.m=!1!==this.j.o;this.values=this.$=this.H=this.Z=null;a=this.Za;b=this.Ja;c=this.m?this.Ek:this.Dk;var d=this.m?this.Pk:this.Ok;this.j.type==rd&&(b=this.Qc,c=this.m?this.Ae:this.ze,d=this.Tc,8==this.g&&!1!==Cb(this,
"ArrayBuffer")&&(this.ca=!0,c=this.m==wa?this.Gk:this.Hk));switch(this.type){case vd.NONE:this.na=this.Xa;this.sa=this.Na;this.ua=this.Fk;this.ja=this.Qk;break;case vd.vd:this.na=a;this.sa=this.Na;this.ua=c;this.ja=this.Na;break;case vd.$a:this.na=a,this.sa=b,this.ua=c,this.ja=d}this.M=this.l=0;this.Y=this.o=this.U=this.K=this.s=this.u=null;zd(this,this.J.values);Ad(this)}n(td,F);
function zd(a,b){"string"==typeof b?(Fb(a,!1),cb(b,function(c,d,e,g){if(4==e)if(!g&&d){try{var h=JSON.parse(d);zd(a,h.values)}catch(k){a.v("error (%s) parsing resource: %s\n",k.message,c)}Fb(a,!0)}else a.v("error (%d) loading resource: %s\n",g,c)})):a.J.values=b}
function Ad(a,b){if(a.type>vd.NONE&&(a.ca?(a.H=new ArrayBuffer(a.size),a.Z=new DataView(a.H,0,a.size),a.values=new Uint8Array(a.H,0,a.size),a.$=new Uint16Array(a.H,0,a.size>>1),new Int32Array(a.H,0,a.size>>2)):a.values=Array(a.size).fill(0),b))for(var c=0;c<b.length;c++)a.values[c]=b[c]}f=td.prototype;
f.ma=function(){if(this.J.values)a:{var a=this.j,b=this.ta,c=this.size,d=this.J.values,e=0,g=b&a.i;b>>>=a.h;c>d.length&&(c=d.length);for(;0<c&&b<a.g.length;){var h=a.g[b++];if(!h)break a;for(;0<c&&g<h.size;)h.Ja(g++,d[e++]),c--;g=0}}else this.type&vd.$a&&this.values&&this.values.fill(0)};f.Xa=function(){return this.i};f.Fk=function(a){return this.m?this.Xa(a)|this.Xa(a+1)<<this.g:this.Xa(a+1)|this.Xa(a)<<this.g};f.Kc=function(a){return this.values?this.values[a]:0};f.Za=function(a){return this.values[a]};
f.ze=function(a){return this.values[a+1]|this.values[a]<<this.g};f.Ae=function(a){return this.values[a]|this.values[a+1]<<this.g};f.Gk=function(a){return this.$[a>>>1]};f.Hk=function(a){return this.Z.getUint16(a,this.m)};f.Dk=function(a){return this.Za(a+1)|this.Za(a)<<this.g};f.Ek=function(a){return this.Za(a)|this.Za(a+1)<<this.g};f.Na=function(){};f.Qk=function(a,b){this.m?(this.Na(a,b&this.i),this.Na(a+1,b>>this.g)):(this.Na(a,b>>this.g),this.Na(a+1,b&this.i))};
f.Pc=function(a,b){this.values&&(this.values[a]=b)};f.Ja=function(a,b){this.values[a]=b};f.Qc=function(a,b){this.values[a]=b;this.L=!0;this.l?this.K=this.Ja:this.sa=this.Ja};f.hc=function(a,b){this.values[a]=b>>this.g;this.values[a+1]=b&this.i};f.ic=function(a,b){this.values[a]=b&this.i;this.values[a+1]=b>>this.g};f.Rc=function(a,b){this.$[a>>>1]=b};f.Sc=function(a,b){this.Z.setUint16(a,b,this.m)};f.Ok=function(a,b){this.Ja(a,b>>this.g);this.Ja(a+1,b&this.i)};
f.Pk=function(a,b){this.Ja(a,b&this.i);this.Ja(a+1,b>>this.g)};f.Tc=function(a,b){this.H?this.m==wa?(this.Rc(a,b),this.l?this.o=this.Rc:this.ja=this.Rc):(this.Sc(a,b),this.l?this.o=this.Sc:this.ja=this.Sc):this.m?(this.ic(a,b),this.l?this.o=this.ic:this.ja=this.ic):(this.hc(a,b),this.l?this.o=this.hc:this.ja=this.hc)};
f.Tb=function(a){if(!this.M){var b=this;this.M++;this.s=a;this.U=this.na;this.Y=this.ua;this.na=function(c){var d=b.U(c);b.s(b.ta,c,d);return d};this.ua=function(c){var d=b.Y(c);b.s(b.ta,c,d);b.s(b.ta,c+1,d);return d};return!0}return this.s==a?(this.M++,!0):!1};f.Mc=function(a){if(!this.l){var b=this;this.l++;this.u=a;this.K=this.sa;this.o=this.ja;this.sa=function(c,d){b.u(b.ta,c,d);b.K(c,d)};this.ja=function(c,d){b.u(b.ta,c,d);b.u(b.ta,c+1,d);b.o(c,d)};return!0}return this.u==a?(this.l++,!0):!1};
f.Ub=function(a){return this.M&&this.s==a?(--this.M||(this.na=this.U,this.ua=this.Y,this.U=this.Y=this.s=null),!0):!1};f.Oc=function(a){return this.l&&this.u==a?(--this.l||(this.sa=this.K,this.ja=this.o,this.K=this.o=this.u=null),!0):!1};f.ya=function(a){if(a){var b=a.shift();if(this.W==b){this.L=a.shift();a.shift();if(a=a.shift()){var c=this.size;c=void 0===c?0:c;if(a.length!=c){b=0;c=c?Array(c):[];for(var d=0;d<a.length-1;)for(var e=a[d++],g=a[d++];e--;)c[b++]=g;a=c}Ad(this,a)}return!0}}return!1};
f.za=function(a){a.push(this.W);a.push(this.L);a.push(!1);if(this.values){var b=this.values;for(var c=0,d=0,e=[];c<b.length;){for(var g=b[c],h=c+1;h<b.length&&b[h]===g;)h++;e[d++]=h-c;e[d++]=g;c=h}b=e.length>=b.length?b:e}else b=this.values;a.push(b)};var vd={NONE:1,vd:2,$a:4,bf:14,Fl:12};u.Memory=td;function Bd(a,b,c){td.call(this,a,b,c);this.I=[];this.N=[];this.h=[];this.S=[];void 0!=this.J.addr&&ud(this.j,this.J.addr,this.J.size,vd.NONE,this)}n(Bd,td);
function Cd(a,b,c,d){d=void 0===d?0:d;for(var e in c){var g=c[e],h=void 0,k=a,l=b,r=+e+d,t=g[0],q=g[1],x=g[2],w=g[3];for(g=+e+d;g<=r;g++){h=!1;if(t){if(k.I[g])break;k.I[g]=t.bind(l)}if(q){if(k.N[g])break;k.N[g]=q.bind(l)}if(x){if(k.h[g])break;k.h[g]=x.bind(l)}if(w){if(k.S[g])break;k.S[g]=w.bind(l)}h=!0}if(!h)throw Error(k.O("handler for port %#0x already exists",g));}}
Bd.prototype.Xa=function(a){var b,c=this.ta+a;if(b=this.I[c]){var d=b(c);var e=!0}else if(b=this.h[c])d=c&1?b(c&-2)>>this.g:b(c)&this.i,e=!0;else if(c&1)if(c&=-2,b=this.h[c])d=b(c)>>this.g,e=!0;else if(b=this.I[c])d=b(c),e=!0;e||(yd(this.j,c,0),this.v(p.qa+p.pc,"readNone(%#04x): unknown port\n",c),d=td.prototype.Xa.call(this,a));return d};
Bd.prototype.Na=function(a,b){var c,d=this.ta+a;if(c=this.N[d]){c(d,b);var e=!0}else if(c=this.S[d])e=this.h[d]?this.h[d](d,!0):0,d&1?c(d,e&this.i|b<<this.g):c(d,e&~this.i|b),e=!0;else if(d&1)if(d&=-2,c=this.S[d])e=this.h[d]?this.h[d](d,!0):0,c(d,e&this.i|b<<this.g),e=!0;else if(c=this.N[d])c(d,b),e=!0;e||(yd(this.j,d,1),this.v(p.qa+p.pc,"writeNone(%#04x,%#04x): unknown port\n",d,b),td.prototype.Na.call(this,a,b))};u.Ports=Bd;
function Dd(a,b,c){c.type=vd.NONE;td.call(this,a,b,c);ud(this.j,this.J.addr,this.J.size,vd.$a);Gb(this,this.ma.bind(this))}n(Dd,td);u.RAM=Dd;
function Ed(a,b,c){c.type=vd.vd;td.call(this,a,b,c);ud(this.j,this.J.addr,this.J.size,this.J.type,this);Gb(this,this.ma.bind(this));this.X=this.ba=void 0;if(u.LED&&this.ea[Fd]){var d=this;this.I=Math.pow(2,Math.ceil(Math.log2(this.values.length)/2));this.N=this.values.length/this.I|0;this.h=new tc(a,b+"LEDs",{"class":"LED",bindings:{container:Za(this,Fd)},type:vc,cols:this.I,rows:this.N,color:v(this,"colorROM","green"),backgroundColor:v(this,"backgroundColorROM","black"),persistent:!0}),Ec(this.h);
this.S=new Jb(a,b+"Input",{"class":"Input",location:[0,0,this.h.fa,this.h.U,this.I,this.N],bindings:{surface:Za(this,Fd)}});this.fa=$a(this)||"";Mb(this.S,function(e,g){if(d.X){var h=d.fa;0<=e&&0<=g&&(e=g*d.I+e,g=d.X,h=g.ba&&Gd(g.ba,d.ta+e,1)||"");rb(d,ab,h)}})}}n(Ed,td);
Ed.prototype.ya=function(a){var b=!0,c=a.shift();if(c&&this.h){var d=c.length;this.h.g.length==d?(this.h.g=c,Dc(this.h,!0)):(this.v("inconsistent saved LED state (%d), unable to load\n",d),b=!1)}a.length&&(d=(a=a.shift())&&a.length||-1,this.values.length==d?this.values=a:(this.v("inconsistent saved ROM state (%d), unable to load\n",d),b=!1));return b};Ed.prototype.ra=function(){void 0===this.X&&(this.X=G(this,"CPU"));void 0===this.ba&&(this.ba=G(this,"Debugger",!1))&&this.ba.Dc&&this.ba.Dc(this.J.symbols)};
Ed.prototype.Za=function(a){this.h&&Mc(this.h,a%this.I,a/this.I|0,1,Gc);return this.values[a]};Ed.prototype.za=function(a){this.h&&(a.push(this.h.g),a.push(this.values))};var Fd="array",ab="cellDesc";u.ROM=Ed;function Hd(a,b,c){c["class"]="CPU";F.call(this,a,b,c);this.ba=void 0;this.u=this.sb=0;this.ca=this.J.addrReset||0;this.time=G(this,"Time");this.time.o.push(this);this.time.S.push(this);this.U=this.g=0}n(Hd,F);f=Hd.prototype;f.abort=function(a){this.u=this.sb;this.v("%s\n",a.message);$c(this.time)};
function Id(a,b){a.ba=b;return a.fb}f.Nd=function(){};f.Kk=function(a){this.U=this.g=void 0===a?0:a;try{this.Nd()}catch(b){this.abort(b)}return this.Od()};f.Lk=function(){this.U-=this.g;this.g=0};f.Od=function(){return this.U-this.g};
function Jd(a,b,c){c["class"]="Debugger";F.call(this,a,b,c);var d=this;this.la=this.J.defaultRadix||16;this.ka=1;this.U=["(",")"];this.td("a",function(g,h,k,l,r){return Ja(d,r.da,d.la,k)});this.td("n",function(g,h,k,l,r){return Ja(d,r,d.la,k,0>h.indexOf("#")?"":void 0)});this.H=0;this.oa=p.NONE;this.K={};this.wa=[];this.xa=[];this.X=G(this,"CPU");this.fb=Id(this.X,this);this.Da=G(this,"Input",!1);if(a=this.X.J.busMemory||this.J.busMemory){this.g=yb(this,a);if(a=this.X.J.busIO||this.J.busIO)this.j=
yb(this,a,!1);this.j||(this.j=this.g)}else this.g=this.j=G(this,"Bus");this.I=this.g.ha;this.Ka=Math.pow(2,this.I)-1|0;this.s=this.ca=0;this.o=[];for(var e in H)this.o[H[e]]=[];this.m=[];this.m[H.Ha]=this.g;this.m[H.pb]=this.g;this.m[H.Aa]=this.j;this.m[H.hb]=this.j;this.l=[];this.l[H.Ha]=this.qf.bind(this);this.l[H.pb]=this.rf.bind(this);this.l[H.Aa]=this.nf.bind(this);this.l[H.hb]=this.pf.bind(this);this.i=[];this.L=void 0;this.S=null;this.Y=0;this.time=G(this,"Time");this.time.S.push(this);this.Z=
0;this.u=[];this.N="";this.Jb(this,"state","dump machine state",this.Cf);this.$=Kd();this.Ea=Kd();this.fa=!1;this.M=0;this.h=[];Va(this,this.Pf.bind(this));(e=Cb(this,"commands"))&&jb(this,e)}n(Jd,F);f=Jd.prototype;f.Jb=function(a,b,c,d){this.u.push({Af:a,name:b,zf:c,Wa:d})};function Ld(a,b,c){for(var d,e=0;e<a.u.length;e++){var g=a.u[e];if(g.name==b){d=g.Wa.call(g.Af,c);break}}return d}
f.Dc=function(a){if(a&&a.length)for(var b=0;b<a.length-2;b+=3){var c=Md(this,a[b]);if(c){var d=Nd[a[b+1]];if(d){c={address:c,type:d,name:a[b+2]};d=this.wa;var e=c,g=Od(d,e,this.Id);0>g&&d.splice(-(g+1),0,e);d=this.xa;e=Od(d,c,this.Jd);0>e&&d.splice(-(e+1),0,c)}}}};function Od(a,b,c){var d=0,e=a.length,g=0;for(void 0===c&&(c=function(l,r){return l>r?1:l<r?-1:0});d<e;){var h=d+e>>1,k=void 0;k=c(b,a[h]);0<k?d=h+1:(e=h,g=!k)}return g?d:~d}f.Id=function(a,b){return a.name>b.name?1:a.name<b.name?-1:0};
f.Jd=function(a,b){return a.address.da>b.address.da?1:a.address.da<b.address.da?-1:0};function Pd(a,b,c){b=Od(a.xa,{address:b,type:0,name:void 0},a.Jd);if(0<=b&&(a=a.xa[b],!c||a.type==c))var d=a.name;return d}function Qd(a,b,c,d){d=void 0===d?a.g:d;b.da=b.da+c&d.l}function Kd(a){a=void 0===a?0:a;var b=Rd.Xe;return"number"==typeof a?{da:a,Lc:-1,type:b}:{da:a.da,Lc:a.Lc,type:a.type}}
function Md(a,b,c){if(b){var d=Kd();var e=0,g=b.charAt(e);switch(g){case "&":e++;break;case "#":e++;d.type=Rd.Ye;break;case "%":e++,g=b.charAt(e),"%"==g?e++:d.type=Rd.ab}g=b.indexOf(":",e);if(0<=g){var h=Sd(a,b.substring(e,g),c);void 0==h?d=null:(d.Lc=h,e=g+1)}d&&(b=Sd(a,b.substring(e),c),void 0==b?d=null:d.da=b&a.Ka)}return d}function Td(a,b,c,d){d=void 0===d?a.g:d;a.s++;var e=d.Kc(b.da);c&&Qd(a,b,c,d);a.s--;return e}
function Ud(a,b,c){if(32>=a.I)return b&c;b=Vd(a,b,0,!0);c=Vd(a,c,0,!0);return((b/La|0)&(c/La|0))*La+((b&c)>>>0)}function Wd(a,b,c){if(32>=a.I)return b^c;b=Vd(a,b,0,!0);c=Vd(a,c,0,!0);return((b/La|0)^(c/La|0))*La+((b^c)>>>0)}
function Xd(a,b,c,d){for(d=void 0===d?-1:d;d--&&c.length;){var e=c.pop();if(2>b.length)return!1;var g=b.pop();var h=b.pop();switch(e){case "*":h*=g;break;case "/":if(!g)return!1;h=Math.trunc(h/g);break;case "^/":if(!g)return!1;h%=g;break;case "+":h+=g;break;case "-":h-=g;break;case "<<":h<<=g;break;case ">>":h>>=g;break;case ">>>":h>>>=g;break;case "<":h=h<g?1:0;break;case "<=":h=h<=g?1:0;break;case ">":h=h>g?1:0;break;case ">=":h=h>=g?1:0;break;case "==":h=h==g?1:0;break;case "!=":h=h!=g?1:0;break;
case "&":h=Ud(a,h,g);break;case "!":case "|":e=h;32>=a.I?h=e|g:(e=Vd(a,e,0,!0),g=Vd(a,g,0,!0),h=(e/La|0|g/La|0)*La+((e|g)>>>0));break;case "^!":h=Wd(a,h,g);break;case "&&":h=h&&g?1:0;break;case "||":h=h||g?1:0;break;case ",,":h=Vd(a,h,18,!0)*Math.pow(2,18)+Vd(a,g,18,!0);break;case "_":case "^_":"^_"==e&&(g=35-(g&255));g&&(h=Vd(a,h,0,!0),h=0<g?h*Math.pow(2,g):Math.trunc(h/Math.pow(2,-g)));break;default:return!1}b.push(Vd(a,h))}return!0}
function Yd(a,b,c,d,e,g){var h,k=!1,l=0,r=[],t=[],q=a.la;for(a.la=e;c<d;){var x=b[c++].trim();var w=c<d?b[c++]:"";if(x){var z=void 0;var y=a;var B=x,A=g;l=void 0===l?0:l;if(void 0!=B){z=Db(y,B.toUpperCase());if(void 0==z){z=void 0;var da=y,fa=Od(da.wa,{address:null,type:0,name:B},da.Id);0<=fa&&(z=da.wa[fa].address.da);if(void 0==z)if(z=B,y.K[z]?z=y.K[z].value:(z=z.substr(0,6),z=y.K[z]&&y.K[z].value),void 0==z)z=Ia(B,1<B.length||10<y.la?y.la:10);else if(B=y.K[B]&&y.K[B].Pl)A?A.push(B):(A=Sd(y,B,A),
void 0!==A?z+=A:z=void 0)}void 0!=z&&(z=Vd(y,Zd(y,z,l)))}y=z}else if("{"==w){x=1;for(y=c;c<d;)if(c++,w=c<b.length?b[c++]:"","{"==w)x++;else if("}"==w&&!--x)break;y=Yd(a,b,y,c-1,a.la,g);null!=y&&l&&(y=Zd(a,y,l));x=c<d?b[c++].trim():"";w=c<d?b[c++]:""}else{if(" "==w)continue;if("^B"==w){a.la=2;continue}if("^O"==w){a.la=8;continue}if("^D"==w){a.la=10;continue}if(!(l&-1073741824)){if("+"==w)continue;if("-"==w){l=l<<2|1;continue}if("~"==w||"^-"==w){l=l<<2|2;continue}if("^L"==w){l=l<<2|3;continue}}k=!0;
break}if(void 0===y)if(g)g.push(x),y=0;else{k=!0;break}r.push(Vd(a,y));if(" "==w)if(c<b.length-1&&!b[c])c++,w=b[c++];else{k=!0;break}if(!w)break;y="<"==a.U[0]?$d:ae;if(!y[w]){k=!0;break}t.length&&y[w]<=y[t[t.length-1]]&&Xd(a,r,t,1);t.push(w);a.la="^_"==w?10:e;l=0}if(k||!Xd(a,r,t)||1!=r.length)k=!0;k?g||a.v("parse error (%s)\n",x||w):h=r.pop();a.la=q;return h}
function be(a,b,c,d){for(var e,g=a.I/d|0;0<=(e=b.indexOf(c));){for(var h=0,k=e+1,l=g;k<b.length;){var r=b[k++];if(r==c){l=-1;break}if(!l)break;l--;r=r.charCodeAt(0);6==d&&(r-=32);r&=(1<<d)-1;h=Vd(a,h*Math.pow(2,d)+r,d*g,!0)}if(0<=l){a.v("parse error (%c%s%c)\n",c,b,c);return}b=b.substr(0,e)+Ja(a,h)+b.substr(k)}return b}
function Sd(a,b,c){if(b){"{"!=a.U[0]&&(b=b.split(a.U[0]).join("{").split(a.U[1]).join("}"));b=be(a,b,'"',8);if(!b)return d;b=be(a,b,"'",6);if(!b)return d;16!=a.la&&(b=b.replace(/(^|[^A-Z0-9$%.])([0-9]+)B/,"$1$2^_").replace(/\s+/g," "));b=b.split(/({|}|\|\||&&|\||\^!|\^B|\^O|\^D|\^L|\^-|~|\^_|_|&|!=|!|==|>=|>>>|>>|>|<=|<<|<|-|\+|\^\/|\/|\*|,,| )/);var d=Yd(a,b,0,b.length,a.la,c)}return d}
function Zd(a,b,c){for(;c;){var d;switch(c&3){case 1:b=-Vd(a,b);break;case 2:b=Wd(a,b,-1);break;case 3:for(d=35;0<=d&&!Ud(a,b,Math.pow(2,d));)d--;b=35-d}c>>>=2}return b}function Vd(a,b,c,d){var e=b;c=c||a.I;if(d)if(32==c)e=b>>>0;else if(32>c)e=b&(1<<c)-1;else{if(a=Math.pow(2,c),0>b||b>=a)e=b%a,0>e&&(e+=a)}else 32>=c?e=b<<32-c>>32-c:(a=Math.pow(2,c-1),b>=a?(e=b%a,(b/a|0)&1&&(e-=a)):b<-a&&(e=b%a,((-b-1)/a|0)&1?e&&(e+=a):e||(e-=a)));b!=e&&(b=e);return b}
f.Ec=function(a){function b(k){for(var l=0;l<k.length;l++)if(void 0!=k[l])return!1;return!0}if(-1>a)return ce(this,this.Ec);var c="";if(0<=a){var d=this.i[a];if(void 0!=d){c=d>>8;d&=255;var e=this.m[c];if(e){var g=this.o[c],h=g[d];(c&1?e.Oc(h.da,this.l[c]):e.Ub(h.da,this.l[c]))?(g[d]=void 0,this.i[a]=void 0,b(g)&&(g.length=0,b(this.i)&&(this.i.length=0)),c=this.O("%2d: %s %*a cleared\n",a,de[c],e.ha,h),--this.ca||this.fa||(c+=ee(this,!1))):c=this.O("invalid break address: %*a\n",e.ha,h)}else c="invalid bus"}else c=
this.O("invalid break index: %d\n",a)}else c="missing break index\n";return c};function fe(a,b){if(a.S&&(void 0==b||a.S.da==b)){var c=void 0===c?H.Ha:c;b=-1;var d=ge(a.S,a.o[c]);if(0<=d)for(var e=0;e<a.i.length;e++){var g=a.i[e];if(void 0!=g&&c==g>>8&&d==(g&255)){b=e;break}}c=b;0<=c&&a.Ec(c);a.S=null}}
f.Fc=function(a,b){b=void 0===b?!1:b;if(-1>a)return ce(this,this.Fc,b);if(0<=a){var c=this.i[a];if(void 0!=c){var d=c>>8;c=this.o[d][c&255];if(void 0!=c){var e=b?"enabled":"disabled",g=this.m[d];!c.disabled==!b?(c.disabled=!b,a=this.O("%2d: %s %*a %s\n",a,de[d],g.ha,c,e)):a=this.O("%2d: %s %*a already %s\n",a,de[d],g.ha,c,e)}else a=this.O("no break address at index: %d\n",a)}else a=this.O("invalid break index: %d\n",a)}else a="missing break index\n";return a};
function ce(a,b,c){for(var d="",e=0;e<a.i.length;e++)void 0!=a.i[e]&&(d+=b.call(a,e,c));d||(d="no break addresses found");return d}function he(a,b,c){c=void 0===c?H.Ha:c;a=a.o[c];for(c=0;c<a.length;c++){var d=a[c];if(d.da==b)return d}}function ge(a,b){for(var c=0;c<b.length;c++)if(b[c].da==a.da)return c;return-1}
function ie(a,b){b=void 0===b?!1:b;for(var c="",d=0;d<a.i.length;d++){var e=a.i[d];if(void 0!=e){var g=e>>8;e=a.o[g][e&255];g=a.O("%s %*a",de[g],a.m[g].ha,e);b?(c&&(c+=";"),c+=g,e.disabled&&(c+=";bd "+d)):c+=a.O("%2d: %s %s\n",d,g,e.disabled?"disabled":"enabled")}}c||b||(c="no break addresses found\n");return c}
function je(a,b,c){c=void 0===c?H.Ha:c;if(b){var d=a.m[c];if(d){var e=a.o[c];var g=ge(b,e);if(0<=g)g=-(g+1);else{for(g=0;g<e.length&&void 0!=e[g];g++);e[g]=b}e=g;if(0<=e)if(g=c&1?d.Mc(b.da,a.l[c]):d.Tb(b.da,a.l[c])){for(g=0;g<a.i.length&&void 0!=a.i[g];g++);a.i[g]=c<<8|e;b=a.O("%2d: %s %*a set\n",g,de[c],d.ha,b);a.ca++||a.h.length||(b+=ee(a,!0))}else b=a.O("invalid break address: %*a\n",d.ha,b),a.o[c][e]=void 0;else b=a.O("%s %*a already set\n",de[c],d.ha,b)}else b="invalid bus"}else b="missing break address\n";
return b}function ke(a,b){0<=b&&(a.H=b);var c="instruction break count: "+(0<a.H?a.H:"disabled")+"\n";0<b&&(a.h.length||(c+=ee(a,!0)),a.fa=!0);return c}function le(a,b){var c;if(b){var d=lb(b);void 0!=d?a.oa=d?p.Wc:p.NONE:c=a.O("unrecognized message option: %s\n",b)}c||(c=a.O("break on message: %b\n",!!a.oa));return c}f.nf=function(a,b){this.s||(void 0==a?me(this,"break on unknown input %#0x: %#0x",b):(a=he(this,a+b,H.Aa))&&!a.disabled&&me(this,"break on input %*a: %#0x",this.j.ha))};
f.pf=function(a,b){this.s||(void 0==a?me(this,"break on unknown output %#0x: %#0x",b):(a=he(this,a+b,H.hb))&&!a.disabled&&me(this,"break on output %*a: %#0x",this.j.ha))};
f.qf=function(a,b){this.s||(void 0==a?me(this,"break on unknown read %#0x: %#0x",b):(a+=b,this.h.length&&a==this.X.sb&&(this.Y++,0<this.H&&(--this.H||me(this,"break on instruction count")),this.h[this.M++]=a,this.M==this.h.length&&(this.M=0)),(b=he(this,a,H.Ha))&&!b.disabled&&(me(this,"break on read %*a: %#0x",this.g.ha),fe(this,a))))};f.rf=function(a,b){this.s||(void 0==a?me(this,"break on unknown write %#0x: %#0x",b):(a=he(this,a+b,H.pb))&&!a.disabled&&me(this,"break on write %*a: %#0x",this.g.ha))};
function me(a,b,c){b=a.O.apply(a,[b].concat(ba(c)));a.v("%s\n",b);$c(a.time)}function ne(a,b,c){c=void 0===c?a.g:c;return Ja(a,b.da,a.la,c.ha,"")}
function oe(a,b,c){c=void 0===c?10:c;var d="";if(a.h.length){var e,g=[];c>a.h.length&&(c=a.h.length);0>b&&(b=c);var h=a.M-b;for(0>h&&(h+=a.h.length);0<=h&&h<a.h.length&&0<c;){var k=a.h[h++];if(void 0==k)break;h==a.h.length&&(h=0);e?e.da=k:e=Kd(k);for(k=0;k<a.ka;k++)g[k]=Td(a,e,1);Qd(a,e,-g.length);d+=a.Nc(e,g,a.O("[%6d]",b--));c--}}return d||"no history"}
function Gd(a,b,c){var d=[],e="";for(b="number"==typeof b?Kd(b):b;c--;){for(Qd(a,b,d.length);d.length<a.ka;)d.push(Td(a,b,1));Qd(a,b,-d.length);e+=a.Nc(b,d)}return e}
function pe(a,b,c,d,e,g){var h="";g=g?a.j:a.g;c||(c=g.j);var k=c>>3;d||(d=128);var l=0,r=d+15>>4||1,t=4==k?16:a.la;"y"==e&&(t=k,r=d,l=8*k);b||(b=a.Ea);for(;r--&&0<d;){var q=e=0,x,w="",z="",y=ne(a,b,g);for(x=t;0<x&&0<d;x--){var B=Td(a,b,1,g);e|=B<<(q++<<3);q==k&&(w+=Ja(a,e,0,c,""),w+=1==k?9==x?"-":" ":" ",l&&(z+=Ja(a,e,2,c,"")),e=q=0);l||(z+=32<=B&&127>B?String.fromCharCode(B):".");d--}h&&(h+="\n");h+=y+"  "+w+" "+z}a.Ea=b;return h}
f.Cf=function(){var a=[];Bb(this,function(b){b.bb&&b.bb(a);return!0});return JSON.stringify(a,null,2)};function qe(a,b,c,d){var e=0,g="";d=d?a.j:a.g;for(var h=0;void 0!=b&&h<c.length;h++){var k=Td(a,b,0,d);if(void 0==k)break;var l=a,r=b,t=c[h],q=d;q=void 0===q?l.g:q;l.s++;q.Pc(r.da,t);l.s--;g+=a.O("%*a: %#*n changed to %#*n\n",a.g.ha,b,a.g.j,k,a.g.j,c[h]);Qd(a,b,1,d);e++}e||(g+=a.O("%d locations updated\n",e));a.time.update();return g}
function ee(a,b){var c="";void 0!=b&&b==!a.h.length&&xd(a.g,function(d){b?a.g.Tb(d.ta,a.l[H.Ha]):a.g.Ub(d.ta,a.l[H.Ha])})&&(b?(a.M=0,a.h=Array(re)):a.h=[]);return c+=a.O("instruction history %s\n",a.h.length?"enabled":"disabled")}f.ya=function(a){var b=a.shift();return this.W==b?(jb(this,a.shift()),this.V.va=a.shift(),!0):!1};f.Qd=function(a){Ka(this.oa,a)?me(this,"break on message"):this.time.U=!0};
f.Pf=function(a){var b=a[1],c=a[2],d=[],e=[],g=!1,h="";this.L=void 0;if("*"==c)var k=-2;else{k=Ia(c);void 0==k&&(k=-1);var l=Md(this,c,e);if(null===l)return}var r=0;a[3]&&(r=Ia(a[3].substr("l"==a[3][0]?1:0))||8);for(var t=3;t<a.length;t++)d.push(Ia(a[t],16));if("d"==b){t=Ld(this,c,d);if(void 0!=t)return t;b=this.N||b}if("s"!=b[0]&&e.length)return"unrecognized symbol(s): "+e;switch(b[0]){case "b":"c"==b[1]?h=this.Ec(k):"d"==b[1]?h=this.Fc(k):"e"==b[1]?h=this.Fc(k,!0):"i"==b[1]?h=je(this,l,H.Aa):"l"==
b[1]?h=ie(this):"m"==b[1]?h=le(this,c):"n"==b[1]?h=ke(this,k):"o"==b[1]?h=je(this,l,H.hb):"r"==b[1]?h=je(this,l,H.Ha):"w"==b[1]?h=je(this,l,H.pb):"?"==b[1]?(h="break commands:\n",se.forEach(function(q){h+=q+"\n"})):b[1]&&(h=void 0);break;case "d":this.N=b;if("b"!=b[1]&&b[1])if("w"==b[1])c=16;else if("d"==b[1])c=32;else if("i"==b[1]){if(!this.j){h="invalid bus";break}c=this.j.j;r=r||1;g=!0}else{if("h"==b[1])this.N="",h=oe(this,k,r);else if("?"==b[1]){if(this.N="",h="dump commands:\n",te.forEach(function(q){h+=
q+"\n"}),this.u.length)for(h+="dump extensions:\n",b=0;b<this.u.length;b++)l=this.u[b],h+=this.O("d   %-12s%s\n",l.name,l.zf)}else this.N="",h=void 0;break}else c=8;h=pe(this,l,c,r,b[2],g);break;case "e":if("o"==b[1]){if(!this.j){h="invalid bus";break}g=!0}else if(b[1]){h=void 0;break}h=qe(this,l,d,g);break;case "g":if(this.time.start()){if(void 0!=l){fe(this);h=je(this,l);if(2!=h.indexOf(":"))break;this.S=l;h=""}break}h="already started\n";break;case "h":$c(this.time)||(h="already stopped\n");break;
case "p":a.shift();a.shift();b=a.join(" ");h+=this.O("%s = %s\n",b,Ja(this,Sd(this,b)));break;case "r":if(b=b.substr(1).toUpperCase()){if(void 0==Db(this.X,b)){h+=this.O("unrecognized register: %s\n",b);break}void 0!=l&&Ib(this.X,b,l.da)}this.$.da=this.X.u;h+=this.X.toString();break;case "s":l=lb(c);if("h"==b[1]){if(this.ca||0<this.H)l=void 0;h=ee(this,l);void 0!=l&&(this.fa=l)}else"p"==b[1]?0<k?(Xc(this.time,k),h="target speed:  "+cd(this.time.s)):h="current speed: "+md(this.time):"s"==b[1]&&this.pa?
(k=this.pa.indexOf(c),0<=k&&(this.style=this.pa[k]),h="style: "+this.style):"?"==b[1]?(h="set commands:\n",ue.forEach(function(q){h+=q+"\n"})):h=void 0;break;case "t":r=Ia(c,10)||1;this.L=!0;if(b[1]){if("r"!=b[1]){h=void 0;break}this.L=!1}ed(this.time,r);break;case "u":if(b[1]){h=void 0;break}r||(r=8);l||(l=this.$);h+=Gd(this,l,r);this.$=l;break;case "?":h="debugger commands:\n";ve.forEach(function(q){h+=q+"\n"});break;default:h=void 0}void 0==h&&a[0]&&(h="unrecognized command '"+a[0]+"' (try '?')\n");
return h};f.Rb=function(a){return a&&this.ya(a[0])?(a.shift(),!0):!1};f.bb=function(a){var b=[];this.za(b);a.push(b);this.Z=0};f.Jc=function(a){a&&(this.time.g?this.Z&&this.Da&&Xb(this.Da):this.L?this.Sa(Gd(this,this.X.u,1)):(this.Y&&(this.X.v("%d instructions executed\n",this.Y),this.Y=0),this.X.Sa(this.X.toString()),void 0==this.L&&this.Z&&(a=this.La(Sa.Cb,!0))&&a.focus()),this.Z++)};f.za=function(a){a.push(this.W);a.push(ie(this,!0));a.push(this.V.va)};
f.Nc=function(a,b,c){var d=this.O,e=ne(this,a);b=b.shift();Qd(this,a,1);return d.call(this,"%s %02x       unsupported       ; %s\n",e,b,c||"")};
var ve="b?\t\tbreak commands;d?\t\tdump commands;e[o] [addr] ...\tedit memory/ports;g    [addr]\trun (to addr);h\t\thalt;p    [expr]\tparse expression;r?   [value]\tdisplay/set registers;s?\t\tset commands;t[r] [n]\tstep (n instructions);u    [addr] [n]\tunassemble (at addr)".split(";"),se="bc [n|*]\tclear break address;bd [n|*]\tdisable break address;be [n|*]\tenable break address;bl [n]\t\tlist break addresses;bi [addr]\tbreak on input;bo [addr]\tbreak on output;br [addr]\tbreak on read;bw [addr]\tbreak on write;bm [on|off]\tbreak on message;bn [count]\tbreak on instruction count".split(";"),te=
"db  [addr]\tdump bytes (8 bits);dw  [addr]\tdump words (16 bits);dd  [addr]\tdump dwords (32 bits);di  [addr]\tdump input ports;d*y [addr]\tdump values in binary;dh  [n] [l]\tdump instruction history buffer;ds\t\tdump machine state".split(";"),ue=["sh [on|off]\tset instruction history","sp [n]\t\tset speed multiplier","ss\t\tset debugger style"],Rd={ab:1,Xe:0,Ye:2,Dl:0},H={Ha:0,pb:1,Aa:2,hb:3},we={},de=(we[H.Ha]="br",we[H.pb]="bw",we[H.Aa]="bi",we[H.hb]="bo",we),xe={Ve:"PC"},ye={BYTE:1,Ue:2,Ze:4,
rd:5,Zc:6,kf:7},Nd={"=":ye.kf,1:ye.BYTE,2:ye.Ue,4:ye.Ze,"@":ye.rd,";":ye.Zc},re=1E5,ae={"||":5,"&&":6,"!":7,"|":7,"^!":8,"&":9,"!=":10,"==":10,">=":11,">":11,"<=":11,"<":11,">>>":12,">>":12,"<<":12,"-":13,"+":13,"^/":14,"/":14,"*":14,_:19,"^_":19,"{":20,"}":20},$d={",,":1,"||":5,"&&":6,"!=":10,"==":10,">=":11,">":11,"<=":11,"<":11,">>>":12,">>":12,"<<":12,"-":13,"+":13,"^/":14,"/":14,"*":14,"!":15,"|":15,"^!":15,"&":15,_:19,"^_":19,"{":20,"}":20};
function ze(a,b,c){Hd.call(this,a,b,c);Ae(this);this.Y=yb(this,this.J.busIO);this.S=yb(this,this.J.busMemory);this.Z=G(this,"Input",!1)}n(ze,Hd);f=ze.prototype;f.Nd=function(){if(Be(this))for(;0<this.g;)this.sb=this.u,this.$[I(this)].call(this)};
function Ae(a){Ce(a);Ab(a,"A",function(){return a.h},function(b){return a.h=b&255});Ab(a,"B",function(){return a.i},function(b){return a.i=b&255});Ab(a,"C",function(){return a.j},function(b){return a.j=b&255});Ab(a,"D",function(){return a.l},function(b){return a.l=b&255});Ab(a,"E",function(){return a.m},function(b){return a.m=b&255});Ab(a,"H",function(){return a.o},function(b){return a.o=b&255});Ab(a,"L",function(){return a.s},function(b){return a.s=b&255});Ab(a,"CF",function(){return De(a)?1:0},
function(b){a.H=b?a.H|256:a.H&255});Ab(a,"PF",function(){return Ee(a)?1:0},function(b){b?Ee(a)||(a.I^=1):Ee(a)&&(a.I^=1)});Ab(a,"AF",function(){return Fe(a)?1:0},function(b){a.L=b?~a.I&16|a.L&-17:a.I&16|a.L&-17});Ab(a,"ZF",function(){return Ge(a)?1:0},function(b){a.H=b?a.H&-256:a.H|255});Ab(a,"SF",function(){return He(a)?1:0},function(b){b?He(a)||(a.I^=192):He(a)&&(a.I^=192)});Ab(a,"IF",function(){return a.K&Ie?1:0},function(b){a.K=b?a.K|Ie:a.K&~Ie});Ab(a,"BC",a.Pa,a.tb);Ab(a,"DE",a.Ma,a.cb);Ab(a,
"HL",a.T,a.Ba);Ab(a,xe.Ve,a.Hf,a.R);a.$=[a.Qa,a.Ch,a.Xj,a.mh,a.fh,a.Pg,a.Si,a.uj,a.Qa,a.Kg,a.zh,a.Wg,a.gh,a.Qg,a.Ti,a.Bj,a.Qa,a.Dh,a.Yj,a.nh,a.hh,a.Rg,a.Ui,a.rj,a.Qa,a.Lg,a.Ah,a.Xg,a.ih,a.Sg,a.Vi,a.sj,a.Qa,a.Eh,a.Uj,a.oh,a.jh,a.Tg,a.Wi,a.Jg,a.Qa,a.Mg,a.Bh,a.Yg,a.kh,a.Ug,a.Xi,a.sg,a.Qa,a.Fh,a.Wj,a.ph,a.lh,a.Vg,a.Yi,a.Zj,a.Qa,a.Ng,a.yh,a.Zg,a.eh,a.Og,a.Ri,a.tg,a.Ph,a.Qh,a.Rh,a.Sh,a.Th,a.Uh,a.Vh,a.Oh,a.Xh,a.Yh,a.Zh,a.$h,a.ai,a.bi,a.ci,a.Wh,a.ei,a.fi,a.gi,a.hi,a.ii,a.ji,a.ki,a.di,a.mi,a.ni,a.oi,a.pi,
a.ri,a.si,a.ti,a.li,a.vi,a.wi,a.xi,a.yi,a.zi,a.Ai,a.Bi,a.ui,a.Di,a.Ei,a.Fi,a.Gi,a.Hi,a.Ii,a.Ji,a.Ci,a.Li,a.Mi,a.Ni,a.Oi,a.Pi,a.Qi,a.bh,a.Ki,a.Hh,a.Ih,a.Jh,a.Kh,a.Lh,a.Mh,a.Nh,a.Gh,a.$f,a.ag,a.bg,a.cg,a.dg,a.eg,a.fg,a.Zf,a.Sf,a.Tf,a.Uf,a.Vf,a.Wf,a.Xf,a.Yf,a.Rf,a.ak,a.bk,a.ck,a.dk,a.ek,a.fk,a.gk,a.$j,a.Mj,a.Nj,a.Oj,a.Pj,a.Qj,a.Rj,a.Sj,a.Lj,a.ig,a.jg,a.kg,a.lg,a.mg,a.ng,a.og,a.hg,a.kk,a.lk,a.mk,a.nk,a.pk,a.qk,a.rk,a.jk,a.$i,a.aj,a.bj,a.cj,a.dj,a.ej,a.fj,a.Zi,a.vg,a.wg,a.xg,a.yg,a.zg,a.Ag,a.Bg,a.ug,a.xj,
a.jj,a.th,a.Rd,a.Dg,a.oj,a.gg,a.Cj,a.Kj,a.Sd,a.xh,a.Rd,a.Ig,a.Sb,a.Qf,a.Dj,a.wj,a.kj,a.sh,a.hj,a.Cg,a.pj,a.hk,a.Ej,a.tj,a.Sd,a.qh,a.dh,a.qg,a.Sb,a.Tj,a.Fj,a.Aj,a.lj,a.wh,a.tk,a.Hg,a.qj,a.pg,a.Gj,a.zj,a.ij,a.vh,a.ik,a.Fg,a.Sb,a.sk,a.Hj,a.yj,a.mj,a.uh,a.$g,a.Eg,a.nj,a.gj,a.Ij,a.vj,a.Vj,a.rh,a.ah,a.rg,a.Sb,a.Gg,a.Jj]}
f.ya=function(a){if(!a||!a.length)return this.v("invalid saved state\n"),!1;var b=a.shift(),c=a.shift();if(b!=this.W||3!==(c|0))return this.v("CPU state mismatch (%s %3.2f)\n",b,c),!1;try{this.h=a.shift(),this.i=a.shift(),this.j=a.shift(),this.l=a.shift(),this.m=a.shift(),this.o=a.shift(),this.s=a.shift(),this.R(a.shift()),this.M=a.shift()&65535,Je(this,a.shift()),this.N=a.shift()}catch(d){return this.v("CPU state error: %s\n",d.message),!1}return!0};
f.za=function(a){a.push(this.W);a.push(3);a.push(this.h);a.push(this.i);a.push(this.j);a.push(this.l);a.push(this.m);a.push(this.o);a.push(this.s);a.push(this.u);a.push(this.M);a.push(Ke(this));a.push(this.N)};f.Rb=function(a){return a&&this.ya(a[0])?(a.shift(),!0):!1};f.ra=function(a){a?(this.time.start(),this.Z&&Xb(this.Z)):$c(this.time)};f.ma=function(){this.v("reset\n");Ce(this);this.time.g||this.Sa(this.toString())};f.bb=function(a){var b=[];this.za(b);a.push(b)};f.Jc=function(){};
f.Qa=function(){this.g-=4};f.Ch=function(){this.tb(J(this));this.g-=10};f.Xj=function(){Le(this,this.Pa(),this.h);this.g-=7};f.mh=function(){this.tb(this.Pa()+1);this.g-=5};f.fh=function(){this.i=Me(this,this.i);this.g-=5};f.Pg=function(){this.i=Ne(this,this.i);this.g-=5};f.Si=function(){this.i=I(this);this.g-=7};f.uj=function(){var a=this.h<<1;this.h=a&255|a>>8;Oe(this,a&256);this.g-=4};f.Kg=function(){var a;this.Ba(a=this.T()+this.Pa());Oe(this,a>>8&256);this.g-=10};
f.zh=function(){this.h=K(this,this.Pa());this.g-=7};f.Wg=function(){this.tb(this.Pa()-1);this.g-=5};f.gh=function(){this.j=Me(this,this.j);this.g-=5};f.Qg=function(){this.j=Ne(this,this.j);this.g-=5};f.Ti=function(){this.j=I(this);this.g-=7};f.Bj=function(){var a=this.h<<8&256;this.h=(a|this.h)>>1;Oe(this,a);this.g-=4};f.Dh=function(){this.cb(J(this));this.g-=10};f.Yj=function(){Le(this,this.Ma(),this.h);this.g-=7};f.nh=function(){this.cb(this.Ma()+1);this.g-=5};
f.hh=function(){this.l=Me(this,this.l);this.g-=5};f.Rg=function(){this.l=Ne(this,this.l);this.g-=5};f.Ui=function(){this.l=I(this);this.g-=7};f.rj=function(){var a=this.h<<1;this.h=a&255|De(this);Oe(this,a&256);this.g-=4};f.Lg=function(){var a;this.Ba(a=this.T()+this.Ma());Oe(this,a>>8&256);this.g-=10};f.Ah=function(){this.h=K(this,this.Ma());this.g-=7};f.Xg=function(){this.cb(this.Ma()-1);this.g-=5};f.ih=function(){this.m=Me(this,this.m);this.g-=5};
f.Sg=function(){this.m=Ne(this,this.m);this.g-=5};f.Vi=function(){this.m=I(this);this.g-=7};f.sj=function(){var a=this.h<<8;this.h=(De(this)<<8|this.h)>>1;Oe(this,a&256);this.g-=4};f.Eh=function(){this.Ba(J(this));this.g-=10};f.Uj=function(){var a=J(this);this.S.ja(a,this.T()&65535);this.g-=16};f.oh=function(){this.Ba(this.T()+1);this.g-=5};f.jh=function(){this.o=Me(this,this.o);this.g-=5};f.Tg=function(){this.o=Ne(this,this.o);this.g-=5};f.Wi=function(){this.o=I(this);this.g-=7};
f.Jg=function(){var a=0,b=De(this);if(Fe(this)||9<(this.h&15))a|=6;if(b||154<=this.h)a|=96,b=Pe;this.h=Qe(this,a);Oe(this,b?256:0);this.g-=4};f.Mg=function(){var a;this.Ba(a=this.T()+this.T());Oe(this,a>>8&256);this.g-=10};f.Bh=function(){var a=this.Ba;var b=J(this);b=this.S.ua(b);a.call(this,b);this.g-=16};f.Yg=function(){this.Ba(this.T()-1);this.g-=5};f.kh=function(){this.s=Me(this,this.s);this.g-=5};f.Ug=function(){this.s=Ne(this,this.s);this.g-=5};f.Xi=function(){this.s=I(this);this.g-=7};
f.sg=function(){this.h=~this.h&255;this.g-=4};f.Fh=function(){this.M=J(this)&65535;this.g-=10};f.Wj=function(){Le(this,J(this),this.h);this.g-=13};f.ph=function(){this.M=this.M+1&65535;this.g-=5};f.lh=function(){var a=this.T();Le(this,a,Me(this,K(this,a)));this.g-=10};f.Vg=function(){var a=this.T();Le(this,a,Ne(this,K(this,a)));this.g-=10};f.Yi=function(){Le(this,this.T(),I(this));this.g-=10};f.Zj=function(){this.H|=256;this.g-=4};
f.Ng=function(){var a;this.Ba(a=this.T()+this.M);Oe(this,a>>8&256);this.g-=10};f.yh=function(){this.h=K(this,J(this));this.g-=13};f.Zg=function(){this.M=this.M-1&65535;this.g-=5};f.eh=function(){this.h=Me(this,this.h);this.g-=5};f.Og=function(){this.h=Ne(this,this.h);this.g-=5};f.Ri=function(){this.h=I(this);this.g-=7};f.tg=function(){Oe(this,De(this)?0:256);this.g-=4};f.Ph=function(){this.g-=5};f.Qh=function(){this.i=this.j;this.g-=5};f.Rh=function(){this.i=this.l;this.g-=5};
f.Sh=function(){this.i=this.m;this.g-=5};f.Th=function(){this.i=this.o;this.g-=5};f.Uh=function(){this.i=this.s;this.g-=5};f.Vh=function(){this.i=K(this,this.T());this.g-=7};f.Oh=function(){this.i=this.h;this.g-=5};f.Xh=function(){this.j=this.i;this.g-=5};f.Yh=function(){this.g-=5};f.Zh=function(){this.j=this.l;this.g-=5};f.$h=function(){this.j=this.m;this.g-=5};f.ai=function(){this.j=this.o;this.g-=5};f.bi=function(){this.j=this.s;this.g-=5};f.ci=function(){this.j=K(this,this.T());this.g-=7};
f.Wh=function(){this.j=this.h;this.g-=5};f.ei=function(){this.l=this.i;this.g-=5};f.fi=function(){this.l=this.j;this.g-=5};f.gi=function(){this.g-=5};f.hi=function(){this.l=this.m;this.g-=5};f.ii=function(){this.l=this.o;this.g-=5};f.ji=function(){this.l=this.s;this.g-=5};f.ki=function(){this.l=K(this,this.T());this.g-=7};f.di=function(){this.l=this.h;this.g-=5};f.mi=function(){this.m=this.i;this.g-=5};f.ni=function(){this.m=this.j;this.g-=5};f.oi=function(){this.m=this.l;this.g-=5};
f.pi=function(){this.g-=5};f.ri=function(){this.m=this.o;this.g-=5};f.si=function(){this.m=this.s;this.g-=5};f.ti=function(){this.m=K(this,this.T());this.g-=7};f.li=function(){this.m=this.h;this.g-=5};f.vi=function(){this.o=this.i;this.g-=5};f.wi=function(){this.o=this.j;this.g-=5};f.xi=function(){this.o=this.l;this.g-=5};f.yi=function(){this.o=this.m;this.g-=5};f.zi=function(){this.g-=5};f.Ai=function(){this.o=this.s;this.g-=5};f.Bi=function(){this.o=K(this,this.T());this.g-=7};
f.ui=function(){this.o=this.h;this.g-=5};f.Di=function(){this.s=this.i;this.g-=5};f.Ei=function(){this.s=this.j;this.g-=5};f.Fi=function(){this.s=this.l;this.g-=5};f.Gi=function(){this.s=this.m;this.g-=5};f.Hi=function(){this.s=this.o;this.g-=5};f.Ii=function(){this.g-=5};f.Ji=function(){this.s=K(this,this.T());this.g-=7};f.Ci=function(){this.s=this.h;this.g-=5};f.Li=function(){Le(this,this.T(),this.i);this.g-=7};f.Mi=function(){Le(this,this.T(),this.j);this.g-=7};
f.Ni=function(){Le(this,this.T(),this.l);this.g-=7};f.Oi=function(){Le(this,this.T(),this.m);this.g-=7};f.Pi=function(){Le(this,this.T(),this.o);this.g-=7};f.Qi=function(){Le(this,this.T(),this.s);this.g-=7};f.bh=function(){this.g-=7;this.N|=Re;id(this.time);this.K&Ie&&!gb(this,p.md)||(this.R(this.u-1),$c(this.time))};f.Ki=function(){Le(this,this.T(),this.h);this.g-=7};f.Hh=function(){this.h=this.i;this.g-=5};f.Ih=function(){this.h=this.j;this.g-=5};f.Jh=function(){this.h=this.l;this.g-=5};
f.Kh=function(){this.h=this.m;this.g-=5};f.Lh=function(){this.h=this.o;this.g-=5};f.Mh=function(){this.h=this.s;this.g-=5};f.Nh=function(){this.h=K(this,this.T());this.g-=7};f.Gh=function(){this.g-=5};f.$f=function(){this.h=Qe(this,this.i);this.g-=4};f.ag=function(){this.h=Qe(this,this.j);this.g-=4};f.bg=function(){this.h=Qe(this,this.l);this.g-=4};f.cg=function(){this.h=Qe(this,this.m);this.g-=4};f.dg=function(){this.h=Qe(this,this.o);this.g-=4};f.eg=function(){this.h=Qe(this,this.s);this.g-=4};
f.fg=function(){this.h=Qe(this,K(this,this.T()));this.g-=7};f.Zf=function(){this.h=Qe(this,this.h);this.g-=4};f.Sf=function(){this.h=Se(this,this.i);this.g-=4};f.Tf=function(){this.h=Se(this,this.j);this.g-=4};f.Uf=function(){this.h=Se(this,this.l);this.g-=4};f.Vf=function(){this.h=Se(this,this.m);this.g-=4};f.Wf=function(){this.h=Se(this,this.o);this.g-=4};f.Xf=function(){this.h=Se(this,this.s);this.g-=4};f.Yf=function(){this.h=Se(this,K(this,this.T()));this.g-=7};
f.Rf=function(){this.h=Se(this,this.h);this.g-=4};f.ak=function(){this.h=L(this,this.i);this.g-=4};f.bk=function(){this.h=L(this,this.j);this.g-=4};f.ck=function(){this.h=L(this,this.l);this.g-=4};f.dk=function(){this.h=L(this,this.m);this.g-=4};f.ek=function(){this.h=L(this,this.o);this.g-=4};f.fk=function(){this.h=L(this,this.s);this.g-=4};f.gk=function(){this.h=L(this,K(this,this.T()));this.g-=7};f.$j=function(){this.h=L(this,this.h);this.g-=4};f.Mj=function(){this.h=Te(this,this.i);this.g-=4};
f.Nj=function(){this.h=Te(this,this.j);this.g-=4};f.Oj=function(){this.h=Te(this,this.l);this.g-=4};f.Pj=function(){this.h=Te(this,this.m);this.g-=4};f.Qj=function(){this.h=Te(this,this.o);this.g-=4};f.Rj=function(){this.h=Te(this,this.s);this.g-=4};f.Sj=function(){this.h=Te(this,K(this,this.T()));this.g-=7};f.Lj=function(){this.h=Te(this,this.h);this.g-=4};f.ig=function(){this.h=Ue(this,this.i);this.g-=4};f.jg=function(){this.h=Ue(this,this.j);this.g-=4};
f.kg=function(){this.h=Ue(this,this.l);this.g-=4};f.lg=function(){this.h=Ue(this,this.m);this.g-=4};f.mg=function(){this.h=Ue(this,this.o);this.g-=4};f.ng=function(){this.h=Ue(this,this.s);this.g-=4};f.og=function(){this.h=Ue(this,K(this,this.T()));this.g-=7};f.hg=function(){this.h=Ue(this,this.h);this.g-=4};f.kk=function(){this.h=Ve(this,this.i);this.g-=4};f.lk=function(){this.h=Ve(this,this.j);this.g-=4};f.mk=function(){this.h=Ve(this,this.l);this.g-=4};
f.nk=function(){this.h=Ve(this,this.m);this.g-=4};f.pk=function(){this.h=Ve(this,this.o);this.g-=4};f.qk=function(){this.h=Ve(this,this.s);this.g-=4};f.rk=function(){this.h=Ve(this,K(this,this.T()));this.g-=7};f.jk=function(){this.h=Ve(this,this.h);this.g-=4};f.$i=function(){this.h=We(this,this.i);this.g-=4};f.aj=function(){this.h=We(this,this.j);this.g-=4};f.bj=function(){this.h=We(this,this.l);this.g-=4};f.cj=function(){this.h=We(this,this.m);this.g-=4};
f.dj=function(){this.h=We(this,this.o);this.g-=4};f.ej=function(){this.h=We(this,this.s);this.g-=4};f.fj=function(){this.h=We(this,K(this,this.T()));this.g-=7};f.Zi=function(){this.h=We(this,this.h);this.g-=4};f.vg=function(){L(this,this.i);this.g-=4};f.wg=function(){L(this,this.j);this.g-=4};f.xg=function(){L(this,this.l);this.g-=4};f.yg=function(){L(this,this.m);this.g-=4};f.zg=function(){L(this,this.o);this.g-=4};f.Ag=function(){L(this,this.s);this.g-=4};
f.Bg=function(){L(this,K(this,this.T()));this.g-=7};f.ug=function(){L(this,this.h);this.g-=4};f.xj=function(){Ge(this)||(this.R(Xe(this)),this.g-=6);this.g-=5};f.jj=function(){this.tb(Xe(this));this.g-=10};f.th=function(){var a=J(this);Ge(this)||this.R(a);this.g-=10};f.Rd=function(){this.R(J(this));this.g-=10};f.Dg=function(){var a=J(this);Ge(this)||(M(this,this.u),this.R(a),this.g-=6);this.g-=11};f.oj=function(){M(this,this.Pa());this.g-=11};f.gg=function(){this.h=Qe(this,I(this));this.g-=7};
f.Cj=function(){M(this,this.u);this.R(0);this.g-=11};f.Kj=function(){Ge(this)&&(this.R(Xe(this)),this.g-=6);this.g-=5};f.Sd=function(){this.R(Xe(this));this.g-=10};f.xh=function(){var a=J(this);Ge(this)&&this.R(a);this.g-=10};f.Ig=function(){var a=J(this);Ge(this)&&(M(this,this.u),this.R(a),this.g-=6);this.g-=11};f.Sb=function(){var a=J(this);M(this,this.u);this.R(a);this.g-=17};f.Qf=function(){this.h=Se(this,I(this));this.g-=7};f.Dj=function(){M(this,this.u);this.R(8);this.g-=11};
f.wj=function(){De(this)||(this.R(Xe(this)),this.g-=6);this.g-=5};f.kj=function(){this.cb(Xe(this));this.g-=10};f.sh=function(){var a=J(this);De(this)||this.R(a);this.g-=10};f.hj=function(){var a=I(this);this.Y.sa(a,this.h);this.g-=10};f.Cg=function(){var a=J(this);De(this)||(M(this,this.u),this.R(a),this.g-=6);this.g-=11};f.pj=function(){M(this,this.Ma());this.g-=11};f.hk=function(){this.h=L(this,I(this));this.g-=7};f.Ej=function(){M(this,this.u);this.R(16);this.g-=11};
f.tj=function(){De(this)&&(this.R(Xe(this)),this.g-=6);this.g-=5};f.qh=function(){var a=J(this);De(this)&&this.R(a);this.g-=10};f.dh=function(){var a=I(this);this.h=this.Y.na(a)&255;this.g-=10};f.qg=function(){var a=J(this);De(this)&&(M(this,this.u),this.R(a),this.g-=6);this.g-=11};f.Tj=function(){this.h=Te(this,I(this));this.g-=7};f.Fj=function(){M(this,this.u);this.R(24);this.g-=11};f.Aj=function(){Ee(this)||(this.R(Xe(this)),this.g-=6);this.g-=5};f.lj=function(){this.Ba(Xe(this));this.g-=10};
f.wh=function(){var a=J(this);Ee(this)||this.R(a);this.g-=10};f.tk=function(){var a=Xe(this);M(this,this.T());this.Ba(a);this.g-=18};f.Hg=function(){var a=J(this);Ee(this)||(M(this,this.u),this.R(a),this.g-=6);this.g-=11};f.qj=function(){M(this,this.T());this.g-=11};f.pg=function(){this.h=Ue(this,I(this));this.g-=7};f.Gj=function(){M(this,this.u);this.R(32);this.g-=11};f.zj=function(){Ee(this)&&(this.R(Xe(this)),this.g-=6);this.g-=5};f.ij=function(){this.R(this.T());this.g-=5};
f.vh=function(){var a=J(this);Ee(this)&&this.R(a);this.g-=10};f.ik=function(){var a=this.T();this.Ba(this.Ma());this.cb(a);this.g-=5};f.Fg=function(){var a=J(this);Ee(this)&&(M(this,this.u),this.R(a),this.g-=6);this.g-=11};f.sk=function(){this.h=Ve(this,I(this));this.g-=7};f.Hj=function(){M(this,this.u);this.R(40);this.g-=11};f.yj=function(){He(this)||(this.R(Xe(this)),this.g-=6);this.g-=5};f.mj=function(){var a=Xe(this);Je(this,a&Ye|this.K&~Ye);this.h=a>>8;this.g-=10};
f.uh=function(){var a=J(this);He(this)||this.R(a);this.g-=10};f.$g=function(){this.K&=~Ie;this.g-=4};f.Eg=function(){var a=J(this);He(this)||(M(this,this.u),this.R(a),this.g-=6);this.g-=11};f.nj=function(){M(this,Ke(this)&Ye|this.h<<8);this.g-=11};f.gj=function(){this.h=We(this,I(this));this.g-=7};f.Ij=function(){M(this,this.u);this.R(48);this.g-=11};f.vj=function(){He(this)&&(this.R(Xe(this)),this.g-=6);this.g-=5};f.Vj=function(){this.M=this.T()&65535;this.g-=5};
f.rh=function(){var a=J(this);He(this)&&this.R(a);this.g-=10};f.ah=function(){this.K|=Ie;this.g-=4;Be(this)};f.rg=function(){var a=J(this);He(this)&&(M(this,this.u),this.R(a),this.g-=6);this.g-=11};f.Gg=function(){L(this,I(this));this.g-=7};f.Jj=function(){M(this,this.u);this.R(56);this.g-=11};function Ce(a){a.h=0;a.i=0;a.j=0;a.l=0;a.m=0;a.o=0;a.s=0;a.M=0;a.R(a.ca);a.sb=a.u;Je(a,0);a.N=Ze}f.Pa=function(){return this.i<<8|this.j};f.tb=function(a){this.i=a>>8&255;this.j=a&255};
f.Ma=function(){return this.l<<8|this.m};f.cb=function(a){this.l=a>>8&255;this.m=a&255};f.T=function(){return this.o<<8|this.s};f.Ba=function(a){this.o=a>>8&255;this.s=a&255};f.Hf=function(){return this.u};f.R=function(a){this.u=a&65535};function De(a){return a.H&256?Pe:0}function Oe(a,b){a.H=a.H&255|b}function Ee(a){return $e[a.I&255]?af:0}function Fe(a){return(a.I^a.L)&16?bf:0}function Ge(a){return a.H&255?0:cf}function He(a){return a.I&128?df:0}
function Ke(a){return a.K&~ef|He(a)|Ge(a)|Fe(a)|Ee(a)|De(a)}function Je(a,b){a.H=a.I=a.L=0;b&Pe&&(a.H|=256);b&af||(a.I|=1);b&bf&&(a.L|=16);b&cf||(a.H|=255);b&df&&(a.I^=192);a.K=a.K&~(ef|Ie)|b&Ie|ff}function Qe(a,b){a.L=a.h^b;return a.I=(a.H=a.h+b)&255}function Se(a,b){a.L=a.h^b;return a.I=(a.H=a.h+b+(a.H&256?1:0))&255}function Ue(a,b){a.H=a.I=a.L=a.h&b;(a.h|b)&8&&(a.L^=16);return a.H}function Ne(a,b){a.L=b^255;b=a.I=b+255&255;a.H=a.H&-256|b;return b}
function Me(a,b){a.L=b;b=a.I=b+1&255;a.H=a.H&-256|b;return b}function We(a,b){return a.I=a.H=a.L=a.h|b}function L(a,b){b^=255;a.L=a.h^b;return a.I=(a.H=a.h+b+1^256)&255}function Te(a,b){b^=255;a.L=a.h^b;return a.I=(a.H=a.h+b+(a.H&256?0:1)^256)&255}function Ve(a,b){return a.I=a.H=a.L=a.h^b}function K(a,b){return a.S.na(b)|0}function Le(a,b,c){a.S.sa(b,c&255)}function I(a){var b=K(a,a.u);a.R(a.u+1);return b}function J(a){var b=a.S.ua(a.u);a.R(a.u+2);return b}
function Xe(a){var b=a.S.ua(a.M);a.M=a.M+2&65535;return b}function M(a,b){a.M=a.M-2&65535;a.S.ja(a.M,b&65535)}function Be(a){if(a.time.g&&a.N&gf&&a.K&Ie){var b;for(b=0;8>b&&!(a.N&1<<b);b++);var c=b;c=void 0===c?-1:c;a.N&=~(0>c?255:1<<c);a.K&=~Ie;a.N&=~Re;a.$[hf|b<<3].call(a)}return a.N&Re?(id(a.time),!1):!0}function jf(a,b){a.N|=1<<b;a.K&Ie&&id(a.time)}
f.toString=function(){return this.O("A=%02X BC=%04X DE=%04X HL=%04X SP=%04X I%d S%d Z%d A%d P%d C%d\n%s",this.h,this.Pa(),this.Ma(),this.T(),this.M,this.K&Ie?1:0,He(this)?1:0,Ge(this)?1:0,Fe(this)?1:0,Ee(this)?1:0,De(this)?1:0,this.ba&&Gd(this.ba,this.u,1)||"")};
var Pe=1,ff=2,af=4,bf=16,cf=64,df=128,Ye=255,Ie=512,ef=Pe|af|bf|cf|df,$e=[1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,
0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1],Ze=0,gf=255,Re=256,hf=199;u.CPUx80=ze;function kf(a,b,c){Jd.call(this,a,b,c);this.pa=[lf,mf];this.style=mf;this.ka=3}n(kf,Jd);
kf.prototype.Nc=function(a,b,c){function d(W,la){var rc=nf[W];h.style==mf&&la&of&&(W==pf&&(rc="HL"),rc="["+rc+"]");return rc}function e(W){switch(W&qf){case N:var la=Ja(h,g(),16,8,"");break;case rf:la=Ja(h,(g()|g()<<8)<<24>>24,16,16,"");break;case sf:la=Ja(h,g()|g()<<8,16,16,"");break;default:return"imm("+Ja(h,W,16,16,"")+")"}h.style==mf&&W&of?la="["+la+"]":W&tf||(la=(h.style==lf?"$":"0x")+la);return la}function g(){var W=b.shift();l+=Ja(h,W,16,8,"");Qd(h,a,1);return W}for(var h=this,k=ne(this,a),
l="",r=Pd(this,a,ye.rd),t=Pd(this,a,ye.Zc),q=g(),x=uf[q],w="",z=(this.style!=mf?vf:wf)[x[0]],y=x.length-1,B=xf,A,da=1;da<=y;da++){var fa="";A=x[da];if(void 0!==A&&!(A&O&&this.style==lf)){var ma=A&yf;if(ma){var ra=A&qf;ra?B=ra:A|=B;A&zf||(A|=1==da?Af:Bf);ma&P?fa=e(A):ma&tf?fa=d((A&Cf)>>8,A):ma&Df&&(fa=(q>>3&7).toString());if(!fa||!fa.length){w="INVALID";break}0<w.length&&(w+=",");w+=fa||"???"}}}k=this.O("%s %-7s%s %-7s %s",k,l,A&Ef?"*":" ",z,w);c?t&&(c+=" "+t):t&&(c=t);c&&(k=this.O("%-32s; %s",k,c));
r&&(k=r+":\n"+k);return k+"\n"};
var lf="8080",mf="8086",vf="NONE ACI ADC ADD ADI ANA ANI CALL CC CM CNC CNZ CP CPE CPO CZ CMA CMC CMP CPI DAA DAD DCR DCX DI EI HLT IN INR INX JMP JC JM JNC JNZ JP JPE JPO JZ LDA LDAX LHLD LXI MOV MVI NOP ORA ORI OUT PCHL POP PUSH RAL RAR RET RC RM RNC RNZ RP RPE RPO RZ RLC RRC RST SBB SBI SHLD SPHL STA STAX STC SUB SUI XCHG XRA XRI XTHL".split(" "),wf="NONE ADC ADC ADD ADD AND AND CALL CALLC CALLS CALLNC CALLNZ CALLNS CALLP CALLNP CALLZ NOT CMC CMP CMP DAA ADD DEC DEC CLI STI HLT IN INC INC JMP JC JS JNC JNZ JNS JP JNP JZ MOV MOV MOV MOV MOV MOV NOP OR OR OUT JMP POP PUSH RCL RCR RET RETC RETS RETNC RETNZ RETNS RETP RETNP RETZ ROL ROR RST SBB SBB MOV MOV MOV MOV STC SUB SUB XCHG XOR XOR XCHG".split(" "),pf=
6,nf="B C D E H L M A BC DE HL SP PC PS PSW".split(" "),qf=15,yf=240,Cf=3840,zf=61440,xf=0,N=1,rf=2,sf=3,tf=16,P=32,of=64,Df=128,Q=1792|tf|N,R=0|tf|N,S=256|tf|N,T=512|tf|N,U=768|tf|N,V=1024|tf|N,X=1280|tf|N,Y=pf<<8|tf|N|of,Ff=2048|tf|sf,Gf=2304|tf|sf,Hf=2560|tf|sf,If=2816|tf|sf,Jf=3584|tf|sf,Bf=4096,Af=8192,O=16384,Ef=32768,uf=[[45],[42,Ff,P],[71,Ff|of,Q|O],[29,Ff],[28,R],[22,R],[44,R,P],[63],[45,Ef],[21,Hf|O,Ff],[40,Q|O,Ff|of],[23,Ff],[28,S],[22,S],[44,S,P],[64],[45,Ef],[42,Gf,P],[71,Gf|of,Q|O],
[29,Gf],[28,T],[22,T],[44,T,P],[52],[45,Ef],[21,Hf|O,Gf],[40,Q|O,Gf|of],[23,Gf],[28,U],[22,U],[44,U,P],[53],[45,Ef],[42,Hf,P],[68,51|of,Hf|O],[29,Hf],[28,V],[22,V],[44,V,P],[20],[45,Ef],[21,Hf|O,Hf],[41,Hf|O,51|of],[23,Hf],[28,X],[22,X],[44,X,P],[16,Q|O],[45,Ef],[42,If,P],[70,51|of,Q|O],[29,If],[28,Y],[22,Y],[44,Y,P],[72],[45,Ef],[21,Hf|O,If],[39,Q|O,51|of],[23,If],[28,Q],[22,Q],[44,Q,P],[17],[43,R,R],[43,R,S],[43,R,T],[43,R,U],[43,R,V],[43,R,X],[43,R,Y],[43,R,Q],[43,S,R],[43,S,S],[43,S,T],[43,S,
U],[43,S,V],[43,S,X],[43,S,Y],[43,S,Q],[43,T,R],[43,T,S],[43,T,T],[43,T,U],[43,T,V],[43,T,X],[43,T,Y],[43,T,Q],[43,U,R],[43,U,S],[43,U,T],[43,U,U],[43,U,V],[43,U,X],[43,U,Y],[43,U,Q],[43,V,R],[43,V,S],[43,V,T],[43,V,U],[43,V,V],[43,V,X],[43,V,Y],[43,V,Q],[43,X,R],[43,X,S],[43,X,T],[43,X,U],[43,X,V],[43,X,X],[43,X,Y],[43,X,Q],[43,Y,R],[43,Y,S],[43,Y,T],[43,Y,U],[43,Y,V],[43,Y,X],[26],[43,Y,Q],[43,Q,R],[43,Q,S],[43,Q,T],[43,Q,U],[43,Q,V],[43,Q,X],[43,Q,Y],[43,Q,Q],[3,Q|O,R],[3,Q|O,S],[3,Q|O,T],[3,Q|
O,U],[3,Q|O,V],[3,Q|O,X],[3,Q|O,Y],[3,Q|O,Q],[2,Q|O,R],[2,Q|O,S],[2,Q|O,T],[2,Q|O,U],[2,Q|O,V],[2,Q|O,X],[2,Q|O,Y],[2,Q|O,Q],[73,Q|O,R],[73,Q|O,S],[73,Q|O,T],[73,Q|O,U],[73,Q|O,V],[73,Q|O,X],[73,Q|O,Y],[73,Q|O,Q],[66,Q|O,R],[66,Q|O,S],[66,Q|O,T],[66,Q|O,U],[66,Q|O,V],[66,Q|O,X],[66,Q|O,Y],[66,Q|O,Q],[5,Q|O,R],[5,Q|O,S],[5,Q|O,T],[5,Q|O,U],[5,Q|O,V],[5,Q|O,X],[5,Q|O,Y],[5,Q|O,Q],[76,Q|O,R],[76,Q|O,S],[76,Q|O,T],[76,Q|O,U],[76,Q|O,V],[76,Q|O,X],[76,Q|O,Y],[76,Q|O,Q],[46,Q|O,R],[46,Q|O,S],[46,Q|O,T],
[46,Q|O,U],[46,Q|O,V],[46,Q|O,X],[46,Q|O,Y],[46,Q|O,Q],[18,Q|O,R],[18,Q|O,S],[18,Q|O,T],[18,Q|O,U],[18,Q|O,V],[18,Q|O,X],[18,Q|O,Y],[18,Q|O,Q],[58],[50,Ff],[34,51],[30,51],[11,51],[51,Ff],[4,Q|O,P|N],[65,Df],[62],[54],[38,51],[30,51|Ef],[15,51],[7,51],[1,Q|O,P|N],[65,Df],[57],[50,Gf],[33,51],[48,P|N,Q|O],[10,51],[51,Gf],[74,Q|O,P|N],[65,Df],[55],[54,Ef],[31,51],[27,Q|O,P|N],[8,51],[7,51|Ef],[67,Q|O,P|N],[65,Df],[61],[50,Hf],[37,51],[78,If|of|O,Hf|O],[14,51],[51,Hf],[6,Q|O,P|N],[65,Df],[60],[49,Hf],
[36,51],[75,Hf|O,Gf|O],[13,51],[7,51|Ef],[77,Q|O,P|N],[65,Df],[59],[50,Jf],[35,51],[24],[12,51],[51,Jf],[47,Q|O,P|N],[65,Df],[56],[69,If|O,Hf|O],[32,51],[25],[9,51],[7,51|Ef],[19,Q|O,P|N],[65,Df]];u.Dbgx80=kf;function Kf(a,b,c){F.call(this,a,b,c);this.time=G(this,"Time");this.ports=G(this,"Ports");Cd(this.ports,this,Lf);this.ma()}n(Kf,F);f=Kf.prototype;
f.ya=function(a){var b=a.shift();return this.W==b?(this.I=a.shift(),this.j=a.shift(),this.l=a.shift(),this.m=a.shift(),this.i=a.shift(),this.u=a.shift(),this.L=a.shift(),this.K=a.shift(),this.s=a.shift(),this.g=a.shift(),this.o=a.shift(),this.H=a.shift(),this.h=a.shift(),!0):!1};f.za=function(a){a.push(this.W);a.push(this.I);a.push(this.j);a.push(this.l);a.push(this.m);a.push(this.i);a.push(this.u);a.push(this.L);a.push(this.K);a.push(this.s);a.push(this.g);a.push(this.o);a.push(this.H);a.push(this.h)};
f.ra=function(){void 0===this.M&&(this.M=G(this,"VT100Keyboard"));void 0===this.N&&(this.N=G(this,"VT100Serial"));void 0===this.video&&(this.video=G(this,"VT100Video"));void 0===this.ba&&(this.ba=G(this,"Debugger",!1))&&this.ba.Jb(this,"nvr","dump non-volatile ram",this.Bf)};
f.ma=function(){this.I=Mf;this.j=Nf|Of;this.l=Pf;this.m=Qf;this.i=Rf;this.u=Sf;this.L=Tf;this.K=Uf;this.H=this.o=this.g=this.s=0;this.h=[11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11776,11784,11918,11776,11984,11888,11776,11808,11776,12E3,12E3,11901,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};function Vf(a){var b=0,c=0,d=~a.s;for(a=0;10>a;a++)d&1&&(b=9-a),d>>=1;for(a=0;10>a;a++)d&1&&(c=9-a),d>>=1;return 10*b+c}
f.Lf=function(a){var b=this.j;b&=~Wf;if((jd(this.time)&64)<<1&&(b|=Wf,b!=this.j)){var c=this.o&1;var d=this.o>>1&7;switch(d){case Xf:break;case Yf:this.s=this.s<<1|c;break;case Zf:c=Vf(this);this.h[c]=$f;this.v(p.Ga,"doNVRCommand(): erase data at addr %#06x\n",c);break;case ag:this.g=this.g<<1|c;break;case bg:c=Vf(this);d=this.g&$f;this.h[c]=d;this.v(p.Ga,"doNVRCommand(): write data %#06x to addr %#06x\n",d,c);break;case cg:c=Vf(this);d=this.h[c];null==d&&(d=$f);this.g=d;this.v(p.Ga,"doNVRCommand(): read data %#06x from addr %#06x\n",
d,c);break;case dg:this.g<<=1;this.H=this.g&$f+1;break;default:this.v(p.Ga,"doNVRCommand(): unrecognized command %#04x\n",d)}}b&=~eg;this.H&&(b|=eg);b&=~fg;this.M&&this.M.Gc()&&(b|=fg);b&=~gg;this.N&&this.N.Gc()&&(b|=gg);this.j=b;this.v(p.Ga+p.qa,"inFlags(%#04x): %#04x\n",a,b);return b};f.vk=function(a,b){this.v(p.Ga+p.qa,"outBrightness(%#04x): %#04x\n",a,b);this.I=b};f.Ak=function(a,b){this.v(p.Ga+p.qa,"outNVRLatch(%#04x): %#04x\n",a,b);this.o=b};
f.yk=function(a,b){this.v(p.Ga+p.qa,"outDC012(%#04x): %#04x\n",a,b);a=b&3;switch(b>>2&3){case 0:this.i=this.i&-4|a;break;case 1:this.i=this.i&-13|a<<2;this.video&&(b=this.video,a=this.i,b.v("updateScrollOffset(%d)\n",a),b.$!==a&&((b.$=a)?b.Hd(!0):b.oa=!0));break;case 2:switch(a){case 0:this.u=~this.u;break;case 2:case 3:this.L=3-a}break;case 3:this.K=a}};
f.xk=function(a,b){this.v(p.Ga+p.qa,"outNDC011(%#04x): %#04x\n",a,b);b&hg?(b&=ig,this.m!=b&&(this.m=b,this.video&&(a=this.video,b=this.m==ig?50:60,a.v("updateRate(%d)\n",b),a.Hb=b))):(b&=jg,this.l!=b&&(this.l=b,this.video&&(a=this.l==jg?132:80,b=this.video,b.v("updateDimensions(%d,%d)\n",a,80<a&&this.j&Nf?14:24),b.u=a,b.ia=b.Ka,80<a&&b.ia--,kg(b)&&lg(b))))};f.Bf=function(){for(var a="",b=1;b<=this.h.length;b++)a+=this.O("%04x%c",this.h[b-1],b%10?" ":"\n");return a};
var gg=1,Nf=2,Of=4,eg=32,Wf=64,fg=128,Mf=0,jg=16,hg=32,ig=48,Pf=0,Qf=32,Rf=0,Sf=0,Tf=0,Uf=0,ag=0,Yf=1,dg=2,bg=4,Zf=5,cg=6,Xf=7,$f=16383,Lf={66:[Kf.prototype.Lf,Kf.prototype.vk],98:[null,Kf.prototype.Ak],162:[null,Kf.prototype.yk],194:[null,Kf.prototype.xk]};u.VT100Chips=Kf;
function mg(a,b,c){F.call(this,a,b,c);this.time=G(this,"Time");this.ports=G(this,"Ports");Cd(this.ports,this,ng);this.o={};for(var d in og)this.o[d]=yb(this,og[d],!1);this.m=G(this,"Input");Rb(this.m,this);(this.s=yb(this,"ledCaps"))&&Nb(this.m,this.Of.bind(this));this.ma()}n(mg,F);f=mg.prototype;f.ya=function(a){var b=a.shift();return this.W==b?(this.g=a.shift(),this.j=a.shift(),this.h=a.shift(),this.l=a.shift(),!0):!1};
f.za=function(a){a.push(this.W);a.push(this.g);a.push(this.j);a.push(this.h);a.push(this.l)};f.Of=function(a,b){Mc(this.s,0,0,b?1:Fc)};f.ra=function(a){this.X||(this.X=G(this,"CPU"));pg(this,a?this.g:void 0)};f.ma=function(){this.g=qg;this.j=rg;this.h=!1;this.l=0;this.i=-1;pg(this)};f.Gc=function(){this.h&&jd(this.time)>=this.l&&(this.h=!1);return!this.h};
f.Nf=function(a){var b=this.j;if(0<=this.i){var c=this.m;var d=this.i,e=-1;d<c.g.length&&(e=c.g[d].Hc);c=e;0<=c?(this.i++,c&128&&(c&=127)):(this.i=-1,c=sg);this.j=c;jf(this.X,1)}this.v(p.kc+p.qa,"inUARTAddress(%#04x): %#04x\n",a,b);return b};f.Bk=function(a,b){this.v(p.kc+p.qa,"outUARTStatus(%#04x): %#04x\n",a,b);pg(this,b,this.g);this.g=b;this.h=!0;this.l=jd(this.time)+kd(this.time,1.2731488);b&tg&&(this.i=0,jf(this.X,1))};
function pg(a,b,c){for(var d in a.o){var e=a.o[d];if(e){var g=+d,h=void 0,k=1,l=1;void 0!=b&&(g&g-1?(g=~g&255,h=!(b&g)):h=b&g,void 0!=c&&(k=(b^c)&g,l=0));k&&(Mc(e,0,0,h?1:Fc),l&&Dc(e))}}}
var rg=127,sg=127,tg=64,qg=0,ug=C.ab+1,vg=C.ab+2,wg=C.ab+3,xg=C.ab+4,Z={},Sb=(Z[C.Zb]=3,Z[C.sc]=5,Z[C.rc]=6,Z[C.Cc]=7,Z[C.wc]=8,Z[C.Ac]=9,Z[C.Q]=10,Z[C.Db]=16,Z[C.af]=20,Z[C.Be]=21,Z[C.ec]=22,Z[C.yc]=23,Z[C.tc]=24,Z[C.E]=25,Z[C.ONE]=26,Z[C.mc]=32,Z[C.ad]=34,Z[C.oe]=35,Z[wg]=35,Z[C.Xd]=36,Z[C.$c]=37,Z[C.sd]=38,Z[C.xd]=39,Z[C.kd]=40,Z[C.Bd]=41,Z[C.fd]=42,Z[C.Dd]=48,Z[C.le]=49,Z[C.je]=50,Z[C.ge]=51,Z[C.dd]=52,Z[C.ZERO]=53,Z[C.cd]=54,Z[C.yd]=55,Z[C.jd]=56,Z[C.Cd]=57,Z[C.xc]=58,Z[C.Ne]=64,Z[C.me]=65,Z[C.ke]=
66,Z[C.Ge]=67,Z[C.pe]=68,Z[vg]=68,Z[C.Yd]=69,Z[C.lc]=70,Z[C.jc]=71,Z[C.cc]=72,Z[C.bc]=73,Z[C.wb]=74,Z[C.Oe]=80,Z[C.xb]=81,Z[C.Ie]=82,Z[C.He]=83,Z[C.$e]=85,Z[C.wd]=86,Z[C.fc]=87,Z[C.dc]=88,Z[C.ac]=89,Z[C.uc]=90,Z[C.Qe]=96,Z[C.ne]=97,Z[C.Le]=98,Z[C.Ke]=99,Z[C.xb]=100,Z[C.We]=101,Z[C.be]=102,Z[C.qc]=103,Z[C.Yb]=104,Z[C.Bc]=105,Z[C.qe]=106,Z[C.Pe]=112,Z[C.Je]=113,Z[C.Me]=114,Z[C.Se]=115,Z[C.ff]=117,Z[C.oc]=118,Z[C.zd]=119,Z[C.zc]=120,Z[C.$b]=121,Z[C.Ib]=122,Z[C.re]=123,Z[ug]=123,Z[C.yb]=124,Z[C.vc]=125,
Z[C.Ya]=126,Z[xg]=[124,121],Z),Tb={keySetup:ug,keyLineFeed:vg,keyTab:C.xc,keyEsc:C.fd,keyBreak:wg,keyCtrl:C.yb,keyCtrlC:xg,keyCtrlLock:[C.nc,C.yb],keyShiftLock:[C.nc,C.vc],keyCapsLock:C.Ya},yg={},og=(yg[1]="led4",yg[2]="led3",yg[4]="led2",yg[8]="led1",yg[16]="ledLocked",yg[32]="ledLocal",yg[223]="ledOnline",yg),ng={130:[mg.prototype.Nf,mg.prototype.Bk]};u.VT100Keyboard=mg;
function zg(a,b,c){F.call(this,a,b,c);this.N=this.J.irq||2;this.S=this.J.portBase||0;this.time=G(this,"Time");this.ports=G(this,"Ports");Cd(this.ports,this,Ag,this.S);this.H={};for(var d in Bg)this.H[d]=yb(this,Bg[d],!1);this.U=Ub(this.time,this.W+".receive",this.Td.bind(this));this.Y=Ub(this.time,this.W+".transmit",this.Mk.bind(this));this.i="";this.h=this.m=this.L=null;this.exports={connect:this.Pd,receiveData:this.Td,receiveStatus:this.Ik};this.ma()}n(zg,F);f=zg.prototype;
f.Pd=function(a){if(!this.h){var b=Cb(this,"connection");if(b){var c=b.split("->");if(2==c.length){var d=c[0].trim();if(d!=this.W)return;c=c[1].trim();if(this.h=yb(this,c)){var e=this.h.exports;if(e){var g=e.connect;g&&g.call(this.h,this.K);if(this.m=e.receiveData){this.K=a;this.L=e.receiveStatus;this.v("Connected %s.%s to %s\n",this.aa,d,c);return}}}}this.v("Unable to establish connection: %s\n",b)}}};
f.ya=function(a){var b=a.shift();return this.W==b?(this.o=a.shift(),this.u=a.shift(),this.I=a.shift(),this.g=a.shift(),this.l=a.shift(),this.j=a.shift(),this.s=a.shift(),!0):!1};f.za=function(a){a.push(this.W);a.push(this.o);a.push(this.u);a.push(this.I);a.push(this.g);a.push(this.l);a.push(this.j);a.push(this.s)};f.ra=function(){this.X||(this.X=G(this,"CPU"),this.Pd(this.K))};f.ma=function(){this.o=!1;this.I=this.u=0;this.g=Cg;this.l=Dg;this.j=Eg;this.s=Fg;Gg(this)};
function Hg(a,b){var c=a.s&b;b&15||(c>>=4);b=Ig[c];c=((a.l&Jg)>>2)+6;a.l&Kg&&c++;c+=((a.l&Lg)>>6)+1>>1;return 1E3/(b/c)|0}f.Gc=function(){return!!(this.g&Mg)};f.Td=function(a){null!=a&&(this.i="number"!=typeof a?a:this.i+String.fromCharCode(a));this.i&&(a=this.i.charCodeAt(0),this.v(p.Oa,"receiveByte(%#04x): status=%#04x\n",a,this.g),this.M||this.g&Ng||!this.X?a=!1:(this.u=a,this.g|=Ng,jf(this.X,this.N),a=!0),a&&(this.i=this.i.substr(1)),this.i&&ec(this.time,this.U,Hg(this,Og)));return!0};
f.Ik=function(a){this.g&=~Pg;a&ya.bd.Ca&&(this.g|=Pg)};f.Mk=function(a){this.g=this.g|Mg|Qg;return a?this.m?this.m.call(this.h,a):!1:!0};f.Kf=function(a){var b=this.u;this.v(p.Oa+p.qa,"inData(%#04x): %#04x\n",a,b);this.g&=~Ng;return b};f.Mf=function(a){var b=this.g;this.v(p.Oa+p.qa,"inStatus(%#04x): %#04x\n",a,b);return b};
f.zk=function(a,b){this.v(p.Oa+p.qa,"outData(%#04x): %#04x\n",a,b);this.I=b;this.g&=~(Mg|Qg);a:{this.v(p.Oa,"transmitByte(%#04x)\n",b);if(this.Z){if(19==b){this.M=!0;break a}if(17==b){this.M=!1;break a}}this.m&&this.m.call(this.h,b)}ec(this.time,this.Y,Hg(this,Rg))};
f.wk=function(a,b){this.v(p.Oa+p.qa,"outControl(%#04x): %#04x\n",a,b);this.o?(this.L&&(b^this.j)&(Sg|Tg)&&(a=0,this.K?(a|=b&Sg?ya.ee.Ca:0,a|=b&Tg?ya.bd.Ca|ya.$d.Ca:0):(a|=b&Sg?ya.cf.Ca:0,a|=b&Tg?ya.ie.Ca:0),this.L.call(this.h,a)),Gg(this,b,this.j),this.j=b,this.j&Ug&&(this.o=!1)):(this.l=b,this.o=!0)};f.uk=function(a,b){this.v(p.Oa+p.qa,"outBaudRates(%#04x): %#04x\n",a,b);this.s=b};
function Gg(a,b,c){for(var d in a.H){var e=a.H[d];if(e){var g=+d,h=void 0,k=1,l=1;void 0!=b&&(g&g-1?(g=~g&255,h=!(b&g)):h=b&g,void 0!=c&&(k=(b^c)&g,l=0));k&&(Mc(e,0,0,h?1:Fc),l&&Dc(e))}}}var Jg=12,Kg=16,Lg=192,Dg=142,Tg=2,Sg=32,Ug=64,Eg=39,Mg=1,Ng=2,Qg=4,Pg=128,Cg=133,Og=15,Rg=240,Fg=238,Ig=[50,75,110,134.5,150,200,300,600,1200,1800,2E3,2400,3600,4800,9600,19200],Vg={},Bg=(Vg[Tg]="ledDTR",Vg[Sg]="ledRTS",Vg),Ag={0:[zg.prototype.Kf,zg.prototype.zk],1:[zg.prototype.Mf,zg.prototype.wk],2:[null,zg.prototype.uk]};
u.VT100Serial=zg;
function Wg(a,b,c){Pc.call(this,a,b,c);this.va=p.Ed;this.Z=this.J.bufferAddr;this.Gf=this.J.bufferRAM;this.u=this.J.bufferWidth;this.L=this.J.bufferHeight;this.Ka=this.ia=this.J.cellWidth||1;this.ga=this.J.cellHeight||1;this.M=null;this.lb=!1;this.ob=this.J.bufferBits||1;this.xa=this.J.interruptRate;this.Fd=this.J.refreshRate||60;this.Ta=this.K/this.u|0;this.jb=this.s/this.L|0;1<this.ga&&(this.L++,this.$=0,this.oa=!1);this.H=yb(this,this.J.bus);kg(this);this.M=this.J.fontROM;lg(this);this.X=G(this,
"CPU");this.time=G(this,"Time");this.Gd=Ub(this.time,this.W,this.Hd.bind(this));this.time.S.push(this);ec(this.time,this.Gd,1E3/Math.max(this.Fd,this.xa))}n(Wg,Pc);Wg.prototype.Jc=function(){this.time.g||Uc(this)};
function kg(a){a.ca=a.u*a.ia;a.fa=a.L*a.ga;var b=a.ca,c=a.fa;a.U=0;if(!a.Gf&&(a.U=(a.ca*a.ob>>3)*a.fa,!ud(a.H,a.Z,a.U,vd.$a)))return!1;Tc(a,(a.u+1)*a.L);a.S=document.createElement("canvas");a.S.width=b;a.S.height=c;a.Ea=a.S.getContext("2d");a.I={};a.If=1<<a.ob;a.Y=Array(a.If);a.Y[0]=[0,0,0,255];a.Y[1]=[255,255,255,255];a.Hb=60;a.pa=!1;a.N=Array(a.u);a.Uc&&(a.o[a.Uc]=null==a.nb?!1:a.nb);return!0}
function lg(a){a.M&&(a.lb=!0,a.I[Xg]=[Yg(a,a.ia,a.ga),Yg(a,a.ia,a.ga,a.pa)],a.I[Zg]=[Yg(a,2*a.ia,a.ga),Yg(a,2*a.ia,a.ga,a.pa)],a.I[$g]=a.I[ah]=[Yg(a,2*a.ia,2*a.ga),Yg(a,2*a.ia,2*a.ga,a.pa)])}
function Yg(a,b,c,d){a.v("createFontVariation(cxCell=%d, cyCell=%d, fUnderline=%b\n",b,c,d);var e=8>=a.Ka?8:16,g=8<e?15:0,h=a.M.length/e,k=!1===d,l={ia:b,ga:c};l.canvas=document.createElement("canvas");l.canvas.width=16*b;l.canvas.height=h/16*c;l.context=l.canvas.getContext("2d");for(var r=l.context.createImageData(b,c),t=0;t<h;t++){for(var q=0,x=q;q<a.ga;q++){var w=t*e+(g+q&e-1);w=d&&8==q?255:a.M[w];for(var z=0;z<c/a.ga;z++){for(var y=0,B=0,A=B;B<a.ia;B++){var da=w&128>>(7<B?7:B);y=a.lb&&!da&&y?
y:da;for(var fa=0;fa<b/a.ia;fa++){k&&(y=!y);var ma=r,ra=A+x*ma.width,W=a.Y[y?1:0];ra*=W.length;ma.data[ra]=W[0];ma.data[ra+1]=W[1];ma.data[ra+2]=W[2];ma.data[ra+3]=W[3];A++}y=da}x++}}l.context.putImageData(r,(t&15)*b,(t>>4)*c)}return l}function Tc(a,b){a.ka=!1;b&&(a.Fb=b,void 0===a.l||a.l.length!=a.Fb)&&(a.l=Array(a.Fb))}
Wg.prototype.Hd=function(a){var b=!0;if(!a){this.xa&&jf(this.X,4);if(b&&this.ka&&this.U){var c=this.H,d=this.Z,e=this.U,g=!0,h=d>>>c.h;for(d=c.blockSize-(d&c.i);0<e&&h<c.g.length;){var k=c.g[h];k.L?(k.L=!1,k.j.type==rd&&(k.l?(k.K=k.Qc,k.o=k.Tc):(k.sa=k.Qc,k.ja=k.Tc)),k=!0):k=!1;k&&(g=!1);e-=d;d=c.blockSize;h++}g&&(b=!1)}ec(this.time,this.Gd,1E3/Math.max(this.Fd,this.xa))}b&&Uc(this,a)};
function Uc(a,b){for(var c=0,d,e=-1,g=60==a.Hb?2:5,h=0,k=0,l=-1,r=a.Z;c<a.L;){var t=0,q=r,x=a.u;d=e;for(d!=Xg&&(x>>=1);;){var w=a.H.na(q++);if((w&bh)==bh){w=a.H.na(q++);e=w&ch;r=(w&dh)<<8|a.H.na(q);r+=w&eh?fh:gh;break}if(t<x)a.N[t++]=w;else break}if(g)g--;else{for(;t<a.N.length;)a.N[t++]=0;if(0<=d)for(q=a.ka&&a.l[h]==x,a.l[h++]=x,x=0;x<t;x++){var z=a.N[x];if(!q||z!==a.l[h]){a.l[l=h]=z;w=a;var y=a.Ea;var B=z&127;if(z=w.I[d][z&128?1:0]){var A=(B&15)*z.ia,da=(B>>4)*z.ga,fa=z.ia,ma=z.ga;if(y){var ra=
x*w.ia;var W=c*w.ga;var la=w.ia;B=w.ga}else ra=x*w.Ta,W=c*w.jb,la=w.Ta,B=w.jb;z.ia>w.ia&&(ra*=2,la*=2);z.ga>w.ga&&(d==ah&&(da+=w.ga),ma=w.ga);y?y.drawImage(z.canvas,A,da,fa,ma,ra,W,la,B):w.o.drawImage(z.canvas,A,da,fa,ma,ra,W,la,B)}k++}h++}c++}}a.ka=!0;!b&&a.oa&&1==k&&(a.l[l]=-1,k=0);a.oa=!1;(k||b)&&a.Ea&&a.o.drawImage(a.S,0,a.$,a.ca,a.fa-a.ga,0,0,a.mf,a.Ef)}var Xg=96,Zg=64,$g=32,ah=0,bh=127,dh=15,eh=16,ch=96,fh=8192,gh=16384;u.VT100Video=Wg;
function hh(a,b,c){F.call(this,a,a);var d=this;this.i=!1;this.o=c;this.h="";this.m=this.l=!1;Fb(this,!1);this.va=p.fe;b=b.trim();"{"==b[0]?ih(this,b):(this.h=b,cb(this.h,function(e,g,h,k){4==h&&(!k&&g?(ih(d,g),jh(d)):d.v("error (%d) loading configuration: %s\n",k,e))}));window.addEventListener("load",function(){d.m=!0;jh(d)});window.addEventListener(hb("iOS")?"pagehide":hb("Opera")?"unload":"beforeunload",function(){kh(d)});window.addEventListener("pageshow",function(){d.i||d.ra(!0)})}n(hh,F);
hh.prototype.Ua=function(a,b){var c=this;switch(a){case lh:b.onclick=function(){c.ra()};break;case mh:b.onclick=function(){c.ma()}}F.prototype.Ua.call(this,a,b)};
function jh(a){var b=!0;if(a.l&&a.m){for(var c in a.g){var d=void 0,e=a.g[c];try{d=e["class"],u[d]?"Machine"==d?(a.v("PCjs %s v%3.2f\n%s\n",e.name,3,"Copyright \u00a9 2012-2023 Jeff Parsons <Jeff@pcjs.org>"),a.h&&a.v("Configuration: %s\n",a.h)):new u[d](a.aa,c,e):a.v('unrecognized %s device "%s"\n',d,c)}catch(h){e.optional||(a.v('error initializing %s device "%s": %s\n',d,c,h.message),b=!1),Hb(a,c)}}if(a.j){var g=ib(a);Bb(a,function(h){return h.Rb&&!h.Rb(g)?(h.v('unable to restore state for device "%s"\n',
h.W),!1):!0})}Fb(a,!0);Gb(a,a.ra.bind(a,b))||a.v("machine %s not ready to power, waiting for device(s)\n",a.aa)}}
function ih(a,b){try{a.g=JSON.parse(b);var c=a.g[a.aa];if(!c){c=a.g[Oa(a.h)];if(!c)throw Error("configuration missing machine ID");a.g[a.aa]=c}zb(a,c,["autoSave","autoStart"]);a.j=!1!==a.J.autoSave;a.s=!1!==a.J.autoStart;if(a.o){var d=eval("("+a.o+")"),e;for(e in d)a.J[e]=d[e]}a.l=!0}catch(g){c=g.message,(d=c.match(/position ([0-9]+)/))&&(c+=" ('"+b.substr(+d[1],40).replace(/\s+/g," ")+"...')"),a.v("machine '%s' initialization error: %s\n",a.aa,c)}}
hh.prototype.ra=function(a){a=void 0===a?!this.i:a;if(Eb(this)){var b=this;a&&this.v("power on\n");Bb(this,function(c){c.ra&&c!=b&&("CPU"!=c.J["class"]||b.s&&Eb(b)?c.ra(a):c.time.update(!0));return!0});(this.i=a)||this.v("power off\n")}};hh.prototype.ma=function(){if(Eb(this)){var a=this;Bb(this,function(b){b.ma&&b!=a&&b.ma();return!0});this.v("reset\n")}};function kh(a){if(a.j){var b=[];Bb(a,function(c){c.bb&&c.bb(b);return!0});qb(a,b)}a.ra(!1)}var lh="power",mh="reset";
window.VT100=function(a,b,c){var d=new hh(a,b,c);window.command=function(e){return jb(d,e)};return d};u.Machine=hh;})()

//# sourceMappingURL=vt100.js.map
