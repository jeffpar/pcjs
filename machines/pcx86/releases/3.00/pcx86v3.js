(function(){/*
 https://www.pcjs.org/modules/v3/defines.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v3/numio.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v1/format.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v3/stdio.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v3/webio.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v3/device.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v3/input.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v3/led.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v3/monitor.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v3/time.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v3/bus.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v3/memory.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v3/ram.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v3/rom.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v3/cpu.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v3/debugger.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v3/cpux86.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v3/dbgx86.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v3/video.js (C) 2012-2023 Jeff Parsons
 https://www.pcjs.org/modules/v3/machine.js (C) 2012-2023 Jeff Parsons
*/
var l;function aa(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}function q(a){if(!(a instanceof Array)){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];a=b?b.call(a):{next:aa(a)};for(var c=[];!(b=a.next()).done;)c.push(b.value);a=c}return a}
var ba="function"==typeof Object.create?Object.create:function(a){function b(){}b.prototype=a;return new b},ca="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};
function da(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");}var ea=da(this);function t(a,b){if(b)a:{var c=ea;a=a.split(".");for(var d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))break a;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&ca(c,a,{configurable:!0,writable:!0,value:b})}}var fa;
if("function"==typeof Object.setPrototypeOf)fa=Object.setPrototypeOf;else{var ha;a:{var ia={a:!0},ja={};try{ja.__proto__=ia;ha=ja.a;break a}catch(a){}ha=!1}fa=ha?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var ka=fa;
function x(a,b){a.prototype=ba(b.prototype);a.prototype.constructor=a;if(ka)ka(a,b);else for(var c in b)if("prototype"!=c)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d)}else a[c]=b[c];a.Bf=b.prototype}function la(){for(var a=Number(this),b=[],c=a;c<arguments.length;c++)b[c-a]=arguments[c];return b}
t("Math.trunc",function(a){return a?a:function(b){b=Number(b);if(isNaN(b)||Infinity===b||-Infinity===b||0===b)return b;var c=Math.floor(Math.abs(b));return 0>b?-c:c}});t("Math.log2",function(a){return a?a:function(b){return Math.log(b)/Math.LN2}});
t("String.prototype.replaceAll",function(a){return a?a:function(b,c){if(b instanceof RegExp&&!b.global)throw new TypeError("String.prototype.replaceAll called with a non-global RegExp argument.");return b instanceof RegExp?this.replace(b,c):this.replace(new RegExp(String(b).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08"),"g"),c)}});
t("String.prototype.repeat",function(a){return a?a:function(b){if(null==this)throw new TypeError("The 'this' value for String.prototype.repeat must not be null or undefined");var c=this;if(0>b||1342177279<b)throw new RangeError("Invalid count value");b|=0;for(var d="";b;)if(b&1&&(d+=c),b>>>=1)c+=c;return d}});t("Number.isNaN",function(a){return a?a:function(b){return"number"===typeof b&&isNaN(b)}});
t("Symbol",function(a){function b(g){if(this instanceof b)throw new TypeError("Symbol is not a constructor");return new c(d+(g||"")+"_"+e++,g)}function c(g,f){this.u=g;ca(this,"description",{configurable:!0,writable:!0,value:f})}if(a)return a;c.prototype.toString=function(){return this.u};var d="jscomp_symbol_"+(1E9*Math.random()>>>0)+"_",e=0;return b});
t("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),c=0;c<b.length;c++){var d=ea[b[c]];"function"===typeof d&&"function"!=typeof d.prototype[a]&&ca(d.prototype,a,{configurable:!0,writable:!0,value:function(){return ma(aa(this))}})}return a});function ma(a){a={next:a};a[Symbol.iterator]=function(){return this};return a}
function na(a,b){a instanceof String&&(a+="");var c=0,d=!1,e={next:function(){if(!d&&c<a.length){var g=c++;return{value:b(g,a[g]),done:!1}}d=!0;return{done:!0,value:void 0}}};e[Symbol.iterator]=function(){return e};return e}t("Array.prototype.keys",function(a){return a?a:function(){return na(this,function(b){return b})}});
t("Array.prototype.fill",function(a){return a?a:function(b,c,d){var e=this.length||0;0>c&&(c=Math.max(0,e+c));if(null==d||d>e)d=e;d=Number(d);0>d&&(d=Math.max(0,e+d));for(c=Number(c||0);c<d;c++)this[c]=b;return this}});function A(a){return a?a:Array.prototype.fill}t("Int8Array.prototype.fill",A);t("Uint8Array.prototype.fill",A);t("Uint8ClampedArray.prototype.fill",A);t("Int16Array.prototype.fill",A);t("Uint16Array.prototype.fill",A);t("Int32Array.prototype.fill",A);
t("Uint32Array.prototype.fill",A);t("Float32Array.prototype.fill",A);t("Float64Array.prototype.fill",A);t("Number.parseInt",function(a){return a||parseInt});t("Array.prototype.values",function(a){return a?a:function(){return na(this,function(b,c){return c})}});function oa(){}var pa=new ArrayBuffer(2);(new DataView(pa)).setUint16(0,256,!0);new Uint16Array(pa);var B={zb:0xffffffffffff,NONE:0,Gc:0,Da:0x800000000000};
"undefined"!=typeof window&&(window.PCjs||(window.PCjs={}),window.PCjs.machines||(window.PCjs.machines={}),window.PCjs.components||(window.PCjs.components=[]));var C="undefined"!=typeof window?window.PCjs.machines:{},qa="undefined"!=typeof window?window.PCjs.components:[],D={};D.Defines=oa;function ra(){}x(ra,oa);
function sa(a,b){if(a){b||(b=10);var c,d=0<a.indexOf(",");d&&(a=a.replace(/,/g,""));var e=c=a.charAt(0);"#"==c?(b=8,c=""):"$"==c&&(b=16,c="");e!=c?a=a.substr(1):(e=c=a.substr(0,2),"0b"==c&&d||"^B"==c?(b=2,c=""):"0o"==c||"^O"==c?(b=8,c=""):"^D"==c?(b=10,c=""):"0x"==c&&(b=16,c=""),e!=c&&(a=a.substr(2)));e=c=a.slice(-1);"Y"==c||"y"==c?(b=2,c=""):"."==c?(b=10,c=""):"H"==c||"h"==c?(b=16,c=""):"K"==c?c="000":"M"==c?c="000000":"G"==c&&(c="000000000");e!=c&&(a=a.slice(0,-1)+c);var g;e=0;10>=b&&(c=a.match(/(-?[0-9]+)B([0-9]*)$/))&&
(a=c[1],e=35-((c[2]||35)&255));if((b&&10!=b?16==b?null!==a.match(/^-?[0-9a-f]+$/i):8==b?null!==a.match(/^-?[0-7]+$/):2==b&&null!==a.match(/^-?[01]+$/):null!==a.match(/^[+-]?[0-9]+$/))&&!isNaN(g=parseInt(a,b))){e&&(0>g&&(g+=Math.pow(2,36)),g=0<e?g*Math.pow(2,e):Math.trunc(g/Math.pow(2,-e)));var f=g}}return f}
function E(a,b,c,d,e){d=void 0===d?0:d;var g=void 0===g?0:g;var f="",h="",k=-1;c||(c=a.da||10);d&&(k=Math.ceil(d/Math.log2(c)));if(void 0==e)switch(c){case 8:e="0o";break;case 16:e="0x";break;case 10:h=".";default:e=""}isNaN(b)||"number"!=typeof b?(b=void 0,e=h=""):(0>b&&-1<b&&(b=-1),d&&(0>b&&(b+=Math.pow(2,d)),b>=Math.pow(2,d)&&(k=Math.ceil(Math.log(b)/Math.log(c)))));for(a=g||-1;k--;){a||(f=","+f,a=g);if(void 0==b){if(f="?"+f,0>k)break}else if(d=b%c,b=Math.trunc(b/c),d+=0<=d&&9>=d?48:55,f=String.fromCharCode(d)+
f,!b&&0>k)break;a--}return e+f+h}function ta(a,b){var c=a/F|0,d=b/F|0;return(a&b)==(b|0)&&(c&d)==d}var F=Math.pow(2,32);D.NumIO=ra;function ua(){this.u={};for(var a=0;22>a;a++)this.u["ACDFGHMNSTWYbdfjcsoXx%"[a]]=null}ua.prototype.g=function(a,b){return this.u[a]?!1:(this.u[a]=b,!0)};
function va(){var a=la.apply(0,arguments);if(void 0===a[0])a=new Date(Date.now());else if("string"===typeof a[0]){var b=a[0];0>b.indexOf(":")?b+=" "+(a[1]||"00:00:00 UTC"):b.match(/^[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9] [0-9][0-9]:[0-9][0-9]:[0-9][0-9]$/)&&(a[1]||(b+=" UTC"));a=new Date(b)}else a=void 0===a[1]?new Date(a[0]):new Date(Date.UTC.apply(Date,q(a)));return a}
ua.prototype.I=function(a){var b=la.apply(1,arguments);if(!b||!b.length)return a;var c="",d=a.split(/%([-+ 0#]*)([0-9]*|\*)(\.[0-9]+|)([bwhlL]?)([A-Za-z%])/),e=0,g;for(g=0;g<d.length-6;g+=6){c+=d[g];var f=d[g+5];if(void 0===this.u[f])c+="%"+d[g+1]+d[g+2]+d[g+3]+d[g+4]+f;else{if(e<b.length){var h=b[e];"%"!=f&&e++}else h=b[b.length-1];var k=d[g+1],n=0<=k.indexOf("#"),p=0<=k.indexOf("0"),m=d[g+2];"*"==m?(m=h,h=e<b.length?b[e++]:b[b.length-1]):m=+m||0;var r=d[g+3];r=r?+r.substr(1):-1;var v=d[g+4],w=null,
u=0,z="",y=0<="ACDFGHMNSTWY".indexOf(f)&&"object"!=typeof h?va(h):h;switch(f){case "C":c+=isNaN(y.getTime())?void 0:this.I("%#W, %#F %#D, %#Y".replaceAll("#",n?"#":""),y);continue;case "D":h=n?y.getUTCDate():y.getDate();f="d";break;case "A":case "G":case "H":h=n?y.getUTCHours():y.getHours();"A"==f?(h=12>h?"am":"pm",f="s"):("G"==f&&(h=h?12<h?h-12:h:12),f="d");break;case "F":case "M":h=n?y.getUTCMonth():y.getMonth();"F"==f?(h=wa[h],f="s"):(h++,f="d");break;case "N":h=n?y.getUTCMinutes():y.getMinutes();
f="d";break;case "S":h=n?y.getUTCSeconds():y.getSeconds();f="d";break;case "T":c+=isNaN(y.getTime())?void 0:this.I("%#Y-%#02M-%#02D %#02H:%#02N:%#02S".replaceAll("#",n?"#":""),y);continue;case "W":h=xa[n?y.getUTCDay():y.getDay()];f="s";break;case "Y":h=n?y.getUTCFullYear():y.getFullYear(),0<r&&(h%=Math.pow(10,r),r=-1),f="d"}switch(f){case "b":c+=h?"true":"false";break;case "d":h=Math.trunc(h),0<=r&&(p=!0,m<r&&(m=r),r=-1);case "f":h=+h;f=h+"";0<=r&&(f=h.toFixed(r));f.length<m&&(p?(0>h&&(m--,f=f.substr(1)),
f=("0".repeat(m)+f).slice(-m),0>h&&(f="-"+f)):f=(" ".repeat(m)+f).slice(-m));c+=f;break;case "j":c+=JSON.stringify(h,null,m||void 0);break;case "c":h="string"==typeof h?h[0]:String.fromCharCode(h);case "s":if(void 0!=h)for("string"!=typeof h&&(h=h.toString()),0<=r&&(h=h.substr(0,r));h.length<m;)h=0<=k.indexOf("-")?h+" ":" "+h;c+=h;break;case "o":u=8,n&&(z="0o");case "X":w=ya;case "x":f="";u||(u=16);!z&&n&&(z="0x");w||(w=za);h=Math.trunc(h);0<=r&&(p=!0,m<r&&(m=r));p&&!m&&("b"==v?m=2:"h"==v||"w"==v?
m=4:"l"==v?m=8:(m=Math.abs(h),m=255>=m?2:65535>=m?4:4294967295>=m?8:9),m+=z.length);m-=z.length;do n=16,Number.isNaN(h)||(n=h&u-1,h=Math.trunc(h/u)),p||!f||n||h?f=w[n]+f:(z&&(f=z+f,z=""),0<m&&(f=" "+f));while(0<--m||h);c+=z+f;break;case "%":c+="%";break;default:c=this.u[f]?c+this.u[f](f,k,m,r,h):c+("(unimplemented sprintf type: %"+f+")")}}}return c+=d[g]};var za="0123456789abcdef?",ya="0123456789ABCDEF?",xa="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),wa="January February March April May June July August September October November December".split(" ");
function G(){this.Oa=new ua;this.Wb=this.Oa.g.bind(this.Oa);this.u=this.Oa.I.bind(this.Oa)}x(G,ra);G.prototype.flush=function(){var a=Aa;Aa="";this.Aa(a)};function Ba(a){var b=a,c=a.lastIndexOf("/");0<=c&&(b=a.substr(c+1));c=b.indexOf("&");0<c&&(b=b.substr(0,c));c=b.lastIndexOf(".");0<c&&(b=b.substring(0,c));return b}
G.prototype.Aa=function(a,b){var c=a.lastIndexOf("\n");b?0<=c&&(b=Date.now(),Ca||(Ca=b),a=((b-Ca)/1E3).toFixed(3)+": "+a):(0<=c&&(console.log(Aa+a.substr(0,c)),Aa="",a=a.substr(c+1)),Ca=null);Aa+=a;return a.length};G.prototype.s=function(a){return this.Aa(this.u.apply(this,[a].concat(q(la.apply(1,arguments)))))};var Aa="",Ca=null;D.StdIO=G;function H(a){G.call(this);this.V={};this.ga=0;this.I=this;a&&(this.I.ga=0,this.I.wa=[],this.I.la=0,this.I.Pa={},this.I.Na=!1)}var Da;x(H,G);l=H.prototype;
l.ya=function(a,b){var c=this,d=this;switch(a){case Ea.Bc:b.onclick=function(){var e=c.ua(Ea.Sa,!0);e&&(e.value="")};break;case Ea.Sa:Fa(b),b.addEventListener("keydown",function(e){Ga(d,e,!0)}),b.addEventListener("keypress",function(e){Ga(d,e)})}};function Ha(a,b){var c=Ia.Eb;a.I.Pa[c]||(a.I.Pa[c]=[]);a.I.Pa[c].push(b)}function Fa(a){a.setAttribute("autocapitalize","off");a.setAttribute("autocomplete","off");a.setAttribute("autocorrect","off");a.setAttribute("spellcheck","false");a.value=""}
l.error=function(a,b){b=this.u.apply(this,[a].concat(q(b)));var c="%s";a=!1;"boolean"==typeof c&&(a=c,c=b.shift());if(b=this.u.apply(this,[c].concat(q(b))))this.s("%s\n",b),a||alert(b)};l.ua=function(a){return this.V[a]};function Ja(a,b,c){if(a){do{for(var d=0;d<Ka.length;d++){var e=Ka[d];if(c){if(e+=c,b+e in a)return e}else if(e=e?e+b[0].toUpperCase():b[0],e+=b.substr(1),e in a)return e}if(0>b.indexOf("screen"))break;b=b.replace("screen","Screen")}while(1)}return null}
function La(a,b){return a.m.bindings&&a.m.bindings[b]}function Ma(a){if(a=a.V[Na])var b=a.textContent;return b}function Oa(a,b,c){a=+a||0;a<b&&(a=b);a>c&&(a=c);return a}function I(a,b,c,d){a=a.m[b];void 0===a?a=c:(d&&void 0!==d[a]&&(a=d[a]),d=typeof c,typeof a!=d&&("boolean"==d?a=!!a:"number"==typeof c&&(a=+a)));return a}
function Pa(a,b){var c=0,d=null,e=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP");e.onreadystatechange=function(){4!==e.readyState?b(a,d,e.readyState,c):(d=e.responseText,200==e.status||!e.status&&d.length&&"file:"==(window?window.location.protocol:"file:")||(c=e.status||-1),b(a,d,e.readyState,c))};e.open("GET",a,!0);e.send()}
function Qa(){var a,b=Da;if(!b){b={};if(window){a||(a=window.location.search.substr(1));for(var c,d=/\+/g,e=/([^&=]+)=?([^&]*)/g;c=e.exec(a);)b[decodeURIComponent(c[1].replace(d," ")).trim()]=decodeURIComponent(c[2].replace(d," ")).trim()}Da=b}return b}function Ra(a){if(void 0===J.gb){var b=!1;if(window)try{window.localStorage.setItem(J.Ha,J.Ha),b=window.localStorage.getItem(J.Ha)==J.Ha,window.localStorage.removeItem(J.Ha)}catch(c){a.s("%s\n",c.message),b=!1}J.gb=b}return!!J.gb}
function Sa(a,b){b=void 0===b?0:b;1<b&&b%2&&b--;b=b||a.ga;return-1==(b|1)||ta(a.I.ga,b)?!0:!1}function K(a){if(window){var b=window.navigator.userAgent;return"iOS"==a&&(!!b.match(/(iPod|iPhone|iPad)/)||"MacIntel"===window.navigator.platform&&1<window.navigator.maxTouchPoints)||"MSIE"==a&&!!b.match(/(MSIE|Trident)/)||0<=b.indexOf(a)}return!1}function Ta(a){var b=null;if(Ra(a)){var c;if(window)try{(c=window.localStorage.getItem(a.N))&&(b=JSON.parse(c))}catch(d){a.s("%s\n",d.message)}}return b}
function Ga(a,b,c){b=b||window.event;var d=b.which||b.keyCode;if(d){var e=a.I,g=b.target;if(c){a=!1;var f;c=g.value;var h=c.lastIndexOf("\n");d==L.Bb&&g.selectionStart<=h+1&&(a=!0);d==L.zd?(a=!0,0<e.la&&(f=e.wa[--e.la])):d==L.Ic&&(a=!0,e.la<e.wa.length&&(f=e.wa[++e.la]||""));a&&b.preventDefault();void 0!=f&&(g.value=c.substr(0,h+1)+f)}else d=String.fromCharCode(d),f=g.value,c=f.lastIndexOf("\n"),g.selectionStart<=c&&g.setSelectionRange(f.length,f.length),b.stopPropagation(),"@"==d&&0<e.la&&c+1==f.length&&
(g.value+=e.wa[--e.la],d="\r"),"\r"==d&&(b.preventDefault(),f=g.value+="\n",g.blur(),g.focus(),(b=Ua(a,f.slice(f.lastIndexOf("\n",f.length-2)+1,-1)||""))&&a.s("%s\n",b.replace(/\n$/,"")))}}function Va(a){if(window){var b=window.onresize;window.onresize="function"!==typeof b?a:function(){b&&b();a()}}}function Wa(a){return"true"==a||"on"==a?!0:"false"==a||"off"==a?!1:void 0}
function Xa(a,b){if(void 0!=b){var c=a.I;try{if(b=b.trim())c.la<c.wa.length&&b==c.wa[c.la]?c.la++:(c.wa.push(b),c.la=c.wa.length);var d=b.split(" "),e=d[0],g=a.I.Pa[Ia.Eb];switch(e[0]){case "m":if("?"==e[1]){var f="";Ya.forEach(function(m){f+=m+"\n"});f&&(f="message commands:\n"+f);break}f="";var h=void 0;e=d[d.length-1].toLowerCase();var k=Wa(e);void 0!=k&&d.pop();1>=d.length&&(void 0!=k&&(h=k,k=void 0),d[1]="all");"all"==d[1]&&(d=Object.keys(M));for(g=1;g<d.length;g++){e=d[g];var n=M[e];if(!n){f+=
"unrecognized message: "+e+"\n";break}void 0!=k&&Za(a,n,k);if(void 0==h||h==Sa(a,n))f+=a.u("%8s: %b\n",e,Sa(a,n))}Sa(a,B.Da)&&(f+="all messages will be buffered until buffer is turned off\n");f||(f="no messages\n");break;case "?":f="",$a.forEach(function(m){f+=m+"\n"}),f&&(f="default commands:\n"+f);default:if(d.unshift(b),g)for(a=0;a<g.length;a++){var p=g[a](d);if(void 0!=p){f=f?f+p:p;break}}}}catch(m){f="error: "+m.message+"\n"}}return f}
function Ua(a,b){b=void 0===b?"?":b;if(b){var c="";b=b.split(/(?:\n|;\s*)/);for(var d=0;d<b.length;d++)c+=Xa(a,b[d])}return c}l.Aa=function(a,b){void 0==b&&(b=Sa(this,B.Da));if(!b){var c=this.ua(Ea.Sa,!0);if(c)return c.value.substr(-a.length)!=a&&(c.value+=a,8192<c.value.length&&(c.value=c.value.substr(c.value.length-4096)),c.scrollTop=c.scrollHeight,K("iOS")||c.setSelectionRange(c.value.length,c.value.length)),a.length}return G.prototype.Aa.call(this,a,b)};
l.s=function(a){var b=la.apply(1,arguments),c=0;"number"==typeof a&&(c=a,a=b.shift());return Sa(this,c)?G.prototype.s.call.apply(G.prototype.s,[this,a].concat(q(b))):0};function ab(a,b){if(Ra(a)){b=JSON.stringify(b);try{window.localStorage.setItem(a.N,b)}catch(c){a.s("%s\n",c.message)}}}function bb(a,b,c){(a=a.V[b])&&a.textContent!=c&&(a.textContent=c)}
function Za(a,b,c){var d=!1;c?(c=a.I.ga,a.I.ga=(c|b)+(c/F|0|b/F|0)*F):(d=ta(a.I.ga,B.Da)&&ta(b,B.Da),c=a.I.ga,a.I.ga=(c&~b)+((c/F|0)&~(b/F|0))*F);d&&a.flush()}
var Ea={Bc:"clear",Sa:"print"},$a=["\u2191 \u2193\t\trecall commands","@\t\trepeat last command","m?\t\tmessage commands"],Ya=["m\t\tdisplay all messages","m on\t\tdisplay all active messages","m off\t\tdisplay all inactive messages","m all [on|off]\tturn all messages on or off","m ... [on|off]\tturn selected messages on or off"],M={all:B.zb,buffer:B.Da},Ia={Eb:"command"},cb={Gb:13,fb:65,Ab:66,Cb:67,Hb:68,E:69,Jb:70,Lb:71,Mb:72,Nb:73,Ob:74,Pb:75,Rb:76,Ub:77,Vb:78,Xb:79,Yb:80,Q:81,$b:82,bc:83,ec:84,
hc:85,jc:86,lc:87,mc:88,nc:89,kb:90,a:97,b:98,c:99,d:100,e:101,f:102,sf:103,tf:104,uf:105,vf:106,k:107,wf:108,xf:109,n:110,yf:111,p:112,q:113,r:114,zf:115,t:116,Df:117,Ef:118,w:119,x:120,y:121,z:122},L={Bb:8,td:9,Xc:10,Gb:13,qd:16,Ec:17,yc:18,cf:19,hb:20,ee:27,sd:32,ff:33,ef:34,de:35,ze:36,Tb:37,zd:38,ib:39,we:39,Ic:40,te:44,gf:44,Ae:45,ce:46,ve:46,ye:47,ZERO:48,ONE:49,yd:50,ud:51,Tc:52,Sc:53,rd:54,pd:55,Jc:56,bd:57,Qc:59,Pc:61,fb:65,Ab:66,Cb:67,Hb:68,E:69,Jb:70,Lb:71,Mb:72,Nb:73,Ob:74,Pb:75,Rb:76,
Ub:77,Vb:78,Xb:79,Yb:80,Q:81,$b:82,bc:83,ec:84,hc:85,jc:86,lc:87,mc:88,nc:89,kb:90,Db:91,ue:91,se:92,kf:93,xe:93,Ee:96,Ve:96,re:96,Fe:97,Te:97,Ge:98,Se:98,He:99,Ye:99,Ie:100,We:100,Je:101,Pe:101,Ke:102,$e:102,Le:103,Ue:103,Me:104,bf:104,Ne:105,Ze:105,Xe:106,Oe:107,af:109,Qe:110,Re:111,fe:112,je:113,ke:114,le:115,me:116,ne:117,oe:118,pe:119,qe:120,ge:121,he:122,ie:123,cd:144,md:145,Oc:173,nd:186,Kc:187,ae:188,Fc:189,df:190,mf:191,Zd:192,Be:219,$d:220,jf:221,hf:222,Nc:224,Ce:901,kc:1E3},db={},eb=(db[L.Qc]=
L.nd,db[L.Pc]=L.Kc,db[L.Oc]=L.Fc,db[L.Nc]=L.Db,db),fb={Tb:1,ib:2,De:3},N={},gb=(N[L.Bb]="\b",N[L.td]="\t",N[L.Xc]="\n",N[L.Gb]="\r",N[L.sd]=" ",N[L.ZERO]="0",N[L.ONE]="1",N[L.yd]="2",N[L.ud]="3",N[L.Tc]="4",N[L.Sc]="5",N[L.rd]="6",N[L.pd]="7",N[L.Jc]="8",N[L.bd]="9",N[L.fb]="A",N[L.Ab]="B",N[L.Cb]="C",N[L.Hb]="D",N[L.E]="E",N[L.Jb]="F",N[L.Lb]="G",N[L.Mb]="H",N[L.Nb]="I",N[L.Ob]="J",N[L.Pb]="K",N[L.Rb]="L",N[L.Ub]="M",N[L.Vb]="N",N[L.Xb]="O",N[L.Yb]="P",N[L.Q]="Q",N[L.$b]="R",N[L.bc]="S",N[L.ec]=
"T",N[L.hc]="U",N[L.jc]="V",N[L.lc]="W",N[L.mc]="X",N[L.nc]="Y",N[L.kb]="Z",N[L.Tb]="Left",N[L.ib]="Right",N),Ka=["","moz","ms","webkit"],hb={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",
crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",
forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",
lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",
moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",
seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},J={gb:void 0,Ha:"PCjs.localStorage"};D.WebIO=H;
function O(a,b,c,d){a=void 0===a?"default":a;b=void 0===b?a:b;c=void 0===c?{}:c;d=void 0===d?[]:d;H.call(this,a==b);this.N=a;this.W=b;C[this.N]||(C[this.N]={});C[this.N][this.W]&&this.s("warning: machine configuration contains multiple '%s' devices\n",this.W);C[this.N][this.W]=this;this.id=this.N==this.W?this.N:this.N+"."+this.W;qa.push(this);this.I=ib(this,this.N);this.ready=!0;jb(this,c,d);this.Qa={};this.Zb=[]}x(O,H);l=O.prototype;l.lb=function(){};l.mb=function(){};
function jb(a,b,c){c=b.overrides||c;if(c.length){var d=Qa();for(h in d)if(0<=c.indexOf(h)){var e=d[h],g=sa(e,10);void 0==g&&("true"==e?g=!0:"false"==e?g=!1:(g=e,e='"'+e+'"'));b[h]=g;a.s("overriding %s property '%s' with %s\n",a.W,h,e)}}a.m=b;c=b.bindings;c=void 0===c?{}:c;if("undefined"!=typeof document){a.m.V||(a.m.V=c);(d=Array.isArray(c))?0>c.indexOf("container")&&c.push("container"):c.container||(c.container=a.W);for(var f in c){e=c[f];if(d)f=e;else if(e.match(/^[0-9]+$/)){var h=+e;a.V[f]=[];
do{e=f+h++;e=document.getElementById(e);if(!e)break;a.V[f].push(e)}while(1);continue}if(h=document.getElementById(e))a.V[f]=h,a.ya(f,h)}}b=void 0===b?{}:b;a.version=3;if(a.version){f="";var k;a.N!=a.W&&(k=ib(a,a.N).version)&&k!=a.version&&(f="Machine");f||(k=b.version)&&k>a.version&&(f="Config");f&&(k=a.u("%s Device version (%3.2f) incompatible with %s version (%3.2f)",b.pf,a.version,f,k),a.error("%s\n\nClearing your browser's cache may resolve the issue.",k))}}
function kb(a,b){var c;try{var d=C[a.N];if(d)for(c in d){var e=d[c];if(e.W!=e.N&&!b(e))return!1}return!0}catch(g){a.s("error while enumerating device '%s': %s\n",c,g.message)}return!1}l.ua=function(a,b){b=void 0===b?!1:b;if(a){var c=H.prototype.ua.call(this,a,b);if(void 0===c&&b){b=C[this.N];for(var d in b)if(c=b[d].V[a])break;c||(c=null);this.V[a]=c}}return c};
function ib(a,b,c){var d=b,e=a.N,g=e.indexOf(".");0<g&&(e=e.substr(0,g),b=b.substr(g+1));b=(g=C[e])&&g[b]||null;if(!b){for(g=0;g<qa.length;g++)if(qa[g].id===d){b=qa[g];break}if(!b&&(void 0===c||c))throw Error(a.u('no "%s" device',d));}return b}function P(a,b,c){var d=null,e=C[a.N];if(e)for(var g in e)if(e[g].m["class"]==b){if(d){d=null;break}d=e[g]}if(!d&&(void 0===c||c))throw Error(a.u("no %s device",b));return d}function lb(a,b){var c=ib(a,a.N);return c&&c.m&&c.m[b]||a.m[b]}
function mb(a,b){return(a=a.Qa[b])&&a.get()}function nb(a){return a==a.I&&a.ready?kb(a,function(b){return nb(b)}):a.ready}function ob(a,b){b=void 0===b?a.ready:b;a.ready=b;if(nb(a)){for(;b=a.Zb.pop();)b();a!=a.I&&ob(a.I)}}function pb(a,b){if(nb(a))return b(),!0;a.Zb.push(b);return!1}l.tc=function(){};
l.s=function(a){var b=la.apply(1,arguments);return"number"==typeof a&&Sa(this,a)&&(void 0===this.ca&&(this.ca=P(this,"Debugger",!1)),this.ca&&this.ca.tc(a),this.I.ga&B.yb&&(void 0===this.T&&(this.T=P(this,"CPU")),this.T))?(a=b.shift(),H.prototype.s.call(this,"%#06x: %s.%s\n",this.T.rb,this.W,this.u.apply(this,[a].concat(q(b))).trim())):H.prototype.s.call.apply(H.prototype.s,[this,a].concat(q(b)))};function qb(a,b){(a=C[a.N])&&delete a[b]}function rb(a,b,c){(a=a.Qa[b])&&a.set&&a.set(c)}B.yb=1;
B.zc=2;B.Mc=4;B.Yc=8;B.gd=16;B.Ac=32;B.Wc=64;B.od=128;B.Zc=256;B.Dc=512;B.$c=1024;B.INT=2048;B.xd=4096;B.Bd=8192;B.Ra=16384;B.ld=32768;B.Hc=65536;B.Rc=131072;B.Ga=262144;B.vd=524288;B.Ib=1048576;B.na=2097152;B.Qb=4194304;B.ad=8388608;B.wd=16777216;B.Vc=33554432;B.jb=67108864;B.Lc=134217728;B.Uc=268435456;B.be=4294967296;M.addr=B.yb;M.bus=B.zc;M.fault=B.Mc;M.memory=B.Yc;M.ports=B.gd;M.chips=B.Ac;M.kbd=B.Wc;M.serial=B.od;M.misc=B.Zc;M.cpu=B.Dc;M.mmu=B.$c;M["int"]=B.INT;M.trap=B.xd;M.video=B.Bd;
M.monitor=B.Ra;M.screen=B.ld;M.disk=B.Hc;M.file=B.Rc;M.time=B.Ga;M.timer=B.vd;M.event=B.Ib;M.input=B.na;M.key=B.Qb;M.mouse=B.ad;M.touch=B.wd;M.info=B.Vc;M.warn=B.jb;M.error=B.Lc;M.halt=B.Uc;D.Device=O;
function sb(a,b,c){O.call(this,a,b,c);this.ga=B.na;this.Z=this.M=null;this.time=P(this,"Time");this.I=P(this,"Machine");this.ea=I(this,"drag",!1);this.X=I(this,"scroll",!1);this.ba=I(this,"hexagonal",!1);this.l=I(this,"releaseDelay",0);this.o=!1;a=this.m.map;this.h=this.j=null;if(a)if(a.length)this.h=a;else{this.j={};b=Object.keys(a);for(var d=0;d<b.length;d++){var e=[],g=b[d],f=a[g];"string"==typeof f?f=[f]:void 0==f.length&&(e=f.grid,f=f.keys,"string"==typeof f&&(f=[f]));this.j[g]={keys:f,grid:e,
state:0}}}this.R=[];this.S=[];this.H=!1;this.i=this.J=null;(a=this.V[tb])&&ub(this,a,this.ua(c.focusBinding,!0),this.m.location);this.ma()}x(sb,O);function vb(a,b){a.M=b}function wb(a,b,c){for(var d=0;d<a.R.length;d++){var e=a.R[d];e.id===b&&e.Xa(b,c)}}
function ub(a,b,c,d){d=void 0===d?[]:d;if(d.length||a.h||a.j){var e={};e.Xd=d[0]||0;e.Yd=d[1]||0;e.Ja=d[2]||b.clientWidth;e.Va=d[3]||b.clientHeight;e.Ya=d[4]||1;e.cb=d[5]||1;e.Md=d[6]||b.naturalWidth||e.Ja;e.Od=d[7]||b.naturalHeight||e.Va;e.wc=d[8]||0;e.xc=d[9]||0;e.Ld=d[10]||0;e.Nd=d[11]||0;a.h?(e.$a=a.h.length,e.Ka=a.h[0].length):(e.Ka=e.Ya,e.$a=e.cb,e.Ya=e.cb=0);e.qc=e.Ja/(e.Ka+e.Ka*e.Ya)|0;e.rc=e.Va/(e.$a+e.$a*e.cb)|0;e.Kd=e.qc*e.Ya|0;e.sc=e.rc*e.cb|0;e.Ma=e.eb=-1;xb(a,b,e);zb(a,b,e);a.time&&
a.l&&(a.Y=Ab(a.time,"timerInputRelease",function(){0>e.Ma&&0>e.eb&&Bb(a,-1,-1)}))}if(a.h||a.j)a.time&&a.l&&(a.fa=Ab(a.time,"timerKeyRelease",function(){Cb(a)})),a.v=0,a.L="",a.K=[],d=b,c&&(d=c,a.i||"BUTTON"!=c.nodeName||(d=document,a.i=c,Db(a,b),a.J=b)),Db(a,d),a.i||(a.i=d)}function Eb(a){a.l?Fb(a.time,a.fa,a.l):Cb(a)}
function Db(a,b){function c(e,g,f){var h=document.activeElement;a.s(B.Qb+B.Ib,"%s.onKey%s(%d): %5.2f (%s)\n",h.id||h.nodeName,e,g,Date.now()/1E3%60,void 0!=f?f?"used":"unused":"ignored")}function d(e,g){e=document.activeElement;return a.i&&e!=a.i&&e!=a.J?null:g||window.event}b.addEventListener("keydown",function(e){if(e=d(this,e)){var g=e.which||e.keyCode,f=Gb(a,g,!0,e);c("Down",g,f);f&&e.preventDefault()}});b.addEventListener("keypress",function(e){if(e=d(this,e)){var g=e.which||e.charCode,f=Gb(a,
g);c("Press",g,f);f&&e.preventDefault()}});b.addEventListener("keyup",function(e){if(e=d(this,e)){var g=e.which||e.keyCode,f=Gb(a,g,!1,e);c("Up",g);f&&e.preventDefault();"TEXTAREA"==b.nodeName&&(b.value="")}})}
function xb(a,b,c){b.addEventListener("mousedown",function(d){if(!a.o){var e=a.H?a.J:a.i;if(e){var g=window.scrollX,f=window.scrollY;e.focus();window.scrollTo(g,f)}d.button||Q(a,b,Hb,d,c)}});b.addEventListener("mousemove",function(d){a.o||Q(a,b,Ib,d,c)});b.addEventListener("mouseup",function(d){a.o||d.button||Q(a,b,Jb,d,c)});b.addEventListener("mouseout",function(d){a.o||(0>c.Ma?Q(a,b,Ib,d,c):Q(a,b,Jb,d,c))})}
function zb(a,b,c){b.addEventListener("touchstart",function(d){a.X&&(a.o=!0);Q(a,b,Hb,d,c)});b.addEventListener("touchmove",function(d){Q(a,b,Ib,d,c)});b.addEventListener("touchend",function(d){Q(a,b,Jb,d,c)})}
function Gb(a,b,c,d){if(void 0!=c){var e=eb[b]||b;var g=gb[b];var f=Kb[e];d=d&&d.location==fb.ib;f&Lb&&d&&(f>>=1);f&&(f&Mb&&(c=!(a.g&f)),a.g=c?a.g|f:a.g&~f,wb(a,e,c))}else g=String.fromCharCode(b).toUpperCase(),b>=cb.fb&&b<=cb.kb?a.g&(Nb|Ob)||(a.g|=Ob,wb(a,L.hb,!0)):b>=cb.a&&b<=cb.z&&a.g&Ob&&(a.g&=~Ob,wb(a,L.hb,!1));if(a.h){if(void 0!=c)return!1;for(e=0;e<a.h.length;e++)for(f=a.h[e],d=0;d<f.length;d++)if(0<=f[d].split("|").indexOf(g))return a.v?16>a.K.length&&a.K.push(b):(a.v=1,a.L=g,Bb(a,d,e),wb(a,
g,!0),Eb(a)),!0}if(a.j){if(void 0==c)return!0;b=Object.keys(a.j);for(e=0;e<b.length;e++)if(f=b[e],0<=a.j[f].keys.indexOf(g))return wb(a,f,c),a.j[f].state=c?1:0,!0}return!1}function Cb(a){1==a.v?(a.v++,wb(a,a.L,!1),a.L="",Bb(a,-1,-1),Eb(a)):(a.v=0,a.K.length&&Gb(a,a.K.shift()))}sb.prototype.ma=function(){this.g=0;this.U=this.$=-1};
function Q(a,b,c,d,e){var g=-1,f=-1,h=!1,k=-1,n=-1;if(c<Jb){d=d||window.event;d.targetTouches&&d.targetTouches.length?(k=d.targetTouches[0].clientX,n=d.targetTouches[0].clientY,h=1<d.targetTouches.length):(k=d.clientX,n=d.clientY);var p=d.target.getBoundingClientRect();k-=p.left;n-=p.top;k=e.Md/b.offsetWidth*k|0;n=e.Od/b.offsetHeight*n|0;var m=k-e.Xd;var r=n-e.Yd;var v=p=!1;var w=k>=e.wc&&k<e.wc+e.Ld&&n>=e.xc&&n<e.xc+e.Nd;if(0<=m&&m<e.Ja&&0<=r+e.sc||w)if(h||a.X||d.preventDefault(),0<=m&&m<e.Ja&&0<=
r&&r<e.Va){v=!0;d=e.Ja/e.Ka|0;var u=e.Va/e.$a|0,z=m/d|0,y=r/u|0;!a.ba||y&1||(m-=d>>1,z=m/d|0,z==e.Ka-1&&(m=-1));u=y*u+(e.sc>>1);m-=z*d+(e.Kd>>1);r-=u;0<=m&&m<e.qc&&0<=r&&r<e.rc&&(g=z,f=y,p=!0)}}m=m||0;r=r||0;d=b.offsetWidth;b=b.offsetHeight;if(c==Hb||c==Jb)for(z=0;z<a.S.length;z++)y=a.S[z],c==Jb?y.Xa(y.id,!1):(u=r/(b/y.rf|0)|0,(m/(d/y.qf|0)|0)==y.Ff&&u==y.Gf&&y.Xa(y.id,!0));if(!h)if(c==Hb)e.Ma=k,e.eb=n,v?(Bb(a,g,f),p&&a.l&&Fb(a.time,a.Y,a.l,!0)):w&&a.I.ja();else if(c==Ib)0<=e.Ma&&0<=e.eb&&a.ea?Bb(a,
g,f):a.M&&a.M(g,f);else if(c==Jb){if(c=a.l)c=a.time,g=a.Y,c=c.g&&0<g&&g<=c.h.length?0<=c.h[g-1].ia:!1;c||Bb(a,-1,-1);e.Ma=e.eb=-1}else a.s("unrecognized action: %d\n",c)}function Pb(a){var b=a.H?a.J:a.i;b&&nb(a.I)&&(a.s(B.na,'setFocus("%s")\n',b.id||b.nodeName),b.focus(),b.scrollIntoView())}function Bb(a,b,c){if(b!=a.U||c!=a.$)a.U=b,a.$=c,a.Z&&a.Z(b,c)}
var Hb=1,Ib=2,Jb=3,tb="surface",Nb=3,Lb=170,Ob=512,Mb=3584,R={},Kb=(R[L.qd]=2,R[L.Ec]=8,R[L.yc]=32,R[L.Db]=128,R[L.hb]=Ob,R[L.cd]=1024,R[L.md]=2048,R);D.Input=sb;
function Qb(a,b,c){O.call(this,a,b,c,["color","backgroundColor"]);a=this.V[Rb];if(!a)throw Error("LED "+this.m.V[Rb]+" binding for '"+Rb+"' missing");b=document.createElement("canvas");if(!b||!b.getContext)throw a.innerHTML="LED device requires HTML5 canvas support",Error("LED device requires HTML5 canvas support");this.Ba=La(this,Rb)+".canvas";b.setAttribute("id",this.Ba);this.type=Oa(I(this,"type",Sb,Tb),Ub,Vb);this.j=Wb[this.type][0];this.H=Wb[this.type][1];this.width=I(this,"width",this.j);this.height=
I(this,"height",this.H);this.l=I(this,"cols",1);this.M=this.l+I(this,"colsExtra",0);this.Y=I(this,"rows",1);this.R=this.Y+I(this,"rowsExtra",0);this.ea=this.width*this.l;this.Z=this.height*this.Y;this.v=Xb("black",0);this.i=Yb(this.m.color)||this.v;this.ra=Xb(this.i,1,.25);this.pa=Xb(this.i,1,2);this.o=Yb(this.m.backgroundColor);this.sa=I(this,"fixed",!1);this.sa||(b.style.width="100%",b.style.height="auto");this.oa=I(this,"hexagonal",!1);this.ta=I(this,"highlight",!0);this.X=I(this,"persistent",
this.type<Vb);b.setAttribute("width",this.ea.toString());b.setAttribute("height",this.Z.toString());b.style.backgroundColor=this.v;a.appendChild(b);this.fa=b.getContext("2d");if(this.J=document.createElement("canvas"))this.J.width=this.ba=this.j*this.l,this.J.height=this.K=this.H*this.Y,this.g=this.J.getContext("2d");this.Ta=(this.R+1)*this.M*4;this.h=Array(this.Ta);this.Ua=this.l<this.M?4*(this.M-this.l):0;this.S=this.U=!1;this.L=this.$=0;this.ha=-1;var d=this;this.time=P(this,"Time");Zb(this.time,
function(e,g){$b(d,!1,e,g)});ac(d)}x(Qb,O);function ac(a){for(var b=a.h,c=0;c<b.length;c+=4){var d=a,e=b,g=c;e[g]=d.type<Vb?bc:" ";e[g+1]=d.i==d.v?null:d.i;e[g+2]=0;e[g+3]=cc}a.S=a.U=!0;$b(a,!0)}function dc(a){a.o?(a.g.fillStyle=a.o,a.g.fillRect(0,0,a.ba,a.K)):a.g.clearRect(0,0,a.ba,a.K)}
function $b(a,b,c,d){b=void 0===b?!1:b;c=void 0===c?0:c;d=void 0===d?60:d;if(a.S||b){if(a.type<Vb){d=0;if(!a.X||b)dc(a);else if(a.L){d=a.l-a.L;var e=a.j*d;a.g.drawImage(a.J,a.j*a.L,0,e,a.K,0,0,e,a.K)}for(var g=e=0;g<a.R;g++){for(var f=0;f<a.l;f++){var h=a.h[e],k=a.h[e+1]||a.v,n=a.ta&&e==a.ha;if(a.h[e+3]&cc||n||b){if(f>=d)a:{var p=a,m=h;h=k;var r=f;k=g;var v=n;r=void 0===r?0:r;k=void 0===k?0:k;v=void 0===v?!1:v;var w=0;if(p.oa&&!(k&1)&&(w=p.j>>1,r==p.l-1))break a;if(h&&h!=p.i){v=v?Xb(h,1,2):h;var u=
Xb(h,1,.25)}else v=v?p.pa:p.i,u=p.ra;h=!1;m=m?v:u;v==p.v&&(m=p.o,h=!0);v=r*p.j+w;u=k*p.H;p.X&&(r=r*p.j+w,k*=p.H,p.o?(p.g.fillStyle=p.o,p.g.fillRect(r,k,p.j,p.H)):p.g.clearRect(r,k,p.j,p.H));p.g.fillStyle=m;k=ec[p.type];3==k.length?(p.g.beginPath(),p.g.arc(v+k[0],u+k[1],k[2],0,2*Math.PI),h?(p.g.globalCompositeOperation="destination-out",p.g.fill(),p.g.globalCompositeOperation="source-over"):p.g.fill()):p.g.fillRect(v+k[0],u+k[1],k[2],k[3])}a.h[e+3]=n?a.h[e+3]|cc:a.h[e+3]&~cc}e+=4}e+=a.Ua}a.L=0}else{b=
"";for(d=0;d<a.h.length;d+=4)b+=a.h[d]||" ",a.h[d+3]&fc&&(b+=".");dc(a);for(g=e=d=0;d<b.length;d++){k=b[d];"."==k&&e&&e--;f=a;n=e;p=g;n=void 0===n?0:n;p=void 0===p?0:p;if(k=gc[k])for(h=0;h<k.length;h++)if(r=f,w=hc[k[h]]){m=(void 0===n?0:n)*r.j;v=(void 0===p?0:p)*r.H;r.g.fillStyle=r.i;r.g.beginPath();if(3==w.length)r.g.arc(m+w[0],v+w[1],w[2],0,2*Math.PI);else for(u=0;u<w.length;u+=2)u?r.g.lineTo(m+w[u],v+w[u+1]):r.g.moveTo(m+w[u],v+w[u+1]);r.g.closePath();r.g.fill()}if(++e==a.l&&(e=0,++g==a.R))break}}a.fa.globalCompositeOperation=
a.o&&a.i!=a.v?"source-over":"copy";a.fa.drawImage(a.J,0,0,a.ba,a.K,0,0,a.ea,a.Z);a.S=!1;a.ha=-1}else a.X||a.U||(!c||!a.$||c-a.$>=(1E3/d|0))&&ac(a);a.U=!1;c&&(a.$=c)}function Yb(a){return(a=a||void 0)&&hb[a]||a}
function Xb(a,b,c){b=void 0===b?1:b;c=void 0===c?1:c;if(a){var d=[];a=hb[a]||a;var e=16;var g=a.match(/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i);g||(e=10,g=a.match(/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,?\s*(\d+|)\)$/i));if(g){var f;for(f=1;f<g.length;f++)d[f-1]=Number.parseInt(g[f],e);d.length=f-1;e=!0}else e=!1;if(e){a="rgba(";for(e=0;3>e;e++)g=Math.round(d[e]*c),g=0>g?0:255<g?255:g,a+=g+",";a+=(e<d.length?d[e]:b)+")"}}return a}
Qb.prototype.va=function(a){var b=a.shift(),c=a.shift();a=a.shift();if(b==this.i&&c==this.o&&a&&a.length==this.h.length){this.h=a;for(b=0;b<=this.h.length-4;b+=4)this.h[b+1]==this.v&&(this.h[b+1]=null);$b(this,!0);return!0}return!1};Qb.prototype.xa=function(a){this.h&&(a.push(this.i),a.push(this.o),a.push(this.h))};
var Ub=0,Sb=1,Vb=3,Tb={small:Ub,round:Sb,square:2,digit:Vb},Rb="container",bc=0,fc=1,cc=128,ic={},ec=(ic[Ub]=[4,4,4],ic[Sb]=[16,16,14],ic[2]=[2,2,28,28],ic),Wb=[[8,8],[32,32],[32,32],[96,128]],hc={A:[30,8,79,8,67,19,37,19],B:[83,10,77,52,67,46,70,22],C:[77,59,71,100,61,89,64,64],D:[28,91,58,91,69,104,15,104],E:[18,59,28,64,25,88,12,100],F:[24,10,34,21,31,47,18,52],G:[24,56,34,50,60,50,71,56,61,61,33,61],P:[80,102,8]},gc={" ":[],0:"ABCDEF".split(""),1:["B","C"],2:["A","B","D","E","G"],3:["A","B","C",
"D","G"],4:["B","C","F","G"],5:["A","C","D","F","G"],6:"ACDEFG".split(""),7:["A","B","C"],8:"ABCDEFG".split(""),9:"ABCDFG".split(""),A:"ABCEFG".split(""),B:["C","D","E","F","G"],C:["A","D","E","F"],D:["B","C","D","E","G"],E:["A","D","E","F","G"],F:["A","E","F","G"],"-":["G"],".":["P"]};D.LED=Qb;
function S(a,b,c){O.call(this,a,b,c);var d=this;this.ba=this.m.touchType;this.Z=this.m.diagnostics;this.H=this.m.monitorWidth||640;this.o=this.m.monitorHeight||480;this.i=this.V[T.Ra];if(!this.i)throw Error("unable to find binding: "+T.Ra);this.g=this.ua(T.Cc)||this.i;b=this.V[T.cc];if(!b){b=document.createElement("canvas");if(a=La(this,T.cc))this.V[a]=b,b.setAttribute("id",a);b.setAttribute("class","pcjs-surface");b.setAttribute("width",this.m.monitorWidth);b.setAttribute("height",this.m.monitorHeight);
b.style.backgroundColor=this.m.monitorColor||"black";this.i.appendChild(b)}this.j=b;this.v=a=b.getContext("2d");K("MSIE")&&(this.i.onresize=function(f,h,k,n){return function(){h.style.height=(f.clientWidth*n/k|0)+"px"}}(this.i,b,this.m.monitorWidth,this.m.monitorHeight),this.i.onresize());(c=+(this.m.aspect||Qa().aspect))&&.3<=c&&3.33>=c&&(Va(function(f,h,k){return function(){h.style.height=(f.clientWidth/k|0)+"px"}}(this.i,b,c)),window.onresize());this.K=this.J=this.I.Na=!1;if(c=this.V[T.Kb])if(b=
Ja(this.g,"requestFullscreen")){this.g.Wa=this.g[b];this.K=!0;this.J=document.fullscreenEnabled||K("Edge/");if(b=Ja(document,"on","fullscreenchange")){var e=Ja(document,"fullscreenElement");document.addEventListener(b,function(){jc(d,null!=document[e])},!1)}(b=Ja(document,"on","fullscreenerror"))&&document.addEventListener(b,function(){jc(d)},!1)}else this.s("Full-screen API not available\n"),c.parentNode.removeChild(c);if(this.ba||this.Z||this.K&&!K("iOS")){var g=document.createElement("textarea");
if(b=La(this,T.dd))this.V[b]=g,g.setAttribute("id",b);g.setAttribute("class","pcjs-overlay");K("iOS")&&(Fa(g),g.style.fontSize="16px");this.i.appendChild(g)}(this.l=P(this,"Input",!1))&&ub(this.l,g||this.i,this.ua(this.m.focusBinding,!0));Qa();if(this.h=this.m.monitorRotate)this.h=this.h%360,0<this.h&&(this.h-=360),-90!=this.h?(this.s("unsupported monitor rotation: %d\n",this.h),this.h=0):(a.translate(0,this.o),a.rotate(this.h*Math.PI/180),a.scale(this.o/this.H,this.H/this.o))}x(S,O);
S.prototype.ya=function(a,b){var c=this;switch(a){case T.Kb:b.onclick=function(){c.I.Na=1>=window.outerHeight-window.innerHeight;c.I.Na||c.Wa()}}O.prototype.ya.call(this,a,b)};function kc(a){a.v&&(a.v.fillStyle="black",a.v.fillRect(0,0,a.j.width,a.j.height))}
S.prototype.Wa=function(){var a=!1;if(this.g&&this.g.Wa){a="100%";if(screen&&screen.width&&screen.height){var b=screen.width/screen.height,c=this.H/this.o;b>c&&(a=Math.round(c/b*100)+"%")}this.J?(this.j.style.width=a,this.j.style.height="auto",this.j.style.display="block",this.j.style.margin="auto"):(this.g.style.width=a,this.g.style.height="auto");this.L=this.g.style.backgroundColor;this.g.style.backgroundColor="black";this.g.Wa();this.l&&(a=this.l,a.H=!0,Pb(a));a=!0}return a};
function jc(a,b){a.I.Na=!0;b||(a.g&&(a.J?a.j.style.width=a.j.style.height="":a.g.style.width=a.g.style.height="",a.L&&(a.g.style.backgroundColor=a.L)),a.I.Na=!1);a.l&&!b&&(a=a.l,a.H=!1,Pb(a))}S.prototype.ja=function(a){a?this.$=!1:kc(this)};S.prototype.ma=function(){kc(this)};var T={Cc:"container",cc:"surface",Ra:"monitor",dd:"overlay",Kb:"fullScreen"};D.Monitor=S;
function lc(a,b,c){O.call(this,a,b,c);this.ta=I(this,"cyclesMinimum",1E5);this.dc=I(this,"cyclesMaximum",1E9);this.ha=Oa(I(this,"cyclesPerSecond",1E6),this.ta,this.dc);this.ba=60;this.ea=0;this.Z=1E3/this.ba;this.fc=I(this,"updatesPerSecond",2)||2;this.Dd=1E3/this.fc;this.Ua=0;this.Ed=I(this,"timeLock",!0);this.sa=this.M=0;this.ra=this.l=1;this.Ta=this.v=this.ha/1E4/100;this.oa=[];this.K=[];this.h=[];this.U=[];this.Ba=this.g=this.X=this.J=!1;this.L=this.j=0;a=Ja(window,"requestAnimationFrame");if(!a){a=
"setTimeout";var d=this.Z}this.ic=window[a].bind(window,this.Ud.bind(this),d);this.Cd=window[Ja(window,"cancelAnimationFrame")||"clearTimeout"].bind(window);this.Y=this.$=this.o=this.i=this.fa=0;mc(this)||nc(this,this.ra)}x(lc,O);function Zb(a,b){a.oa.push(b)}l=lc.prototype;
l.ya=function(a,b){var c=this;switch(a){case oc:b.onclick=function(){pc(c)&&(c.g?qc(c):c.start())};break;case rc:b.onclick=function(){nc(c,c.l<<1);sc(c,tc(c.v))};break;case uc:b.onclick=function(){vc(c)};break;case wc:b.addEventListener("mousedown",function(){c.J=!0}),b.addEventListener("mouseup",function(){mc(c);c.J=!1}),b.addEventListener("mousemove",function(){c.J&&mc(c)}),b.addEventListener("change",function(){c.J=!0;mc(c);c.J=!1})}O.prototype.ya.call(this,a,b)};
function Ab(a,b,c){var d=void 0===d?-1:d;var e=a.h.length+1;a.h.push({id:b,Fd:c,Za:d,ia:-1});0<=d&&Fb(a,e,d);return e}
function xc(a,b,c,d){var e=0,g=a.v,f=1E6*g;b&&c&&(g=b/(10*c)/100,a.s(B.Ga,"calcSpeed(%d cycles, %5.3fms): %5.3fMhz\n",b,c,g),d>a.Z&&(1<a.l&&(a.l>>=1,a.s(B.jb,"warning: frame time (%5.3fms) exceeded maximum (%5.3fms), target multiplier now %d\n",d,a.Z,a.l)),e=d));a.M=g;a.sa=g/a.Ta;b=a.sa/a.l;a.fa=f/b/a.ba+1E-8;a.s(B.Ga,"nCyclesDepositPerFrame(%5.3f) = nCyclesPerSecond(%d) / nDivisor(%5.3f) / nFramesPerSecond(%d)\n",a.fa,f,b,a.ba);return e}
function zc(a,b){a.$=a.o=b;if(!a.K.length)return a.o=0,a.$;for(var c=0;0<a.o;){if(c<a.K.length){var d=a.K[c++];b=d.Vd.call(d,b)||1}else c=b=0;a.o-=b}return a.$-a.o}function Ac(a,b){b=void 0===b?a.$-a.o:b;if(!a.g){if(a.i)for(var c=0;c<a.K.length;c++){var d=a.K[c];d.Wd.call(d)}a.i=b}a.i-=b;1>a.i&&(a.X=!0);a.Y+=b;a.$=a.o=0;a.g||(a.Y=0);return b}
function Bc(a,b){b=void 0===b?0:b;if(b){var c=b;a.i+=b}else for(c=a.i,1>c&&(c=a.i+=a.fa),0>c&&(a.s(B.Ga,"warning: cycle count dropped below zero: %f\n",c),c=a.i=0),c|=0,b=a.h.length;0<b;b--){var d=a.h[b-1];!(0>d.ia)&&c>d.ia&&(c=d.ia)}return c}function tc(a){1<=a?a=a.toFixed(2)+"Mhz":(a=Math.round(1E6*a),a=999>=a?a+"Hz":Math.ceil(a/1E3)+"Khz");return a}function Cc(a){a.s(B.Ga,"getSpeedCurrent(%5.3fhz)\n",1E6*a.M);return a.g&&a.M?tc(a.M):"Stopped"}
function pc(a){return a.Ba?!0:(a.s("not powered\n"),!1)}function Dc(a,b){if(1<=b)for(var c=a.h.length;0<c;c--){var d=a.h[c-1];0>d.ia||(d.ia-=b,0>=d.ia&&(d.ia=-1,d.Fd(),0<=d.Za&&Fb(a,c,d.Za)))}}l.ja=function(a){this.Ba=a;void 0===this.ca&&(this.ca=P(this,"Debugger",!1))&&this.ca.lb(this,"time","dump time state",this.Sd)};function vc(a,b){pc(a)&&(a.g?a.s("already running\n"):a.j?qc(a):Ec(a,b))}
l.Ud=function(a){a=void 0===a?Date.now():a;this.L=0;if(this.g){if(this.ea){var b=a-this.ea;1>b&&(b=16.67);this.ba=1E3/b}this.ea=a;a=Date.now();this.R&&(b=a-this.S-this.Z,b>this.Z&&(this.H+=b,this.s(B.jb,"warning: browser throttling detected, compensating by %5.3fms\n",b)));this.S=a;this.H||(this.H=a);this.pa=0;try{this.X=!1;do Dc(this,Ac(this,zc(this,Bc(this))));while(this.g&&!this.X)}catch(c){this.s("%s\n",c.message),qc(this)}this.R=Date.now();this.pa&&(this.H+=this.pa,this.S+=this.pa);this.S+=xc(this,
this.Y,this.R-this.H,this.R-this.S);this.R-this.Ua>=this.Dd&&this.update();for(a=0;a<this.oa.length;a++)this.oa[a](this.ea,this.ba);this.L=this.ic()}};function nc(a,b){if(void 0!==b){if(1>b||!a.J&&0<a.M&&a.M<.9*a.v)b=a.ra;a.l=b;b=a.Ta*a.l;a.v!=b&&(a.v=b,sc(a,tc(a.v)))}a.H=a.R=0;a.i=a.Y=0;xc(a);for(b=a.h.length;0<b;b--){var c=a.h[b-1];0<=c.Za&&Fb(a,b,c.Za,!0)}}function mc(a){var b=a.V[wc];return b?(nc(a,Math.floor((b.value-b.min)/(b.max-b.min)*(a.dc-a.ta)+a.ta)/a.ha|0),!0):!1}
function Fb(a,b,c,d){0<b&&b<=a.h.length&&(b=a.h[b-1],d||0>b.ia)&&(c=Math.ceil(a.ha*(a.Ed?a.ra:a.sa)/1E3*(void 0===c?1E3:c)),a.g&&(c+=Ac(a)),b.ia=c)}l.start=function(){if(this.g||this.j)return!1;this.g=!0;this.H=this.R=0;this.update(!0);this.L=this.ic();return!0};function Ec(a,b){b=void 0===b?1:b;a.g||(b&&!a.j&&(a.j=b),a.j&&(a.j--,Dc(a,Ac(a,zc(a,Bc(a,1)))),a.update(!1),a.j&&setTimeout(function(){Ec(a,0)},0)))}
function qc(a){return a.g?(a.g=!1,Ac(a),a.L&&(a.Cd(a.L),a.L=0),a.update(!0),!0):a.j?(a.j=0,a.update(!0),!0):!1}l.update=function(a){a&&this.s(this.g?"started with %s target\n":"stopped\n",tc(this.v));bb(this,oc,this.g?"Halt":"Run");bb(this,uc,this.j?"Stop":"Step");this.J||sc(this,Cc(this));for(var b=0;b<this.U.length;b++){var c=this.U[b];c.uc.call(c,void 0!=a)}this.Ua=Date.now();this.X=!0};function sc(a,b){bb(a,Fc,b);bb(a,rc,b)}
l.Sd=function(){var a=this.u("nCyclesPerSecond: %f\n",this.ha);a+=this.u("nUpdatesPerSecond: %f\n",this.fc);a+=this.u("nTargetMultiplier: %f\n",this.l);return a+=this.u("nCyclesDepositPerFrame: %f\n",this.fa)};var oc="run",rc="setSpeed",Fc="speed",uc="step",wc="throttle";D.Time=lc;
function Gc(a,b,c){O.call(this,a,b,c);this.type="static"==this.m.type?Hc:Ic;this.aa=this.m.addrWidth||16;this.j=Math.pow(2,this.aa);this.v=this.j-1|0;this.blockSize=this.m.blockSize||(16<this.aa?4096:1024);this.blockSize>this.j&&(this.blockSize=this.j);this.H=this.j/this.blockSize|0;this.h=Math.log2(this.blockSize)|0;this.l=(1<<this.h)-1;this.i=this.m.dataWidth||8;this.g=Array(this.H);this.o=0;a=new U(a,b+"[NONE]",{size:this.blockSize,bus:this.W});for(b=0;b<this.j;b+=this.blockSize)Jc(this,b,this.blockSize,
V.NONE,a);Kc(this,this.type)}x(Gc,O);function Jc(a,b,c,d,e){for(var g=b>>>a.h;0<c&&g<a.g.length;){var f=g*a.blockSize,h=a.blockSize-(b-f);h>c&&(h=c);var k=a.g[g];if(b!=f||h!=a.blockSize||k&&k.type!=V.NONE)break;k=a.W+"["+E(a,b,16,a.aa)+"]";b=e?e.size==a.blockSize?e:new U(a.N,k,{type:d,za:b,size:h,bus:a.W}):new U(a.N,k,{type:d,za:b,size:h,bus:a.W});a.g[g]=b;b=f+a.blockSize;c-=h;g++}}function Lc(a,b){for(var c=V.kd,d=0,e=0;e<a.g.length;e++){var g=a.g[e];g&&g.type&c&&(b(g),d++)}return d}l=Gc.prototype;
l.ja=function(){void 0===this.ca&&(this.ca=P(this,"Debugger",!1))};l.ma=function(){};l.pb=function(a){return a&&this.va(a)?!0:!1};l.La=function(a){this.xa(a)};l.va=function(a){for(var b=0;b<this.g.length;b++){var c=this.g[b];if((this.type==Ic||c.type&V.Fa)&&c.va){var d=a.shift();if(!c.va(d))return!1}}return!0};l.xa=function(a){for(var b=0;b<this.g.length;b++){var c=this.g[b];if((this.type==Ic||c.type&V.Fa)&&c.xa){var d=[];c.xa(d);a.push(d)}}};l.qb=function(a){return this.g[a>>>this.h].qb(a&this.l)};
l.wb=function(a,b){this.g[a>>>this.h].wb(a&this.l,b)};l.Ca=function(a,b){this.g[a>>>this.h].qa(a&this.l,b)};function Kc(a,b){var c=a.o;a.o+=b;c&&a.o||(a.qa=a.Ca)}l.ab=function(a,b){return this.g[a>>>this.h].ab(b)?(Kc(this,1),!0):!1};l.tb=function(a,b){return this.g[a>>>this.h].tb(b)?(Kc(this,1),!0):!1};l.bb=function(a,b){return this.g[a>>>this.h].bb(b)?(Kc(this,-1),!0):!1};l.vb=function(a,b){return this.g[a>>>this.h].vb(b)?(Kc(this,-1),!0):!1};var Hc=0,Ic=1;D.Bus=Gc;
function U(a,b,c){O.call(this,a,b,c);this.za=this.m.addr;this.size=this.m.size;this.type=this.m.type||V.NONE;this.h=(a=this.m.bus)?ib(this,a):P(this,a="Bus");if(!this.h)throw Error(this.u("unable to find bus '%s'",a));this.R=this.h.i;this.o=this.M=!1;this.values=this.l=null;a=this.Ca;this.h.type==Hc&&(a=this.xb,8==this.R&&!1!==lb(this,"ArrayBuffer")&&(this.M=!0));switch(this.type){case V.NONE:this.qa=this.vc;break;case V.ac:this.qa=this.vc;break;case V.Fa:this.qa=a}this.v=this.i=0;this.j=this.K=this.H=
null;Mc(this,this.m.values);Nc(this)}x(U,O);function Mc(a,b){"string"==typeof b?(ob(a,!1),Pa(b,function(c,d,e,g){if(4==e)if(!g&&d){try{var f=JSON.parse(d);Mc(a,f.values)}catch(h){a.s("error (%s) parsing resource: %s\n",h.message,c)}ob(a,!0)}else a.s("error (%d) loading resource: %s\n",g,c)})):a.m.values=b}
function Nc(a,b){if(a.type>V.NONE&&(a.M?(a.l=new ArrayBuffer(a.size),new DataView(a.l,0,a.size),a.values=new Uint8Array(a.l,0,a.size),new Uint16Array(a.l,0,a.size>>1),new Int32Array(a.l,0,a.size>>2)):a.values=Array(a.size).fill(0),b))for(var c=0;c<b.length;c++)a.values[c]=b[c]}l=U.prototype;
l.ma=function(){if(this.m.values)a:{var a=this.h,b=this.za,c=this.size,d=this.m.values,e=0,g=b&a.l;b>>>=a.h;c>d.length&&(c=d.length);for(;0<c&&b<a.g.length;){var f=a.g[b++];if(!f)break a;for(;0<c&&g<f.size;)f.Ca(g++,d[e++]),c--;g=0}}else this.type&V.Fa&&this.values&&this.values.fill(0)};l.qb=function(a){return this.values?this.values[a]:0};l.vc=function(){};l.wb=function(a,b){this.values&&(this.values[a]=b)};l.Ca=function(a,b){this.values[a]=b};
l.xb=function(a,b){this.values[a]=b;this.o=!0;this.i?this.j=this.Ca:this.qa=this.Ca};l.ab=function(a){return this.v?this.K==a?(this.v++,!0):!1:(this.v++,this.K=a,!0)};l.tb=function(a){if(!this.i){var b=this;this.i++;this.H=a;this.j=this.qa;this.qa=function(c,d){b.H(b.za,c,d);b.j(c,d)};return!0}return this.H==a?(this.i++,!0):!1};l.bb=function(a){return this.v&&this.K==a?(--this.v||(this.K=null),!0):!1};l.vb=function(a){return this.i&&this.H==a?(--this.i||(this.qa=this.j,this.j=this.H=null),!0):!1};
l.va=function(a){if(a){var b=a.shift();if(this.W==b){this.o=a.shift();a.shift();if(a=a.shift()){var c=this.size;c=void 0===c?0:c;if(a.length!=c){b=0;c=c?Array(c):[];for(var d=0;d<a.length-1;)for(var e=a[d++],g=a[d++];e--;)c[b++]=g;a=c}Nc(this,a)}return!0}}return!1};
l.xa=function(a){a.push(this.W);a.push(this.o);a.push(!1);if(this.values){var b=this.values;for(var c=0,d=0,e=[];c<b.length;){for(var g=b[c],f=c+1;f<b.length&&b[f]===g;)f++;e[d++]=f-c;e[d++]=g;c=f}b=e.length>=b.length?b:e}else b=this.values;a.push(b)};var V={NONE:1,ac:2,Fa:4,kd:14,nf:12};D.Memory=U;function Oc(a,b,c){c.type=V.NONE;U.call(this,a,b,c);Jc(this.h,this.m.addr,this.m.size,V.Fa);pb(this,this.ma.bind(this))}x(Oc,U);D.RAM=Oc;
function Pc(a,b,c){c.type=V.ac;U.call(this,a,b,c);Jc(this.h,this.m.addr,this.m.size,this.m.type,this);pb(this,this.ma.bind(this));this.T=this.ca=void 0;if(D.LED&&this.V[Qc]){var d=this;this.J=Math.pow(2,Math.ceil(Math.log2(this.values.length)/2));this.L=this.values.length/this.J|0;this.g=new Qb(a,b+"LEDs",{"class":"LED",bindings:{container:La(this,Qc)},type:Sb,cols:this.J,rows:this.L,color:I(this,"colorROM","green"),backgroundColor:I(this,"backgroundColorROM","black"),persistent:!0}),ac(this.g);this.S=
new sb(a,b+"Input",{"class":"Input",location:[0,0,this.g.ea,this.g.Z,this.J,this.L],bindings:{surface:La(this,Qc)}});this.U=Ma(this)||"";vb(this.S,function(e,g){if(d.T){var f=d.U;0<=e&&0<=g&&(e=g*d.J+e,f=d.T.Cf(d.za+e,d.values[e]));bb(d,Na,f)}})}}x(Pc,U);
Pc.prototype.va=function(a){var b=!0,c=a.shift();if(c&&this.g){var d=c.length;this.g.h.length==d?(this.g.h=c,$b(this.g,!0)):(this.s("inconsistent saved LED state (%d), unable to load\n",d),b=!1)}a.length&&(d=(a=a.shift())&&a.length||-1,this.values.length==d?this.values=a:(this.s("inconsistent saved ROM state (%d), unable to load\n",d),b=!1));return b};Pc.prototype.ja=function(){void 0===this.T&&(this.T=P(this,"CPU"));void 0===this.ca&&(this.ca=P(this,"Debugger",!1))&&this.ca.mb&&this.ca.mb(this.m.symbols)};
Pc.prototype.xa=function(a){this.g&&(a.push(this.g.h),a.push(this.values))};var Qc="array",Na="cellDesc";D.ROM=Pc;function Rc(a,b,c){c["class"]="CPU";O.call(this,a,b,c);this.ca=void 0;this.i=this.rb=0;this.time=P(this,"Time");this.time.K.push(this);this.time.U.push(this);this.h=this.g=0}x(Rc,O);Rc.prototype.abort=function(a){this.i=this.rb;this.s("%s\n",a.message);qc(this.time)};function Sc(a,b){a.ca=b;return a.Qa}Rc.prototype.Vd=function(a){this.h=this.g=void 0===a?0:a;return this.h-this.g};
Rc.prototype.Wd=function(){this.h-=this.g;this.g=0};
function Tc(a,b,c){c["class"]="Debugger";O.call(this,a,b,c);var d=this;this.da=this.m.defaultRadix||16;this.Z=["(",")"];this.Wb("a",function(g,f,h,k,n){return E(d,n.O,d.da,h)});this.Wb("n",function(g,f,h,k,n){return E(d,n,d.da,h,0>f.indexOf("#")?"":void 0)});this.K=0;this.ha=B.NONE;this.M={};this.oa=[];this.pa=[];this.T=P(this,"CPU");this.Qa=Sc(this.T,this);this.ra=P(this,"Input",!1);if(a=this.T.m.busMemory||this.m.busMemory){this.g=ib(this,a);if(a=this.T.m.busIO||this.m.busIO)this.j=ib(this,a,!1);
this.j||(this.j=this.g)}else this.g=this.j=P(this,"Bus");this.L=this.g.aa;this.Ba=Math.pow(2,this.L)-1|0;this.H=this.ea=0;this.v=[];for(var e in W)this.v[W[e]]=[];this.o=[];this.o[W.ka]=this.g;this.o[W.Ia]=this.g;this.o[W.na]=this.j;this.o[W.Ea]=this.j;this.l=[];this.l[W.ka]=this.Id.bind(this);this.l[W.Ia]=this.Jd.bind(this);this.l[W.na]=this.Gd.bind(this);this.l[W.Ea]=this.Hd.bind(this);this.i=[];this.R=void 0;this.X=null;this.$=0;this.time=P(this,"Time");this.time.U.push(this);this.Y=0;this.J=[];
this.U="";this.lb(this,"state","dump machine state",this.Rd);this.ba=Uc();this.sa=Uc();this.fa=!1;this.S=0;this.h=[];Ha(this,this.Td.bind(this));(e=lb(this,"commands"))&&Ua(this,e)}x(Tc,O);l=Tc.prototype;l.lb=function(a,b,c,d){this.J.push({Qd:a,name:b,Pd:c,Xa:d})};function Vc(a,b,c){for(var d,e=0;e<a.J.length;e++){var g=a.J[e];if(g.name==b){d=g.Xa.call(g.Qd,c);break}}return d}
l.mb=function(a){if(a&&a.length)for(var b=0;b<a.length-2;b+=3){var c=Wc(this,a[b]);if(c){var d=Xc[a[b+1]];if(d){c={address:c,type:d,name:a[b+2]};d=this.oa;var e=c,g=Yc(d,e,this.oc);0>g&&d.splice(-(g+1),0,e);d=this.pa;e=Yc(d,c,this.pc);0>e&&d.splice(-(e+1),0,c)}}}};function Yc(a,b,c){var d=0,e=a.length,g=0;for(void 0===c&&(c=function(k,n){return k>n?1:k<n?-1:0});d<e;){var f=d+e>>1,h=void 0;h=c(b,a[f]);0<h?d=f+1:(e=f,g=!h)}return g?d:~d}l.oc=function(a,b){return a.name>b.name?1:a.name<b.name?-1:0};
l.pc=function(a,b){return a.address.O>b.address.O?1:a.address.O<b.address.O?-1:0};function Zc(a,b,c){b=Yc(a.pa,{address:b,type:0,name:void 0},a.pc);if(0<=b&&(a=a.pa[b],!c||a.type==c))var d=a.name;return d}function $c(a,b,c,d){d=void 0===d?a.g:d;b.O=b.O+c&d.v}function Uc(a){a=void 0===a?0:a;var b=ad.fd;return"number"==typeof a?{O:a,sb:-1,type:b}:{O:a.O,sb:a.sb,type:a.type}}
function Wc(a,b,c){if(b){var d=Uc();var e=0,g=b.charAt(e);switch(g){case "&":e++;break;case "#":e++;d.type=ad.hd;break;case "%":e++,g=b.charAt(e),"%"==g?e++:d.type=ad.kc}g=b.indexOf(":",e);if(0<=g){var f=bd(a,b.substring(e,g),c);void 0==f?d=null:(d.sb=f,e=g+1)}d&&(b=bd(a,b.substring(e),c),void 0==b?d=null:d.O=b&a.Ba)}return d}function cd(a,b,c,d){d=void 0===d?a.g:d;a.H++;var e=d.qb(b.O);c&&$c(a,b,c,d);a.H--;return e}
function dd(a,b,c){if(32>=a.L)return b&c;b=X(a,b,0,!0);c=X(a,c,0,!0);return((b/F|0)&(c/F|0))*F+((b&c)>>>0)}function ed(a,b,c){if(32>=a.L)return b^c;b=X(a,b,0,!0);c=X(a,c,0,!0);return((b/F|0)^(c/F|0))*F+((b^c)>>>0)}
function fd(a,b,c,d){for(d=void 0===d?-1:d;d--&&c.length;){var e=c.pop();if(2>b.length)return!1;var g=b.pop();var f=b.pop();switch(e){case "*":f*=g;break;case "/":if(!g)return!1;f=Math.trunc(f/g);break;case "^/":if(!g)return!1;f%=g;break;case "+":f+=g;break;case "-":f-=g;break;case "<<":f<<=g;break;case ">>":f>>=g;break;case ">>>":f>>>=g;break;case "<":f=f<g?1:0;break;case "<=":f=f<=g?1:0;break;case ">":f=f>g?1:0;break;case ">=":f=f>=g?1:0;break;case "==":f=f==g?1:0;break;case "!=":f=f!=g?1:0;break;
case "&":f=dd(a,f,g);break;case "!":case "|":e=f;32>=a.L?f=e|g:(e=X(a,e,0,!0),g=X(a,g,0,!0),f=(e/F|0|g/F|0)*F+((e|g)>>>0));break;case "^!":f=ed(a,f,g);break;case "&&":f=f&&g?1:0;break;case "||":f=f||g?1:0;break;case ",,":f=X(a,f,18,!0)*Math.pow(2,18)+X(a,g,18,!0);break;case "_":case "^_":"^_"==e&&(g=35-(g&255));g&&(f=X(a,f,0,!0),f=0<g?f*Math.pow(2,g):Math.trunc(f/Math.pow(2,-g)));break;default:return!1}b.push(X(a,f))}return!0}
function gd(a,b,c,d,e,g){var f,h=!1,k=0,n=[],p=[],m=a.da;for(a.da=e;c<d;){var r=b[c++].trim();var v=c<d?b[c++]:"";if(r){var w=void 0;var u=a;var z=r,y=g;k=void 0===k?0:k;if(void 0!=z){w=mb(u,z.toUpperCase());if(void 0==w){w=void 0;var yb=u,yc=Yc(yb.oa,{address:null,type:0,name:z},yb.oc);0<=yc&&(w=yb.oa[yc].address.O);if(void 0==w)if(w=z,u.M[w]?w=u.M[w].value:(w=w.substr(0,6),w=u.M[w]&&u.M[w].value),void 0==w)w=sa(z,1<z.length||10<u.da?u.da:10);else if(z=u.M[z]&&u.M[z].Af)y?y.push(z):(y=bd(u,z,y),
void 0!==y?w+=y:w=void 0)}void 0!=w&&(w=X(u,hd(u,w,k)))}u=w}else if("{"==v){r=1;for(u=c;c<d;)if(c++,v=c<b.length?b[c++]:"","{"==v)r++;else if("}"==v&&!--r)break;u=gd(a,b,u,c-1,a.da,g);null!=u&&k&&(u=hd(a,u,k));r=c<d?b[c++].trim():"";v=c<d?b[c++]:""}else{if(" "==v)continue;if("^B"==v){a.da=2;continue}if("^O"==v){a.da=8;continue}if("^D"==v){a.da=10;continue}if(!(k&-1073741824)){if("+"==v)continue;if("-"==v){k=k<<2|1;continue}if("~"==v||"^-"==v){k=k<<2|2;continue}if("^L"==v){k=k<<2|3;continue}}h=!0;
break}if(void 0===u)if(g)g.push(r),u=0;else{h=!0;break}n.push(X(a,u));if(" "==v)if(c<b.length-1&&!b[c])c++,v=b[c++];else{h=!0;break}if(!v)break;u="<"==a.Z[0]?id:jd;if(!u[v]){h=!0;break}p.length&&u[v]<=u[p[p.length-1]]&&fd(a,n,p,1);p.push(v);a.da="^_"==v?10:e;k=0}if(h||!fd(a,n,p)||1!=n.length)h=!0;h?g||a.s("parse error (%s)\n",r||v):f=n.pop();a.da=m;return f}
function kd(a,b,c,d){for(var e,g=a.L/d|0;0<=(e=b.indexOf(c));){for(var f=0,h=e+1,k=g;h<b.length;){var n=b[h++];if(n==c){k=-1;break}if(!k)break;k--;n=n.charCodeAt(0);6==d&&(n-=32);n&=(1<<d)-1;f=X(a,f*Math.pow(2,d)+n,d*g,!0)}if(0<=k){a.s("parse error (%c%s%c)\n",c,b,c);return}b=b.substr(0,e)+E(a,f)+b.substr(h)}return b}
function bd(a,b,c){if(b){"{"!=a.Z[0]&&(b=b.split(a.Z[0]).join("{").split(a.Z[1]).join("}"));b=kd(a,b,'"',8);if(!b)return d;b=kd(a,b,"'",6);if(!b)return d;16!=a.da&&(b=b.replace(/(^|[^A-Z0-9$%.])([0-9]+)B/,"$1$2^_").replace(/\s+/g," "));b=b.split(/({|}|\|\||&&|\||\^!|\^B|\^O|\^D|\^L|\^-|~|\^_|_|&|!=|!|==|>=|>>>|>>|>|<=|<<|<|-|\+|\^\/|\/|\*|,,| )/);var d=gd(a,b,0,b.length,a.da,c)}return d}
function hd(a,b,c){for(;c;){var d;switch(c&3){case 1:b=-X(a,b);break;case 2:b=ed(a,b,-1);break;case 3:for(d=35;0<=d&&!dd(a,b,Math.pow(2,d));)d--;b=35-d}c>>>=2}return b}function X(a,b,c,d){var e=b;c=c||a.L;if(d)if(32==c)e=b>>>0;else if(32>c)e=b&(1<<c)-1;else{if(a=Math.pow(2,c),0>b||b>=a)e=b%a,0>e&&(e+=a)}else 32>=c?e=b<<32-c>>32-c:(a=Math.pow(2,c-1),b>=a?(e=b%a,(b/a|0)&1&&(e-=a)):b<-a&&(e=b%a,((-b-1)/a|0)&1?e&&(e+=a):e||(e-=a)));b!=e&&(b=e);return b}
l.nb=function(a){function b(h){for(var k=0;k<h.length;k++)if(void 0!=h[k])return!1;return!0}if(-1>a)return ld(this,this.nb);var c="";if(0<=a){var d=this.i[a];if(void 0!=d){c=d>>8;d&=255;var e=this.o[c];if(e){var g=this.v[c],f=g[d];(c&1?e.vb(f.O,this.l[c]):e.bb(f.O,this.l[c]))?(g[d]=void 0,this.i[a]=void 0,b(g)&&(g.length=0,b(this.i)&&(this.i.length=0)),c=this.u("%2d: %s %*a cleared\n",a,md[c],e.aa,f),--this.ea||this.fa||(c+=nd(this,!1))):c=this.u("invalid break address: %*a\n",e.aa,f)}else c="invalid bus"}else c=
this.u("invalid break index: %d\n",a)}else c="missing break index\n";return c};function od(a,b){if(a.X&&(void 0==b||a.X.O==b)){var c=void 0===c?W.ka:c;b=-1;var d=pd(a.X,a.v[c]);if(0<=d)for(var e=0;e<a.i.length;e++){var g=a.i[e];if(void 0!=g&&c==g>>8&&d==(g&255)){b=e;break}}c=b;0<=c&&a.nb(c);a.X=null}}
l.ob=function(a,b){b=void 0===b?!1:b;if(-1>a)return ld(this,this.ob,b);if(0<=a){var c=this.i[a];if(void 0!=c){var d=c>>8;c=this.v[d][c&255];if(void 0!=c){var e=b?"enabled":"disabled",g=this.o[d];!c.disabled==!b?(c.disabled=!b,a=this.u("%2d: %s %*a %s\n",a,md[d],g.aa,c,e)):a=this.u("%2d: %s %*a already %s\n",a,md[d],g.aa,c,e)}else a=this.u("no break address at index: %d\n",a)}else a=this.u("invalid break index: %d\n",a)}else a="missing break index\n";return a};
function ld(a,b,c){for(var d="",e=0;e<a.i.length;e++)void 0!=a.i[e]&&(d+=b.call(a,e,c));d||(d="no break addresses found");return d}function qd(a,b,c){c=void 0===c?W.ka:c;a=a.v[c];for(c=0;c<a.length;c++){var d=a[c];if(d.O==b)return d}}function pd(a,b){for(var c=0;c<b.length;c++)if(b[c].O==a.O)return c;return-1}
function rd(a,b){b=void 0===b?!1:b;for(var c="",d=0;d<a.i.length;d++){var e=a.i[d];if(void 0!=e){var g=e>>8;e=a.v[g][e&255];g=a.u("%s %*a",md[g],a.o[g].aa,e);b?(c&&(c+=";"),c+=g,e.disabled&&(c+=";bd "+d)):c+=a.u("%2d: %s %s\n",d,g,e.disabled?"disabled":"enabled")}}c||b||(c="no break addresses found\n");return c}
function sd(a,b,c){c=void 0===c?W.ka:c;if(b){var d=a.o[c];if(d){var e=a.v[c];var g=pd(b,e);if(0<=g)g=-(g+1);else{for(g=0;g<e.length&&void 0!=e[g];g++);e[g]=b}e=g;if(0<=e)if(g=c&1?d.tb(b.O,a.l[c]):d.ab(b.O,a.l[c])){for(g=0;g<a.i.length&&void 0!=a.i[g];g++);a.i[g]=c<<8|e;b=a.u("%2d: %s %*a set\n",g,md[c],d.aa,b);a.ea++||a.h.length||(b+=nd(a,!0))}else b=a.u("invalid break address: %*a\n",d.aa,b),a.v[c][e]=void 0;else b=a.u("%s %*a already set\n",md[c],d.aa,b)}else b="invalid bus"}else b="missing break address\n";
return b}function td(a,b){0<=b&&(a.K=b);var c="instruction break count: "+(0<a.K?a.K:"disabled")+"\n";0<b&&(a.h.length||(c+=nd(a,!0)),a.fa=!0);return c}function ud(a,b){var c;if(b){var d=Wa(b);void 0!=d?a.ha=d?B.zb:B.NONE:c=a.u("unrecognized message option: %s\n",b)}c||(c=a.u("break on message: %b\n",!!a.ha));return c}l.Gd=function(a,b){this.H||(void 0==a?Y(this,"break on unknown input %#0x: %#0x",b):(a=qd(this,a+b,W.na))&&!a.disabled&&Y(this,"break on input %*a: %#0x",this.j.aa))};
l.Hd=function(a,b){this.H||(void 0==a?Y(this,"break on unknown output %#0x: %#0x",b):(a=qd(this,a+b,W.Ea))&&!a.disabled&&Y(this,"break on output %*a: %#0x",this.j.aa))};l.Id=function(a,b){this.H||(void 0==a?Y(this,"break on unknown read %#0x: %#0x",b):(a+=b,this.h.length&&a==this.T.rb&&(this.$++,0<this.K&&(--this.K||Y(this,"break on instruction count")),this.h[this.S++]=a,this.S==this.h.length&&(this.S=0)),(b=qd(this,a,W.ka))&&!b.disabled&&(Y(this,"break on read %*a: %#0x",this.g.aa),od(this,a))))};
l.Jd=function(a,b){this.H||(void 0==a?Y(this,"break on unknown write %#0x: %#0x",b):(a=qd(this,a+b,W.Ia))&&!a.disabled&&Y(this,"break on write %*a: %#0x",this.g.aa))};function Y(a,b,c){b=a.u.apply(a,[b].concat(q(c)));a.s("%s\n",b);qc(a.time)}function vd(a,b,c){c=void 0===c?a.g:c;return E(a,b.O,a.da,c.aa,"")}
function wd(a,b,c){c=void 0===c?10:c;var d="";if(a.h.length){var e,g=[];c>a.h.length&&(c=a.h.length);0>b&&(b=c);var f=a.S-b;for(0>f&&(f+=a.h.length);0<=f&&f<a.h.length&&0<c;){var h=a.h[f++];if(void 0==h)break;f==a.h.length&&(f=0);e?e.O=h:e=Uc(h);for(h=0;1>h;h++)g[h]=cd(a,e,1);$c(a,e,-g.length);d+=a.ub(e,g,a.u("[%6d]",b--));c--}}return d||"no history"}
function xd(a,b,c){var d=[],e="";for(b="number"==typeof b?Uc(b):b;c--;){for($c(a,b,d.length);1>d.length;)d.push(cd(a,b,1));$c(a,b,-d.length);e+=a.ub(b,d)}return e}
function yd(a,b,c,d,e,g){var f="";g=g?a.j:a.g;c||(c=g.i);var h=c>>3;d||(d=128);var k=0,n=d+15>>4||1,p=4==h?16:a.da;"y"==e&&(p=h,n=d,k=8*h);b||(b=a.sa);for(;n--&&0<d;){var m=e=0,r,v="",w="",u=vd(a,b,g);for(r=p;0<r&&0<d;r--){var z=cd(a,b,1,g);e|=z<<(m++<<3);m==h&&(v+=E(a,e,0,c,""),v+=1==h?9==r?"-":" ":" ",k&&(w+=E(a,e,2,c,"")),e=m=0);k||(w+=32<=z&&127>z?String.fromCharCode(z):".");d--}f&&(f+="\n");f+=u+"  "+v+" "+w}a.sa=b;return f}
l.Rd=function(){var a=[];kb(this,function(b){b.La&&b.La(a);return!0});return JSON.stringify(a,null,2)};function zd(a,b,c,d){var e=0,g="";d=d?a.j:a.g;for(var f=0;void 0!=b&&f<c.length;f++){var h=cd(a,b,0,d);if(void 0==h)break;var k=a,n=b,p=c[f],m=d;m=void 0===m?k.g:m;k.H++;m.wb(n.O,p);k.H--;g+=a.u("%*a: %#*n changed to %#*n\n",a.g.aa,b,a.g.i,h,a.g.i,c[f]);$c(a,b,1,d);e++}e||(g+=a.u("%d locations updated\n",e));a.time.update();return g}
function nd(a,b){var c="";void 0!=b&&b==!a.h.length&&Lc(a.g,function(d){b?a.g.ab(d.za,a.l[W.ka]):a.g.bb(d.za,a.l[W.ka])})&&(b?(a.S=0,a.h=Array(Ad)):a.h=[]);return c+=a.u("instruction history %s\n",a.h.length?"enabled":"disabled")}l.va=function(a){var b=a.shift();return this.W==b?(Ua(this,a.shift()),this.I.ga=a.shift(),!0):!1};l.tc=function(a){ta(this.ha,a)?Y(this,"break on message"):this.time.X=!0};
l.Td=function(a){var b=a[1],c=a[2],d=[],e=[],g=!1,f="";this.R=void 0;if("*"==c)var h=-2;else{h=sa(c);void 0==h&&(h=-1);var k=Wc(this,c,e);if(null===k)return}var n=0;a[3]&&(n=sa(a[3].substr("l"==a[3][0]?1:0))||8);for(var p=3;p<a.length;p++)d.push(sa(a[p],16));if("d"==b){p=Vc(this,c,d);if(void 0!=p)return p;b=this.U||b}if("s"!=b[0]&&e.length)return"unrecognized symbol(s): "+e;switch(b[0]){case "b":"c"==b[1]?f=this.nb(h):"d"==b[1]?f=this.ob(h):"e"==b[1]?f=this.ob(h,!0):"i"==b[1]?f=sd(this,k,W.na):"l"==
b[1]?f=rd(this):"m"==b[1]?f=ud(this,c):"n"==b[1]?f=td(this,h):"o"==b[1]?f=sd(this,k,W.Ea):"r"==b[1]?f=sd(this,k,W.ka):"w"==b[1]?f=sd(this,k,W.Ia):"?"==b[1]?(f="break commands:\n",Bd.forEach(function(m){f+=m+"\n"})):b[1]&&(f=void 0);break;case "d":this.U=b;if("b"!=b[1]&&b[1])if("w"==b[1])c=16;else if("d"==b[1])c=32;else if("i"==b[1]){if(!this.j){f="invalid bus";break}c=this.j.i;n=n||1;g=!0}else{if("h"==b[1])this.U="",f=wd(this,h,n);else if("?"==b[1]){if(this.U="",f="dump commands:\n",Cd.forEach(function(m){f+=
m+"\n"}),this.J.length)for(f+="dump extensions:\n",b=0;b<this.J.length;b++)k=this.J[b],f+=this.u("d   %-12s%s\n",k.name,k.Pd)}else this.U="",f=void 0;break}else c=8;f=yd(this,k,c,n,b[2],g);break;case "e":if("o"==b[1]){if(!this.j){f="invalid bus";break}g=!0}else if(b[1]){f=void 0;break}f=zd(this,k,d,g);break;case "g":if(this.time.start()){if(void 0!=k){od(this);f=sd(this,k);if(2!=f.indexOf(":"))break;this.X=k;f=""}break}f="already started\n";break;case "h":qc(this.time)||(f="already stopped\n");break;
case "p":a.shift();a.shift();b=a.join(" ");f+=this.u("%s = %s\n",b,E(this,bd(this,b)));break;case "r":if(b=b.substr(1).toUpperCase()){if(void 0==mb(this.T,b)){f+=this.u("unrecognized register: %s\n",b);break}void 0!=k&&rb(this.T,b,k.O)}this.ba.O=this.T.i;f+=this.T.toString();break;case "s":k=Wa(c);if("h"==b[1]){if(this.ea||0<this.K)k=void 0;f=nd(this,k);void 0!=k&&(this.fa=k)}else"p"==b[1]?0<h?(nc(this.time,h),f="target speed:  "+tc(this.time.v)):f="current speed: "+Cc(this.time):"s"==b[1]&&this.ta?
(h=this.ta.indexOf(c),0<=h&&(this.style=this.ta[h]),f="style: "+this.style):"?"==b[1]?(f="set commands:\n",Dd.forEach(function(m){f+=m+"\n"})):f=void 0;break;case "t":n=sa(c,10)||1;this.R=!0;if(b[1]){if("r"!=b[1]){f=void 0;break}this.R=!1}vc(this.time,n);break;case "u":if(b[1]){f=void 0;break}n||(n=8);k||(k=this.ba);f+=xd(this,k,n);this.ba=k;break;case "?":f="debugger commands:\n";Ed.forEach(function(m){f+=m+"\n"});break;default:f=void 0}void 0==f&&a[0]&&(f="unrecognized command '"+a[0]+"' (try '?')\n");
return f};l.pb=function(a){return a&&this.va(a[0])?(a.shift(),!0):!1};l.La=function(a){var b=[];this.xa(b);a.push(b);this.Y=0};l.uc=function(a){a&&(this.time.g?this.Y&&this.ra&&Pb(this.ra):this.R?this.Aa(xd(this,this.T.i,1)):(this.$&&(this.T.s("%d instructions executed\n",this.$),this.$=0),this.T.Aa(this.T.toString()),void 0==this.R&&this.Y&&(a=this.ua(Ea.Sa,!0))&&a.focus()),this.Y++)};l.xa=function(a){a.push(this.W);a.push(rd(this,!0));a.push(this.I.ga)};
l.ub=function(a,b,c){var d=this.u,e=vd(this,a);b=b.shift();$c(this,a,1);return d.call(this,"%s %02x       unsupported       ; %s\n",e,b,c||"")};
var Ed="b?\t\tbreak commands;d?\t\tdump commands;e[o] [addr] ...\tedit memory/ports;g    [addr]\trun (to addr);h\t\thalt;p    [expr]\tparse expression;r?   [value]\tdisplay/set registers;s?\t\tset commands;t[r] [n]\tstep (n instructions);u    [addr] [n]\tunassemble (at addr)".split(";"),Bd="bc [n|*]\tclear break address;bd [n|*]\tdisable break address;be [n|*]\tenable break address;bl [n]\t\tlist break addresses;bi [addr]\tbreak on input;bo [addr]\tbreak on output;br [addr]\tbreak on read;bw [addr]\tbreak on write;bm [on|off]\tbreak on message;bn [count]\tbreak on instruction count".split(";"),Cd=
"db  [addr]\tdump bytes (8 bits);dw  [addr]\tdump words (16 bits);dd  [addr]\tdump dwords (32 bits);di  [addr]\tdump input ports;d*y [addr]\tdump values in binary;dh  [n] [l]\tdump instruction history buffer;ds\t\tdump machine state".split(";"),Dd=["sh [on|off]\tset instruction history","sp [n]\t\tset speed multiplier","ss\t\tset debugger style"],ad={kc:1,fd:0,hd:2,lf:0},W={ka:0,Ia:1,na:2,Ea:3},Fd={},md=(Fd[W.ka]="br",Fd[W.Ia]="bw",Fd[W.na]="bi",Fd[W.Ea]="bo",Fd),Z={BYTE:1,ed:2,jd:4,Sb:5,Fb:6,Ad:7},
Xc={"=":Z.Ad,1:Z.BYTE,2:Z.ed,4:Z.jd,"@":Z.Sb,";":Z.Fb},Ad=1E5,jd={"||":5,"&&":6,"!":7,"|":7,"^!":8,"&":9,"!=":10,"==":10,">=":11,">":11,"<=":11,"<":11,">>>":12,">>":12,"<<":12,"-":13,"+":13,"^/":14,"/":14,"*":14,_:19,"^_":19,"{":20,"}":20},id={",,":1,"||":5,"&&":6,"!=":10,"==":10,">=":11,">":11,"<=":11,"<":11,">>>":12,">>":12,"<<":12,"-":13,"+":13,"^/":14,"/":14,"*":14,"!":15,"|":15,"^!":15,"&":15,_:19,"^_":19,"{":20,"}":20};function Gd(a,b,c){Rc.call(this,a,b,c)}x(Gd,Rc);D.CPUx86=Gd;
function Hd(a,b,c){Tc.call(this,a,b,c)}x(Hd,Tc);Hd.prototype.ub=function(a,b,c){var d=vd(this,a),e="",g=Zc(this,a,Z.Sb),f=Zc(this,a,Z.Fb);b=b.shift();e+=E(this,b,16,8,"");$c(this,a,1);a=this.u("%#02x",b);d=this.u("%s %-7s %-7s %s",d,e,a,"");c?f&&(c+=" "+f):f&&(c=f);c&&(d=this.u("%-32s; %s",d,c));g&&(d=g+":\n"+d);return d+"\n"};D.Dbgx86=Hd;
function Id(a,b,c){S.call(this,a,b,c);this.X=this.m.bufferAddr;this.M=this.m.interruptRate;this.R=this.m.refreshRate||60;this.U=ib(this,this.m.bus);this.T=P(this,"CPU");this.time=P(this,"Time");this.S=Ab(this.time,this.W,this.ea.bind(this));this.time.U.push(this);Fb(this.time,this.S,1E3/Math.max(this.R,this.M))}x(Id,S);Id.prototype.uc=function(){};
Id.prototype.ea=function(a){if(!a){if(this.$&&this.Y){a=this.U;var b=this.X,c=this.Y,d=b>>>a.h;for(b=a.blockSize-(b&a.l);0<c&&d<a.g.length;){var e=a.g[d];e.o&&(e.o=!1,e.h.type==Hc&&(e.i?e.j=e.xb:e.qa=e.xb));c-=b;b=a.blockSize;d++}}Fb(this.time,this.S,1E3/Math.max(this.R,this.M))}};D.PCx86Video=Id;
function Jd(a,b,c){O.call(this,a,a);var d=this;this.i=!1;this.v=c;this.h="";this.o=this.l=!1;ob(this,!1);this.ga=B.Gc;b=b.trim();"{"==b[0]?Kd(this,b):(this.h=b,Pa(this.h,function(e,g,f,h){4==f&&(!h&&g?(Kd(d,g),Ld(d)):d.s("error (%d) loading configuration: %s\n",h,e))}));window.addEventListener("load",function(){d.o=!0;Ld(d)});window.addEventListener(K("iOS")?"pagehide":K("Opera")?"unload":"beforeunload",function(){Md(d)});window.addEventListener("pageshow",function(){d.i||d.ja(!0)})}x(Jd,O);
Jd.prototype.ya=function(a,b){var c=this;switch(a){case Nd:b.onclick=function(){c.ja()};break;case Od:b.onclick=function(){c.ma()}}O.prototype.ya.call(this,a,b)};
function Ld(a){var b=!0;if(a.l&&a.o){for(var c in a.g){var d=void 0,e=a.g[c];try{d=e["class"],D[d]?"Machine"==d?(a.s("PCjs %s v%3.2f\n%s\n",e.name,3,"Copyright \u00a9 2012-2023 Jeff Parsons <Jeff@pcjs.org>"),a.h&&a.s("Configuration: %s\n",a.h)):new D[d](a.N,c,e):a.s('unrecognized %s device "%s"\n',d,c)}catch(f){e.optional||(a.s('error initializing %s device "%s": %s\n',d,c,f.message),b=!1),qb(a,c)}}if(a.j){var g=Ta(a);kb(a,function(f){return f.pb&&!f.pb(g)?(f.s('unable to restore state for device "%s"\n',
f.W),!1):!0})}ob(a,!0);pb(a,a.ja.bind(a,b))||a.s("machine %s not ready to power, waiting for device(s)\n",a.N)}}
function Kd(a,b){try{a.g=JSON.parse(b);var c=a.g[a.N];if(!c){c=a.g[Ba(a.h)];if(!c)throw Error("configuration missing machine ID");a.g[a.N]=c}jb(a,c,["autoSave","autoStart"]);a.j=!1!==a.m.autoSave;a.H=!1!==a.m.autoStart;if(a.v){var d=eval("("+a.v+")"),e;for(e in d)a.m[e]=d[e]}a.l=!0}catch(g){c=g.message,(d=c.match(/position ([0-9]+)/))&&(c+=" ('"+b.substr(+d[1],40).replace(/\s+/g," ")+"...')"),a.s("machine '%s' initialization error: %s\n",a.N,c)}}
Jd.prototype.ja=function(a){a=void 0===a?!this.i:a;if(nb(this)){var b=this;a&&this.s("power on\n");kb(this,function(c){c.ja&&c!=b&&("CPU"!=c.m["class"]||b.H&&nb(b)?c.ja(a):c.time.update(!0));return!0});(this.i=a)||this.s("power off\n")}};Jd.prototype.ma=function(){if(nb(this)){var a=this;kb(this,function(b){b.ma&&b!=a&&b.ma();return!0});this.s("reset\n")}};function Md(a){if(a.j){var b=[];kb(a,function(c){c.La&&c.La(b);return!0});ab(a,b)}a.ja(!1)}var Nd="power",Od="reset";
window.PCx86v3=function(a,b,c){var d=new Jd(a,b,c);window.command=function(e){return Ua(d,e)};return d};D.Machine=Jd;})()

//# sourceMappingURL=pcx86v3.js.map
